diff -Naur u-boot-2009.08.orig3/Makefile~ u-boot-2009.08.mine2/Makefile~
--- u-boot-2009.08.orig3/Makefile~	2010-10-13 16:01:49.592000861 -0500
+++ u-boot-2009.08.mine2/Makefile~	1969-12-31 18:00:00.000000000 -0600
@@ -1,3736 +0,0 @@
-#
-# (C) Copyright 2000-2009
-# Wolfgang Denk, DENX Software Engineering, wd@denx.de.
-#
-# See file CREDITS for list of people who contributed to this
-# project.
-#
-# This program is free software; you can redistribute it and/or
-# modify it under the terms of the GNU General Public License as
-# published by the Free Software Foundatio; either version 2 of
-# the License, or (at your option) any later version.
-#
-# This program is distributed in the hope that it will be useful,
-# but WITHOUT ANY WARRANTY; without even the implied warranty of
-# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.	See the
-# GNU General Public License for more details.
-#
-# You should have received a copy of the GNU General Public License
-# along with this program; if not, write to the Free Software
-# Foundation, Inc., 59 Temple Place, Suite 330, Boston,
-# MA 02111-1307 USA
-#
-
-VERSION = 2009
-PATCHLEVEL = 08
-SUBLEVEL =
-EXTRAVERSION =
-ifneq "$(SUBLEVEL)" ""
-U_BOOT_VERSION = $(VERSION).$(PATCHLEVEL).$(SUBLEVEL)$(EXTRAVERSION)
-else
-U_BOOT_VERSION = $(VERSION).$(PATCHLEVEL)$(EXTRAVERSION)
-endif
-TIMESTAMP_FILE = $(obj)include/timestamp_autogenerated.h
-VERSION_FILE = $(obj)include/version_autogenerated.h
-
-HOSTARCH := $(shell uname -m | \
-	sed -e s/i.86/i386/ \
-	    -e s/sun4u/sparc64/ \
-	    -e s/arm.*/arm/ \
-	    -e s/sa110/arm/ \
-	    -e s/powerpc/ppc/ \
-	    -e s/ppc64/ppc/ \
-	    -e s/macppc/ppc/)
-
-HOSTOS := $(shell uname -s | tr '[:upper:]' '[:lower:]' | \
-	    sed -e 's/\(cygwin\).*/cygwin/')
-
-# Set shell to bash if possible, otherwise fall back to sh
-SHELL := $(shell if [ -x "$$BASH" ]; then echo $$BASH; \
-	else if [ -x /bin/bash ]; then echo /bin/bash; \
-	else echo sh; fi; fi)
-
-export	HOSTARCH HOSTOS SHELL
-
-# Deal with colliding definitions from tcsh etc.
-VENDOR=
-
-#########################################################################
-# Allow for silent builds
-ifeq (,$(findstring s,$(MAKEFLAGS)))
-XECHO = echo
-else
-XECHO = :
-endif
-
-#########################################################################
-#
-# U-boot build supports producing a object files to the separate external
-# directory. Two use cases are supported:
-#
-# 1) Add O= to the make command line
-# 'make O=/tmp/build all'
-#
-# 2) Set environement variable BUILD_DIR to point to the desired location
-# 'export BUILD_DIR=/tmp/build'
-# 'make'
-#
-# The second approach can also be used with a MAKEALL script
-# 'export BUILD_DIR=/tmp/build'
-# './MAKEALL'
-#
-# Command line 'O=' setting overrides BUILD_DIR environent variable.
-#
-# When none of the above methods is used the local build is performed and
-# the object files are placed in the source directory.
-#
-
-ifdef O
-ifeq ("$(origin O)", "command line")
-BUILD_DIR := $(O)
-endif
-endif
-
-ifneq ($(BUILD_DIR),)
-saved-output := $(BUILD_DIR)
-
-# Attempt to create a output directory.
-$(shell [ -d ${BUILD_DIR} ] || mkdir -p ${BUILD_DIR})
-
-# Verify if it was successful.
-BUILD_DIR := $(shell cd $(BUILD_DIR) && /bin/pwd)
-$(if $(BUILD_DIR),,$(error output directory "$(saved-output)" does not exist))
-endif # ifneq ($(BUILD_DIR),)
-
-OBJTREE		:= $(if $(BUILD_DIR),$(BUILD_DIR),$(CURDIR))
-SRCTREE		:= $(CURDIR)
-TOPDIR		:= $(SRCTREE)
-LNDIR		:= $(OBJTREE)
-export	TOPDIR SRCTREE OBJTREE
-
-MKCONFIG	:= $(SRCTREE)/mkconfig
-export MKCONFIG
-
-ifneq ($(OBJTREE),$(SRCTREE))
-REMOTE_BUILD	:= 1
-export REMOTE_BUILD
-endif
-
-# $(obj) and (src) are defined in config.mk but here in main Makefile
-# we also need them before config.mk is included which is the case for
-# some targets like unconfig, clean, clobber, distclean, etc.
-ifneq ($(OBJTREE),$(SRCTREE))
-obj := $(OBJTREE)/
-src := $(SRCTREE)/
-else
-obj :=
-src :=
-endif
-export obj src
-
-# Make sure CDPATH settings don't interfere
-unexport CDPATH
-
-#########################################################################
-
-ifeq ($(ARCH),powerpc)
-ARCH = ppc
-endif
-
-# The "tools" are needed early, so put this first
-# Don't include stuff already done in $(LIBS)
-SUBDIRS	= tools \
-	  examples/standalone \
-	  examples/api
-
-.PHONY : $(SUBDIRS)
-
-ifeq ($(obj)include/config.mk,$(wildcard $(obj)include/config.mk))
-
-# Include autoconf.mk before config.mk so that the config options are available
-# to all top level build files.  We need the dummy all: target to prevent the
-# dependency target in autoconf.mk.dep from being the default.
-all:
-sinclude $(obj)include/autoconf.mk.dep
-sinclude $(obj)include/autoconf.mk
-
-# load ARCH, BOARD, and CPU configuration
-include $(obj)include/config.mk
-export	ARCH CPU BOARD VENDOR SOC
-
-# set default to nothing for native builds
-ifeq ($(HOSTARCH),$(ARCH))
-CROSS_COMPILE ?=
-endif
-
-# load other configuration
-include $(TOPDIR)/config.mk
-
-#########################################################################
-# U-Boot objects....order is important (i.e. start must be first)
-
-OBJS  = cpu/$(CPU)/start.o
-ifeq ($(CPU),i386)
-OBJS += cpu/$(CPU)/start16.o
-OBJS += cpu/$(CPU)/resetvec.o
-endif
-ifeq ($(CPU),ppc4xx)
-OBJS += cpu/$(CPU)/resetvec.o
-endif
-ifeq ($(CPU),mpc85xx)
-OBJS += cpu/$(CPU)/resetvec.o
-endif
-
-OBJS := $(addprefix $(obj),$(OBJS))
-
-LIBS  = lib_generic/libgeneric.a
-LIBS += lib_generic/lzma/liblzma.a
-LIBS += lib_generic/lzo/liblzo.a
-LIBS += $(shell if [ -f board/$(VENDOR)/common/Makefile ]; then echo \
-	"board/$(VENDOR)/common/lib$(VENDOR).a"; fi)
-LIBS += cpu/$(CPU)/lib$(CPU).a
-ifdef SOC
-LIBS += cpu/$(CPU)/$(SOC)/lib$(SOC).a
-endif
-ifeq ($(CPU),ixp)
-LIBS += cpu/ixp/npe/libnpe.a
-endif
-LIBS += lib_$(ARCH)/lib$(ARCH).a
-LIBS += fs/cramfs/libcramfs.a fs/fat/libfat.a fs/fdos/libfdos.a fs/jffs2/libjffs2.a \
-	fs/reiserfs/libreiserfs.a fs/ext2/libext2fs.a fs/yaffs2/libyaffs2.a \
-	fs/ubifs/libubifs.a
-LIBS += net/libnet.a
-LIBS += disk/libdisk.a
-LIBS += drivers/bios_emulator/libatibiosemu.a
-LIBS += drivers/block/libblock.a
-LIBS += drivers/dma/libdma.a
-LIBS += drivers/fpga/libfpga.a
-LIBS += drivers/gpio/libgpio.a
-LIBS += drivers/hwmon/libhwmon.a
-LIBS += drivers/i2c/libi2c.a
-LIBS += drivers/input/libinput.a
-LIBS += drivers/misc/libmisc.a
-LIBS += drivers/mmc/libmmc.a
-LIBS += drivers/mtd/libmtd.a
-LIBS += drivers/mtd/nand/libnand.a
-LIBS += drivers/mtd/onenand/libonenand.a
-LIBS += drivers/mtd/ubi/libubi.a
-LIBS += drivers/mtd/spi/libspi_flash.a
-LIBS += drivers/net/libnet.a
-LIBS += drivers/net/phy/libphy.a
-LIBS += drivers/net/sk98lin/libsk98lin.a
-LIBS += drivers/pci/libpci.a
-LIBS += drivers/pcmcia/libpcmcia.a
-LIBS += drivers/power/libpower.a
-LIBS += drivers/spi/libspi.a
-ifeq ($(CPU),mpc83xx)
-LIBS += drivers/qe/qe.a
-endif
-ifeq ($(CPU),mpc85xx)
-LIBS += drivers/qe/qe.a
-LIBS += cpu/mpc8xxx/ddr/libddr.a
-TAG_SUBDIRS += cpu/mpc8xxx
-endif
-ifeq ($(CPU),mpc86xx)
-LIBS += cpu/mpc8xxx/ddr/libddr.a
-TAG_SUBDIRS += cpu/mpc8xxx
-endif
-LIBS += drivers/rtc/librtc.a
-LIBS += drivers/serial/libserial.a
-LIBS += drivers/twserial/libtws.a
-LIBS += drivers/usb/gadget/libusb_gadget.a
-LIBS += drivers/usb/host/libusb_host.a
-LIBS += drivers/usb/musb/libusb_musb.a
-LIBS += drivers/video/libvideo.a
-LIBS += drivers/watchdog/libwatchdog.a
-LIBS += common/libcommon.a
-LIBS += libfdt/libfdt.a
-LIBS += api/libapi.a
-LIBS += post/libpost.a
-
-LIBS := $(addprefix $(obj),$(LIBS))
-.PHONY : $(LIBS) $(TIMESTAMP_FILE) $(VERSION_FILE)
-
-LIBBOARD = board/$(BOARDDIR)/lib$(BOARD).a
-LIBBOARD := $(addprefix $(obj),$(LIBBOARD))
-
-# Add GCC lib
-ifdef USE_PRIVATE_LIBGCC
-ifeq ("$(USE_PRIVATE_LIBGCC)", "yes")
-PLATFORM_LIBGCC = -L $(OBJTREE)/lib_$(ARCH) -lgcc
-else
-PLATFORM_LIBGCC = -L $(USE_PRIVATE_LIBGCC) -lgcc
-endif
-else
-PLATFORM_LIBGCC = -L $(shell dirname `$(CC) $(CFLAGS) -print-libgcc-file-name`) -lgcc
-endif
-PLATFORM_LIBS += $(PLATFORM_LIBGCC)
-export PLATFORM_LIBS
-
-# Special flags for CPP when processing the linker script.
-# Pass the version down so we can handle backwards compatibility
-# on the fly.
-LDPPFLAGS += \
-	-include $(TOPDIR)/include/u-boot/u-boot.lds.h \
-	$(shell $(LD) --version | \
-	  sed -ne 's/GNU ld version \([0-9][0-9]*\)\.\([0-9][0-9]*\).*/-DLD_MAJOR=\1 -DLD_MINOR=\2/p')
-
-ifeq ($(CONFIG_NAND_U_BOOT),y)
-NAND_SPL = nand_spl
-U_BOOT_NAND = $(obj)u-boot-nand.bin
-endif
-
-ifeq ($(CONFIG_ONENAND_U_BOOT),y)
-ONENAND_IPL = onenand_ipl
-U_BOOT_ONENAND = $(obj)u-boot-onenand.bin
-endif
-
-__OBJS := $(subst $(obj),,$(OBJS))
-__LIBS := $(subst $(obj),,$(LIBS)) $(subst $(obj),,$(LIBBOARD))
-
-#########################################################################
-#########################################################################
-
-# Always append ALL so that arch config.mk's can add custom ones
-ALL += $(obj)u-boot.srec $(obj)u-boot.bin $(obj)System.map $(U_BOOT_NAND) $(U_BOOT_ONENAND)
-
-all:		$(ALL)
-
-$(obj)u-boot.hex:	$(obj)u-boot
-		$(OBJCOPY) ${OBJCFLAGS} -O ihex $< $@
-
-$(obj)u-boot.srec:	$(obj)u-boot
-		$(OBJCOPY) -O srec $< $@
-
-$(obj)u-boot.bin:	$(obj)u-boot
-		$(OBJCOPY) ${OBJCFLAGS} -O binary $< $@
-
-$(obj)u-boot.ldr:	$(obj)u-boot
-		$(obj)tools/envcrc --binary > $(obj)env-ldr.o
-		$(LDR) -T $(CONFIG_BFIN_CPU) -c $@ $< $(LDR_FLAGS)
-
-$(obj)u-boot.ldr.hex:	$(obj)u-boot.ldr
-		$(OBJCOPY) ${OBJCFLAGS} -O ihex $< $@ -I binary
-
-$(obj)u-boot.ldr.srec:	$(obj)u-boot.ldr
-		$(OBJCOPY) ${OBJCFLAGS} -O srec $< $@ -I binary
-
-$(obj)u-boot.img:	$(obj)u-boot.bin
-		./tools/mkimage -A $(ARCH) -T firmware -C none \
-		-a $(TEXT_BASE) -e 0 \
-		-n $(shell sed -n -e 's/.*U_BOOT_VERSION//p' $(VERSION_FILE) | \
-			sed -e 's/"[	 ]*$$/ for $(BOARD) board"/') \
-		-d $< $@
-
-$(obj)u-boot.sha1:	$(obj)u-boot.bin
-		$(obj)tools/ubsha1 $(obj)u-boot.bin
-
-$(obj)u-boot.dis:	$(obj)u-boot
-		$(OBJDUMP) -d $< > $@
-
-GEN_UBOOT = \
-		UNDEF_SYM=`$(OBJDUMP) -x $(LIBBOARD) $(LIBS) | \
-		sed  -n -e 's/.*\($(SYM_PREFIX)__u_boot_cmd_.*\)/-u\1/p'|sort|uniq`;\
-		cd $(LNDIR) && $(LD) $(LDFLAGS) $$UNDEF_SYM $(__OBJS) \
-			--start-group $(__LIBS) --end-group $(PLATFORM_LIBS) \
-			-Map u-boot.map -o u-boot
-$(obj)u-boot:	depend $(SUBDIRS) $(OBJS) $(LIBBOARD) $(LIBS) $(LDSCRIPT) $(obj)u-boot.lds
-		$(GEN_UBOOT)
-ifeq ($(CONFIG_KALLSYMS),y)
-		smap=`$(call SYSTEM_MAP,u-boot) | \
-			awk '$$2 ~ /[tTwW]/ {printf $$1 $$3 "\\\\000"}'` ; \
-		$(CC) $(CFLAGS) -DSYSTEM_MAP="\"$${smap}\"" \
-			-c common/system_map.c -o $(obj)common/system_map.o
-		$(GEN_UBOOT) $(obj)common/system_map.o
-endif
-
-$(OBJS):	depend
-		$(MAKE) -C cpu/$(CPU) $(if $(REMOTE_BUILD),$@,$(notdir $@))
-
-$(LIBS):	depend $(SUBDIRS)
-		$(MAKE) -C $(dir $(subst $(obj),,$@))
-
-$(LIBBOARD):	depend $(LIBS)
-		$(MAKE) -C $(dir $(subst $(obj),,$@))
-
-$(SUBDIRS):	depend
-		$(MAKE) -C $@ all
-
-$(LDSCRIPT):	depend
-		$(MAKE) -C $(dir $@) $(notdir $@)
-
-$(obj)u-boot.lds: $(LDSCRIPT)
-		$(CPP) $(CPPFLAGS) $(LDPPFLAGS) -ansi -D__ASSEMBLY__ -P - <$^ >$@
-
-$(NAND_SPL):	$(TIMESTAMP_FILE) $(VERSION_FILE) $(obj)include/autoconf.mk
-		$(MAKE) -C nand_spl/board/$(BOARDDIR) all
-
-$(U_BOOT_NAND):	$(NAND_SPL) $(obj)u-boot.bin
-		cat $(obj)nand_spl/u-boot-spl-16k.bin $(obj)u-boot.bin > $(obj)u-boot-nand.bin
-
-$(ONENAND_IPL):	$(TIMESTAMP_FILE) $(VERSION_FILE) $(obj)include/autoconf.mk
-		$(MAKE) -C onenand_ipl/board/$(BOARDDIR) all
-
-$(U_BOOT_ONENAND):	$(ONENAND_IPL) $(obj)u-boot.bin
-		cat $(obj)onenand_ipl/onenand-ipl-2k.bin $(obj)u-boot.bin > $(obj)u-boot-onenand.bin
-		cat $(obj)onenand_ipl/onenand-ipl-4k.bin $(obj)u-boot.bin > $(obj)u-boot-flexonenand.bin
-
-$(VERSION_FILE):
-		@( printf '#define U_BOOT_VERSION "U-Boot %s%s"\n' "$(U_BOOT_VERSION)" \
-		 '$(shell $(TOPDIR)/tools/setlocalversion $(TOPDIR))' ) > $@.tmp
-		@cmp -s $@ $@.tmp && rm -f $@.tmp || mv -f $@.tmp $@
-
-$(TIMESTAMP_FILE):
-		@date +'#define U_BOOT_DATE "%b %d %C%y"' > $@
-		@date +'#define U_BOOT_TIME "%T"' >> $@
-
-gdbtools:
-		$(MAKE) -C tools/gdb all || exit 1
-
-updater:
-		$(MAKE) -C tools/updater all || exit 1
-
-env:
-		$(MAKE) -C tools/env all MTD_VERSION=${MTD_VERSION} || exit 1
-
-depend dep:	$(TIMESTAMP_FILE) $(VERSION_FILE) $(obj)include/autoconf.mk
-		for dir in $(SUBDIRS) ; do $(MAKE) -C $$dir _depend ; done
-
-TAG_SUBDIRS += include
-TAG_SUBDIRS += lib_generic board/$(BOARDDIR)
-TAG_SUBDIRS += cpu/$(CPU)
-TAG_SUBDIRS += lib_$(ARCH)
-TAG_SUBDIRS += fs/cramfs
-TAG_SUBDIRS += fs/fat
-TAG_SUBDIRS += fs/fdos
-TAG_SUBDIRS += fs/jffs2
-TAG_SUBDIRS += fs/yaffs2
-TAG_SUBDIRS += net
-TAG_SUBDIRS += disk
-TAG_SUBDIRS += common
-TAG_SUBDIRS += drivers/bios_emulator
-TAG_SUBDIRS += drivers/block
-TAG_SUBDIRS += drivers/gpio
-TAG_SUBDIRS += drivers/hwmon
-TAG_SUBDIRS += drivers/i2c
-TAG_SUBDIRS += drivers/input
-TAG_SUBDIRS += drivers/misc
-TAG_SUBDIRS += drivers/mmc
-TAG_SUBDIRS += drivers/mtd
-TAG_SUBDIRS += drivers/mtd/nand
-TAG_SUBDIRS += drivers/mtd/onenand
-TAG_SUBDIRS += drivers/mtd/spi
-TAG_SUBDIRS += drivers/net
-TAG_SUBDIRS += drivers/net/sk98lin
-TAG_SUBDIRS += drivers/pci
-TAG_SUBDIRS += drivers/pcmcia
-TAG_SUBDIRS += drivers/qe
-TAG_SUBDIRS += drivers/rtc
-TAG_SUBDIRS += drivers/serial
-TAG_SUBDIRS += drivers/spi
-TAG_SUBDIRS += drivers/usb
-TAG_SUBDIRS += drivers/video
-
-tags ctags:
-		ctags -w -o $(obj)ctags `find $(SUBDIRS) $(TAG_SUBDIRS) \
-						-name '*.[ch]' -print`
-
-etags:
-		etags -a -o $(obj)etags `find $(SUBDIRS) $(TAG_SUBDIRS) \
-						-name '*.[ch]' -print`
-cscope:
-		find $(SUBDIRS) $(TAG_SUBDIRS) -name '*.[ch]' -print \
-						> cscope.files
-		cscope -b -q -k
-
-SYSTEM_MAP = \
-		$(NM) $1 | \
-		grep -v '\(compiled\)\|\(\.o$$\)\|\( [aUw] \)\|\(\.\.ng$$\)\|\(LASH[RL]DI\)' | \
-		LC_ALL=C sort
-$(obj)System.map:	$(obj)u-boot
-		@$(call SYSTEM_MAP,$<) > $(obj)System.map
-
-#
-# Auto-generate the autoconf.mk file (which is included by all makefiles)
-#
-# This target actually generates 2 files; autoconf.mk and autoconf.mk.dep.
-# the dep file is only include in this top level makefile to determine when
-# to regenerate the autoconf.mk file.
-$(obj)include/autoconf.mk.dep: $(obj)include/config.h include/common.h
-	@$(XECHO) Generating $@ ; \
-	set -e ; \
-	: Generate the dependancies ; \
-	$(CC) -x c -DDO_DEPS_ONLY -M $(HOSTCFLAGS) $(CPPFLAGS) \
-		-MQ $(obj)include/autoconf.mk include/common.h > $@
-
-$(obj)include/autoconf.mk: $(obj)include/config.h
-	@$(XECHO) Generating $@ ; \
-	set -e ; \
-	: Extract the config macros ; \
-	$(CPP) $(CFLAGS) -DDO_DEPS_ONLY -dM include/common.h | \
-		sed -n -f tools/scripts/define2mk.sed > $@.tmp && \
-	mv $@.tmp $@
-
-#########################################################################
-else	# !config.mk
-all $(obj)u-boot.hex $(obj)u-boot.srec $(obj)u-boot.bin \
-$(obj)u-boot.img $(obj)u-boot.dis $(obj)u-boot \
-$(SUBDIRS) $(TIMESTAMP_FILE) $(VERSION_FILE) gdbtools updater env depend \
-dep tags ctags etags cscope $(obj)System.map:
-	@echo "System not configured - see README" >&2
-	@ exit 1
-endif	# config.mk
-
-.PHONY : CHANGELOG
-CHANGELOG:
-	git log --no-merges U-Boot-1_1_5.. | \
-	unexpand -a | sed -e 's/\s\s*$$//' > $@
-
-include/license.h: tools/bin2header COPYING
-	 cat COPYING | gzip -9 -c | ./tools/bin2header license_gzip > include/license.h
-#########################################################################
-
-unconfig:
-	@rm -f $(obj)include/config.h $(obj)include/config.mk \
-		$(obj)board/*/config.tmp $(obj)board/*/*/config.tmp \
-		$(obj)include/autoconf.mk $(obj)include/autoconf.mk.dep
-
-#========================================================================
-# PowerPC
-#========================================================================
-
-#########################################################################
-## MPC5xx Systems
-#########################################################################
-
-canmb_config:	unconfig
-	@$(MKCONFIG) -a canmb ppc mpc5xxx canmb
-
-cmi_mpc5xx_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc5xx cmi
-
-PATI_config:		unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc5xx pati mpl
-
-#########################################################################
-## MPC5xxx Systems
-#########################################################################
-
-aev_config: unconfig
-	@$(MKCONFIG) -a aev ppc mpc5xxx tqm5200 tqc
-
-BC3450_config:	unconfig
-	@$(MKCONFIG) -a BC3450 ppc mpc5xxx bc3450
-
-cm5200_config:	unconfig
-	@$(MKCONFIG) -a cm5200 ppc mpc5xxx cm5200
-
-cpci5200_config:  unconfig
-	@$(MKCONFIG) -a cpci5200  ppc mpc5xxx cpci5200 esd
-
-digsy_mtc_config \
-digsy_mtc_LOWBOOT_config	\
-digsy_mtc_RAMBOOT_config:	unconfig
-	@mkdir -p $(obj)include
-	@mkdir -p $(obj)board/digsy_mtc
-	@ >$(obj)include/config.h
-	@[ -z "$(findstring LOWBOOT_,$@)" ] || \
-		{ echo "TEXT_BASE = 0xFF000000" >$(obj)board/digsy_mtc/config.tmp ; \
-		  echo "... with LOWBOOT configuration" ; \
-		}
-	@[ -z "$(findstring RAMBOOT_,$@)" ] || \
-		{ echo "TEXT_BASE = 0x00100000" >$(obj)board/digsy_mtc/config.tmp ; \
-		  echo "... with RAMBOOT configuration" ; \
-		}
-	@$(MKCONFIG) -a digsy_mtc  ppc mpc5xxx digsy_mtc
-
-hmi1001_config:	unconfig
-	@$(MKCONFIG) hmi1001 ppc mpc5xxx hmi1001
-
-Lite5200_config				\
-Lite5200_LOWBOOT_config			\
-Lite5200_LOWBOOT08_config		\
-icecube_5200_config			\
-icecube_5200_LOWBOOT_config		\
-icecube_5200_LOWBOOT08_config		\
-icecube_5200_DDR_config			\
-icecube_5200_DDR_LOWBOOT_config		\
-icecube_5200_DDR_LOWBOOT08_config	\
-icecube_5100_config:			unconfig
-	@mkdir -p $(obj)include
-	@mkdir -p $(obj)board/icecube
-	@[ -z "$(findstring LOWBOOT_,$@)" ] || \
-		{ if [ "$(findstring DDR,$@)" ] ; \
-			then echo "TEXT_BASE = 0xFF800000" >$(obj)board/icecube/config.tmp ; \
-			else echo "TEXT_BASE = 0xFF000000" >$(obj)board/icecube/config.tmp ; \
-		  fi ; \
-		  $(XECHO) "... with LOWBOOT configuration" ; \
-		}
-	@[ -z "$(findstring LOWBOOT08,$@)" ] || \
-		{ echo "TEXT_BASE = 0xFF800000" >$(obj)board/icecube/config.tmp ; \
-		  echo "... with 8 MB flash only" ; \
-		  $(XECHO) "... with LOWBOOT configuration" ; \
-		}
-	@[ -z "$(findstring DDR,$@)" ] || \
-		{ echo "#define CONFIG_MPC5200_DDR"	>>$(obj)include/config.h ; \
-		  $(XECHO) "... DDR memory revision" ; \
-		}
-	@[ -z "$(findstring 5200,$@)" ] || \
-		{ echo "#define CONFIG_MPC5200"		>>$(obj)include/config.h ; \
-		  $(XECHO) "... with MPC5200 processor" ; \
-		}
-	@[ -z "$(findstring 5100,$@)" ] || \
-		{ echo "#define CONFIG_MGT5100"		>>$(obj)include/config.h ; \
-		  $(XECHO) "... with MGT5100 processor" ; \
-		}
-	@$(MKCONFIG) -a IceCube ppc mpc5xxx icecube
-
-jupiter_config:	unconfig
-	@$(MKCONFIG) jupiter ppc mpc5xxx jupiter
-
-inka4x0_config:	unconfig
-	@$(MKCONFIG) inka4x0 ppc mpc5xxx inka4x0
-
-lite5200b_config	\
-lite5200b_PM_config	\
-lite5200b_LOWBOOT_config:	unconfig
-	@mkdir -p $(obj)include
-	@mkdir -p $(obj)board/icecube
-	@ echo "#define CONFIG_MPC5200_DDR"	>>$(obj)include/config.h
-	@ $(XECHO) "... DDR memory revision"
-	@ echo "#define CONFIG_MPC5200"		>>$(obj)include/config.h
-	@ echo "#define CONFIG_LITE5200B"	>>$(obj)include/config.h
-	@[ -z "$(findstring _PM_,$@)" ] || \
-		{ echo "#define CONFIG_LITE5200B_PM"	>>$(obj)include/config.h ; \
-		  $(XECHO) "... with power management (low-power mode) support" ; \
-		}
-	@[ -z "$(findstring LOWBOOT_,$@)" ] || \
-		{ echo "TEXT_BASE = 0xFF000000" >$(obj)board/icecube/config.tmp ; \
-		  $(XECHO) "... with LOWBOOT configuration" ; \
-		}
-	@ $(XECHO) "... with MPC5200B processor"
-	@$(MKCONFIG) -a IceCube  ppc mpc5xxx icecube
-
-mcc200_config	\
-mcc200_SDRAM_config	\
-mcc200_highboot_config	\
-mcc200_COM12_config	\
-mcc200_COM12_SDRAM_config	\
-mcc200_COM12_highboot_config	\
-mcc200_COM12_highboot_SDRAM_config	\
-mcc200_highboot_SDRAM_config	\
-prs200_config	\
-prs200_DDR_config	\
-prs200_highboot_config	\
-prs200_highboot_DDR_config:	unconfig
-	@mkdir -p $(obj)include
-	@mkdir -p $(obj)board/mcc200
-	@[ -n "$(findstring highboot,$@)" ] || \
-		{ $(XECHO) "... with lowboot configuration" ; \
-		}
-	@[ -z "$(findstring highboot,$@)" ] || \
-		{ echo "TEXT_BASE = 0xFFF00000" >$(obj)board/mcc200/config.tmp ; \
-		  $(XECHO) "... with highboot configuration" ; \
-		}
-	@[ -n "$(findstring _SDRAM,$@)" ] || \
-		{ if [ -n "$(findstring mcc200,$@)" ]; \
-		  then \
-			$(XECHO) "... with DDR" ; \
-		  else \
-			if [ -n "$(findstring _DDR,$@)" ];\
-			then \
-				$(XECHO) "... with DDR" ; \
-			else \
-				echo "#define CONFIG_MCC200_SDRAM" >>$(obj)include/config.h ;\
-				$(XECHO) "... with SDRAM" ; \
-			fi; \
-		  fi; \
-		}
-	@[ -z "$(findstring _SDRAM,$@)" ] || \
-		{ echo "#define CONFIG_MCC200_SDRAM"	>>$(obj)include/config.h ; \
-		  $(XECHO) "... with SDRAM" ; \
-		}
-	@[ -z "$(findstring COM12,$@)" ] || \
-		{ echo "#define CONFIG_CONSOLE_COM12"	>>$(obj)include/config.h ; \
-		  $(XECHO) "... with console on COM12" ; \
-		}
-	@[ -z "$(findstring prs200,$@)" ] || \
-		{ echo "#define CONFIG_PRS200"	>>$(obj)include/config.h ;\
-		}
-	@$(MKCONFIG) -n $@ -a mcc200 ppc mpc5xxx mcc200
-
-mecp5200_config:  unconfig
-	@$(MKCONFIG) mecp5200  ppc mpc5xxx mecp5200 esd
-
-motionpro_config:	unconfig
-	@$(MKCONFIG) motionpro ppc mpc5xxx motionpro
-
-mucmc52_config:		unconfig
-	@$(MKCONFIG) mucmc52 ppc mpc5xxx mucmc52
-
-munices_config:	unconfig
-	@$(MKCONFIG) munices ppc mpc5xxx munices
-
-MVBC_P_config: unconfig
-	@mkdir -p $(obj)include
-	@mkdir -p $(obj)board/mvbc_p
-	@ >$(obj)include/config.h
-	@[ -z "$(findstring MVBC_P,$@)" ] || \
-	{   	echo "#define CONFIG_MVBC_P" 	>>$(obj)include/config.h; }
-	@$(MKCONFIG) -n $@ -a MVBC_P ppc mpc5xxx mvbc_p matrix_vision
-
-o2dnt_config:	unconfig
-	@$(MKCONFIG) o2dnt ppc mpc5xxx o2dnt
-
-pcm030_config \
-pcm030_LOWBOOT_config:	unconfig
-	@mkdir -p $(obj)include $(obj)board/phytec/pcm030
-	@ >$(obj)include/config.h
-	@[ -z "$(findstring LOWBOOT_,$@)" ] || \
-		{ echo "TEXT_BASE = 0xFF000000"	>$(obj)board/phytec/pcm030/config.tmp ; \
-		  echo "... with LOWBOOT configuration" ; \
-		}
-	@$(MKCONFIG) -a pcm030 ppc mpc5xxx pcm030 phytec
-
-pf5200_config:	unconfig
-	@$(MKCONFIG) pf5200  ppc mpc5xxx pf5200 esd
-
-PM520_config \
-PM520_DDR_config \
-PM520_ROMBOOT_config \
-PM520_ROMBOOT_DDR_config:	unconfig
-	@mkdir -p $(obj)include
-	@[ -z "$(findstring DDR,$@)" ] || \
-		{ echo "#define CONFIG_MPC5200_DDR"	>>$(obj)include/config.h ; \
-		  $(XECHO) "... DDR memory revision" ; \
-		}
-	@[ -z "$(findstring ROMBOOT,$@)" ] || \
-		{ echo "#define CONFIG_BOOT_ROM" >>$(obj)include/config.h ; \
-		  $(XECHO) "... booting from 8-bit flash" ; \
-		}
-	@$(MKCONFIG) -a PM520 ppc mpc5xxx pm520
-
-smmaco4_config: unconfig
-	@$(MKCONFIG) -a smmaco4 ppc mpc5xxx tqm5200 tqc
-
-spieval_config:	unconfig
-	@$(MKCONFIG) -a spieval ppc mpc5xxx tqm5200 tqc
-
-TB5200_B_config \
-TB5200_config:	unconfig
-	@mkdir -p $(obj)include
-	@[ -z "$(findstring _B,$@)" ] || \
-		{ echo "#define CONFIG_TQM5200_B"	>>$(obj)include/config.h ; \
-		  $(XECHO) "... with MPC5200B processor" ; \
-		}
-	@$(MKCONFIG) -n $@ -a TB5200 ppc mpc5xxx tqm5200 tqc
-
-MINI5200_config	\
-EVAL5200_config	\
-TOP5200_config:	unconfig
-	@mkdir -p $(obj)include
-	@ echo "#define CONFIG_$(@:_config=) 1"	>$(obj)include/config.h
-	@$(MKCONFIG) -n $@ -a TOP5200 ppc mpc5xxx top5200 emk
-
-Total5100_config		\
-Total5200_config		\
-Total5200_lowboot_config	\
-Total5200_Rev2_config		\
-Total5200_Rev2_lowboot_config:	unconfig
-	@mkdir -p $(obj)include
-	@mkdir -p $(obj)board/total5200
-	@[ -z "$(findstring 5100,$@)" ] || \
-		{ echo "#define CONFIG_MGT5100"		>>$(obj)include/config.h ; \
-		  $(XECHO) "... with MGT5100 processor" ; \
-		}
-	@[ -z "$(findstring 5200,$@)" ] || \
-		{ echo "#define CONFIG_MPC5200"		>>$(obj)include/config.h ; \
-		  $(XECHO) "... with MPC5200 processor" ; \
-		}
-	@[ -n "$(findstring Rev,$@)" ] || \
-		{ echo "#define CONFIG_TOTAL5200_REV 1"	>>$(obj)include/config.h ; \
-		  $(XECHO) "... revision 1 board" ; \
-		}
-	@[ -z "$(findstring Rev2_,$@)" ] || \
-		{ echo "#define CONFIG_TOTAL5200_REV 2"	>>$(obj)include/config.h ; \
-		  $(XECHO) "... revision 2 board" ; \
-		}
-	@[ -z "$(findstring lowboot_,$@)" ] || \
-		{ echo "TEXT_BASE = 0xFE000000" >$(obj)board/total5200/config.tmp ; \
-		  $(XECHO) "... with lowboot configuration" ; \
-		}
-	@$(MKCONFIG) -a Total5200 ppc mpc5xxx total5200
-
-cam5200_config \
-cam5200_niosflash_config \
-fo300_config \
-MiniFAP_config \
-TQM5200S_config \
-TQM5200S_HIGHBOOT_config \
-TQM5200_B_config \
-TQM5200_B_HIGHBOOT_config \
-TQM5200_config	\
-TQM5200_STK100_config:	unconfig
-	@mkdir -p $(obj)include
-	@mkdir -p $(obj)board/tqc/tqm5200
-	@[ -z "$(findstring cam5200,$@)" ] || \
-		{ echo "#define CONFIG_CAM5200"	>>$(obj)include/config.h ; \
-		  echo "#define CONFIG_TQM5200S"	>>$(obj)include/config.h ; \
-		  echo "#define CONFIG_TQM5200_B"	>>$(obj)include/config.h ; \
-		  $(XECHO) "... TQM5200S on Cam5200" ; \
-		}
-	@[ -z "$(findstring niosflash,$@)" ] || \
-		{ echo "#define CONFIG_CAM5200_NIOSFLASH"	>>$(obj)include/config.h ; \
-		  $(XECHO) "... with NIOS flash driver" ; \
-		}
-	@[ -z "$(findstring fo300,$@)" ] || \
-		{ echo "#define CONFIG_FO300"	>>$(obj)include/config.h ; \
-		  $(XECHO) "... TQM5200 on FO300" ; \
-		}
-	@[ -z "$(findstring MiniFAP,$@)" ] || \
-		{ echo "#define CONFIG_MINIFAP"	>>$(obj)include/config.h ; \
-		  $(XECHO) "... TQM5200_AC on MiniFAP" ; \
-		}
-	@[ -z "$(findstring STK100,$@)" ] || \
-		{ echo "#define CONFIG_STK52XX_REV100"	>>$(obj)include/config.h ; \
-		  $(XECHO) "... on a STK52XX.100 base board" ; \
-		}
-	@[ -z "$(findstring TQM5200_B,$@)" ] || \
-		{ echo "#define CONFIG_TQM5200_B"	>>$(obj)include/config.h ; \
-		}
-	@[ -z "$(findstring TQM5200S,$@)" ] || \
-		{ echo "#define CONFIG_TQM5200S"	>>$(obj)include/config.h ; \
-		  echo "#define CONFIG_TQM5200_B"	>>$(obj)include/config.h ; \
-		}
-	@[ -z "$(findstring HIGHBOOT,$@)" ] || \
-		{ echo "TEXT_BASE = 0xFFF00000" >$(obj)board/tqm5200/config.tmp ; \
-		}
-	@$(MKCONFIG) -n $@ -a TQM5200 ppc mpc5xxx tqm5200 tqc
-
-uc101_config:		unconfig
-	@$(MKCONFIG) uc101 ppc mpc5xxx uc101
-
-v38b_config: unconfig
-	@$(MKCONFIG) -a v38b ppc mpc5xxx v38b
-
-#########################################################################
-## MPC512x Systems
-#########################################################################
-
-aria_config:	unconfig
-	@$(MKCONFIG) -a aria ppc mpc512x aria davedenx
-
-mecp5123_config:	unconfig
-	@$(MKCONFIG) -a mecp5123 ppc mpc512x mecp5123 esd
-
-mpc5121ads_config \
-mpc5121ads_rev2_config	\
-	: unconfig
-	@mkdir -p $(obj)include
-	@if [ "$(findstring rev2,$@)" ] ; then \
-		echo "#define CONFIG_ADS5121_REV2 1" > $(obj)include/config.h; \
-	fi
-	@$(MKCONFIG) -a mpc5121ads ppc mpc512x mpc5121ads freescale
-
-#########################################################################
-## MPC8xx Systems
-#########################################################################
-
-Adder_config	\
-Adder87x_config \
-AdderII_config	\
-	:		unconfig
-	@mkdir -p $(obj)include
-	$(if $(findstring AdderII,$@), \
-	@echo "#define CONFIG_MPC852T" > $(obj)include/config.h)
-	@$(MKCONFIG) -a Adder ppc mpc8xx adder
-
-AdderUSB_config:	unconfig
-	@$(MKCONFIG) -a AdderUSB ppc mpc8xx adder
-
-ADS860_config	  \
-FADS823_config	  \
-FADS850SAR_config \
-MPC86xADS_config  \
-MPC885ADS_config  \
-FADS860T_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx fads
-
-AMX860_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx amx860 westel
-
-c2mon_config:		unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx c2mon
-
-CCM_config:		unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx CCM siemens
-
-cogent_mpc8xx_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx cogent
-
-ELPT860_config:		unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx elpt860 LEOX
-
-EP88x_config:		unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx ep88x
-
-ESTEEM192E_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx esteem192e
-
-ETX094_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx etx094
-
-FLAGADM_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx flagadm
-
-xtract_GEN860T = $(subst _SC,,$(subst _config,,$1))
-
-GEN860T_SC_config	\
-GEN860T_config: unconfig
-	@mkdir -p $(obj)include
-	@[ -z "$(findstring _SC,$@)" ] || \
-		{ echo "#define CONFIG_SC" >>$(obj)include/config.h ; \
-		  $(XECHO) "With reduced H/W feature set (SC)..." ; \
-		}
-	@$(MKCONFIG) -a $(call xtract_GEN860T,$@) ppc mpc8xx gen860t
-
-GENIETV_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx genietv
-
-GTH_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx gth
-
-hermes_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx hermes
-
-HMI10_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx tqm8xx tqc
-
-IAD210_config: unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx IAD210 siemens
-
-xtract_ICU862 = $(subst _100MHz,,$(subst _config,,$1))
-
-ICU862_100MHz_config	\
-ICU862_config: unconfig
-	@mkdir -p $(obj)include
-	@[ -z "$(findstring _100MHz,$@)" ] || \
-		{ echo "#define CONFIG_100MHz"	>>$(obj)include/config.h ; \
-		  $(XECHO) "... with 100MHz system clock" ; \
-		}
-	@$(MKCONFIG) -a $(call xtract_ICU862,$@) ppc mpc8xx icu862
-
-IP860_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx ip860
-
-IVML24_256_config \
-IVML24_128_config \
-IVML24_config:	unconfig
-	@mkdir -p $(obj)include
-	@[ -z "$(findstring IVML24_config,$@)" ] || \
-		 { echo "#define CONFIG_IVML24_16M"	>>$(obj)include/config.h ; \
-		 }
-	@[ -z "$(findstring IVML24_128_config,$@)" ] || \
-		 { echo "#define CONFIG_IVML24_32M"	>>$(obj)include/config.h ; \
-		 }
-	@[ -z "$(findstring IVML24_256_config,$@)" ] || \
-		 { echo "#define CONFIG_IVML24_64M"	>>$(obj)include/config.h ; \
-		 }
-	@$(MKCONFIG) -a IVML24 ppc mpc8xx ivm
-
-IVMS8_256_config \
-IVMS8_128_config \
-IVMS8_config:	unconfig
-	@mkdir -p $(obj)include
-	@[ -z "$(findstring IVMS8_config,$@)" ] || \
-		 { echo "#define CONFIG_IVMS8_16M"	>>$(obj)include/config.h ; \
-		 }
-	@[ -z "$(findstring IVMS8_128_config,$@)" ] || \
-		 { echo "#define CONFIG_IVMS8_32M"	>>$(obj)include/config.h ; \
-		 }
-	@[ -z "$(findstring IVMS8_256_config,$@)" ] || \
-		 { echo "#define CONFIG_IVMS8_64M"	>>$(obj)include/config.h ; \
-		 }
-	@$(MKCONFIG) -a IVMS8 ppc mpc8xx ivm
-
-kmsupx4_config:		unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx km8xx keymile
-
-KUP4K_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx kup4k kup
-
-KUP4X_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx kup4x kup
-
-LANTEC_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx lantec
-
-lwmon_config:		unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx lwmon
-
-MBX_config	\
-MBX860T_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx mbx8xx
-
-mgsuvd_config:		unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx km8xx keymile
-
-MHPC_config:		unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx mhpc eltec
-
-xtract_NETVIA = $(subst _V2,,$(subst _config,,$1))
-
-NETVIA_V2_config \
-NETVIA_config:		unconfig
-	@mkdir -p $(obj)include
-	@[ -z "$(findstring NETVIA_config,$@)" ] || \
-		 { echo "#define CONFIG_NETVIA_VERSION 1" >>$(obj)include/config.h ; \
-		  $(XECHO) "... Version 1" ; \
-		 }
-	@[ -z "$(findstring NETVIA_V2_config,$@)" ] || \
-		 { echo "#define CONFIG_NETVIA_VERSION 2" >>$(obj)include/config.h ; \
-		  $(XECHO) "... Version 2" ; \
-		 }
-	@$(MKCONFIG) -a $(call xtract_NETVIA,$@) ppc mpc8xx netvia
-
-xtract_NETPHONE = $(subst _V2,,$(subst _config,,$1))
-
-NETPHONE_V2_config \
-NETPHONE_config:	unconfig
-	@mkdir -p $(obj)include
-	@[ -z "$(findstring NETPHONE_config,$@)" ] || \
-		 { echo "#define CONFIG_NETPHONE_VERSION 1" >>$(obj)include/config.h ; \
-		 }
-	@[ -z "$(findstring NETPHONE_V2_config,$@)" ] || \
-		 { echo "#define CONFIG_NETPHONE_VERSION 2" >>$(obj)include/config.h ; \
-		 }
-	@$(MKCONFIG) -a $(call xtract_NETPHONE,$@) ppc mpc8xx netphone
-
-xtract_NETTA = $(subst _SWAPHOOK,,$(subst _6412,,$(subst _ISDN,,$(subst _config,,$1))))
-
-NETTA_ISDN_6412_SWAPHOOK_config \
-NETTA_ISDN_SWAPHOOK_config \
-NETTA_6412_SWAPHOOK_config \
-NETTA_SWAPHOOK_config \
-NETTA_ISDN_6412_config \
-NETTA_ISDN_config \
-NETTA_6412_config \
-NETTA_config:		unconfig
-	@mkdir -p $(obj)include
-	@[ -z "$(findstring ISDN_,$@)" ] || \
-		 { echo "#define CONFIG_NETTA_ISDN 1" >>$(obj)include/config.h ; \
-		 }
-	@[ -n "$(findstring ISDN_,$@)" ] || \
-		 { echo "#undef CONFIG_NETTA_ISDN" >>$(obj)include/config.h ; \
-		 }
-	@[ -z "$(findstring 6412_,$@)" ] || \
-		 { echo "#define CONFIG_NETTA_6412 1" >>$(obj)include/config.h ; \
-		 }
-	@[ -n "$(findstring 6412_,$@)" ] || \
-		 { echo "#undef CONFIG_NETTA_6412" >>$(obj)include/config.h ; \
-		 }
-	@[ -z "$(findstring SWAPHOOK_,$@)" ] || \
-		 { echo "#define CONFIG_NETTA_SWAPHOOK 1" >>$(obj)include/config.h ; \
-		 }
-	@[ -n "$(findstring SWAPHOOK_,$@)" ] || \
-		 { echo "#undef CONFIG_NETTA_SWAPHOOK" >>$(obj)include/config.h ; \
-		 }
-	@$(MKCONFIG) -a $(call xtract_NETTA,$@) ppc mpc8xx netta
-
-xtract_NETTA2 = $(subst _V2,,$(subst _config,,$1))
-
-NETTA2_V2_config \
-NETTA2_config:		unconfig
-	@mkdir -p $(obj)include
-	@[ -z "$(findstring NETTA2_config,$@)" ] || \
-		 { echo "#define CONFIG_NETTA2_VERSION 1" >>$(obj)include/config.h ; \
-		 }
-	@[ -z "$(findstring NETTA2_V2_config,$@)" ] || \
-		 { echo "#define CONFIG_NETTA2_VERSION 2" >>$(obj)include/config.h ; \
-		 }
-	@$(MKCONFIG) -a $(call xtract_NETTA2,$@) ppc mpc8xx netta2
-
-NC650_Rev1_config \
-NC650_Rev2_config \
-CP850_config:	unconfig
-	@mkdir -p $(obj)include
-	@[ -z "$(findstring CP850,$@)" ] || \
-		 { echo "#define CONFIG_CP850 1" >>$(obj)include/config.h ; \
-		   echo "#define CONFIG_IDS852_REV2 1" >>$(obj)include/config.h ; \
-		 }
-	@[ -z "$(findstring Rev1,$@)" ] || \
-		 { echo "#define CONFIG_IDS852_REV1 1" >>$(obj)include/config.h ; \
-		 }
-	@[ -z "$(findstring Rev2,$@)" ] || \
-		 { echo "#define CONFIG_IDS852_REV2 1" >>$(obj)include/config.h ; \
-		 }
-	@$(MKCONFIG) -a NC650 ppc mpc8xx nc650
-
-NX823_config:		unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx nx823
-
-pcu_e_config:		unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx pcu_e siemens
-
-QS850_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx qs850 snmc
-
-QS823_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx qs850 snmc
-
-QS860T_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx qs860t snmc
-
-quantum_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx quantum
-
-R360MPI_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx r360mpi
-
-RBC823_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx rbc823
-
-RPXClassic_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx RPXClassic
-
-RPXlite_config:		unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx RPXlite
-
-RPXlite_DW_64_config		\
-RPXlite_DW_LCD_config		\
-RPXlite_DW_64_LCD_config	\
-RPXlite_DW_NVRAM_config		\
-RPXlite_DW_NVRAM_64_config	\
-RPXlite_DW_NVRAM_LCD_config	\
-RPXlite_DW_NVRAM_64_LCD_config	\
-RPXlite_DW_config:	unconfig
-	@mkdir -p $(obj)include
-	@[ -z "$(findstring _64,$@)" ] || \
-		{ echo "#define RPXlite_64MHz"		>>$(obj)include/config.h ; \
-		  $(XECHO) "... with 64MHz system clock ..."; \
-		}
-	@[ -z "$(findstring _LCD,$@)" ] || \
-		{ echo "#define CONFIG_LCD"		>>$(obj)include/config.h ; \
-		  echo "#define CONFIG_NEC_NL6448BC20"	>>$(obj)include/config.h ; \
-		  $(XECHO) "... with LCD display ..."; \
-		}
-	@[ -z "$(findstring _NVRAM,$@)" ] || \
-		{ echo "#define  CONFIG_ENV_IS_IN_NVRAM"	>>$(obj)include/config.h ; \
-		  $(XECHO) "... with ENV in NVRAM ..."; \
-		}
-	@$(MKCONFIG) -a RPXlite_DW ppc mpc8xx RPXlite_dw
-
-rmu_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx rmu
-
-RRvision_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx RRvision
-
-RRvision_LCD_config:	unconfig
-	@mkdir -p $(obj)include
-	@echo "#define CONFIG_LCD" >$(obj)include/config.h
-	@echo "#define CONFIG_SHARP_LQ104V7DS01" >>$(obj)include/config.h
-	@$(MKCONFIG) -a RRvision ppc mpc8xx RRvision
-
-SM850_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx tqm8xx tqc
-
-spc1920_config:		unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx spc1920
-
-SPD823TS_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx spd8xx
-
-stxxtc_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx stxxtc
-
-svm_sc8xx_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx svm_sc8xx
-
-SXNI855T_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx sixnet
-
-# EMK MPC8xx based modules
-TOP860_config:		unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx top860 emk
-
-# Play some tricks for configuration selection
-# Only 855 and 860 boards may come with FEC
-# and only 823 boards may have LCD support
-xtract_8xx = $(subst _LCD,,$(subst _config,,$1))
-
-FPS850L_config		\
-FPS860L_config		\
-NSCU_config		\
-TQM823L_config		\
-TQM823L_LCD_config	\
-TQM850L_config		\
-TQM855L_config		\
-TQM860L_config		\
-TQM862L_config		\
-TQM823M_config		\
-TQM850M_config		\
-TQM855M_config		\
-TQM860M_config		\
-TQM862M_config		\
-TQM866M_config		\
-TQM885D_config		\
-TK885D_config		\
-virtlab2_config:	unconfig
-	@mkdir -p $(obj)include
-	@[ -z "$(findstring _LCD,$@)" ] || \
-		{ echo "#define CONFIG_LCD"		>>$(obj)include/config.h ; \
-		  echo "#define CONFIG_NEC_NL6448BC20"	>>$(obj)include/config.h ; \
-		  $(XECHO) "... with LCD display" ; \
-		}
-	@$(MKCONFIG) -a $(call xtract_8xx,$@) ppc mpc8xx tqm8xx tqc
-
-TTTech_config:	unconfig
-	@mkdir -p $(obj)include
-	@echo "#define CONFIG_LCD" >$(obj)include/config.h
-	@echo "#define CONFIG_SHARP_LQ104V7DS01" >>$(obj)include/config.h
-	@$(MKCONFIG) -a TQM823L ppc mpc8xx tqm8xx tqc
-
-uc100_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx uc100
-
-v37_config:	unconfig
-	@mkdir -p $(obj)include
-	@echo "#define CONFIG_LCD" >$(obj)include/config.h
-	@echo "#define CONFIG_SHARP_LQ084V1DG21" >>$(obj)include/config.h
-	@$(MKCONFIG) $(@:_config=) ppc mpc8xx v37
-
-wtk_config:	unconfig
-	@mkdir -p $(obj)include
-	@echo "#define CONFIG_LCD" >$(obj)include/config.h
-	@echo "#define CONFIG_SHARP_LQ065T9DR51U" >>$(obj)include/config.h
-	@$(MKCONFIG) -a TQM823L ppc mpc8xx tqm8xx tqc
-
-#########################################################################
-## PPC4xx Systems
-#########################################################################
-xtract_4xx = $(subst _25,,$(subst _33,,$(subst _BA,,$(subst _ME,,$(subst _HI,,$(subst _config,,$1))))))
-
-acadia_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx acadia amcc
-
-acadia_nand_config:	unconfig
-	@mkdir -p $(obj)include $(obj)board/amcc/acadia
-	@mkdir -p $(obj)nand_spl/board/amcc/acadia
-	@echo "#define CONFIG_NAND_U_BOOT" > $(obj)include/config.h
-	@$(MKCONFIG) -n $@ -a acadia ppc ppc4xx acadia amcc
-	@echo "TEXT_BASE = 0x01000000" > $(obj)board/amcc/acadia/config.tmp
-	@echo "CONFIG_NAND_U_BOOT = y" >> $(obj)include/config.mk
-
-ADCIOP_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx adciop esd
-
-alpr_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx alpr prodrive
-
-AP1000_config:unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx ap1000 amirix
-
-APC405_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx apc405 esd
-
-AR405_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx ar405 esd
-
-ASH405_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx ash405 esd
-
-bamboo_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx bamboo amcc
-
-bamboo_nand_config:	unconfig
-	@mkdir -p $(obj)include $(obj)board/amcc/bamboo
-	@mkdir -p $(obj)nand_spl/board/amcc/bamboo
-	@echo "#define CONFIG_NAND_U_BOOT" > $(obj)include/config.h
-	@$(MKCONFIG) -n $@ -a bamboo ppc ppc4xx bamboo amcc
-	@echo "TEXT_BASE = 0x01000000" > $(obj)board/amcc/bamboo/config.tmp
-	@echo "CONFIG_NAND_U_BOOT = y" >> $(obj)include/config.mk
-
-bubinga_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx bubinga amcc
-
-CANBT_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx canbt esd
-
-# Arches, Canyonlands & Glacier use different U-Boot images
-arches_config \
-canyonlands_config \
-glacier_config:	unconfig
-	@mkdir -p $(obj)include
-	@echo "#define CONFIG_$$(echo $(subst ,,$(@:_config=)) | \
-		tr '[:lower:]' '[:upper:]')" >$(obj)include/config.h
-	@$(MKCONFIG) -n $@ -a canyonlands ppc ppc4xx canyonlands amcc
-
-canyonlands_nand_config \
-glacier_nand_config:	unconfig
-	@mkdir -p $(obj)include $(obj)board/amcc/canyonlands
-	@mkdir -p $(obj)nand_spl/board/amcc/canyonlands
-	@echo "#define CONFIG_NAND_U_BOOT" > $(obj)include/config.h
-	@echo "#define CONFIG_$$(echo $(subst ,,$(@:_nand_config=)) | \
-		tr '[:lower:]' '[:upper:]')" >> $(obj)include/config.h
-	@$(MKCONFIG) -n $@ -a canyonlands ppc ppc4xx canyonlands amcc
-	@echo "TEXT_BASE = 0x01000000" > $(obj)board/amcc/canyonlands/config.tmp
-	@echo "CONFIG_NAND_U_BOOT = y" >> $(obj)include/config.mk
-
-CATcenter_config	\
-CATcenter_25_config	\
-CATcenter_33_config:	unconfig
-	@mkdir -p $(obj)include
-	@ echo "/* CATcenter uses PPChameleon Model ME */"  > $(obj)include/config.h
-	@ echo "#define CONFIG_PPCHAMELEON_MODULE_MODEL 1" >> $(obj)include/config.h
-	@[ -z "$(findstring _25,$@)" ] || \
-		{ echo "#define CONFIG_PPCHAMELEON_CLK_25" >> $(obj)include/config.h ; \
-		  $(XECHO) "SysClk = 25MHz" ; \
-		}
-	@[ -z "$(findstring _33,$@)" ] || \
-		{ echo "#define CONFIG_PPCHAMELEON_CLK_33" >> $(obj)include/config.h ; \
-		  $(XECHO) "SysClk = 33MHz" ; \
-		}
-	@$(MKCONFIG) -a $(call xtract_4xx,$@) ppc ppc4xx PPChameleonEVB dave
-
-CMS700_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx cms700 esd
-
-# Compact-Center & DevCon-Center use different U-Boot images
-compactcenter_config \
-devconcenter_config:	unconfig
-	@mkdir -p $(obj)include
-	@echo "#define CONFIG_$$(echo $(subst ,,$(@:_config=)) | \
-		tr '[:lower:]' '[:upper:]')" >$(obj)include/config.h
-	@$(MKCONFIG) -n $@ -a compactcenter ppc ppc4xx compactcenter gdsys
-
-CPCI2DP_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx cpci2dp esd
-
-CPCI405_config		\
-CPCI4052_config		\
-CPCI405DT_config	\
-CPCI405AB_config:	unconfig
-	@mkdir -p $(obj)board/esd/cpci405
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx cpci405 esd
-
-CPCIISER4_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx cpciiser4 esd
-
-CRAYL1_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx L1 cray
-
-csb272_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx csb272
-
-csb472_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx csb472
-
-DASA_SIM_config: unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx dasa_sim esd
-
-dlvision_config: unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx dlvision gdsys
-
-DP405_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx dp405 esd
-
-DU405_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx du405 esd
-
-DU440_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx du440 esd
-
-ebony_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx ebony amcc
-
-ERIC_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx eric
-
-EXBITGEN_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx exbitgen
-
-fx12mm_flash_config: unconfig
-	@mkdir -p $(obj)include $(obj)board/xilinx/ppc405-generic
-	@mkdir -p $(obj)include $(obj)board/avnet/fx12mm
-	@echo "LDSCRIPT:=$(SRCTREE)/board/xilinx/ppc405-generic/u-boot-rom.lds"\
-		> $(obj)board/avnet/fx12mm/config.tmp
-	@echo "TEXT_BASE := 0xFFCB0000" \
-		>> $(obj)board/avnet/fx12mm/config.tmp
-	@$(MKCONFIG) fx12mm ppc ppc4xx fx12mm avnet
-
-fx12mm_config: unconfig
-	@mkdir -p $(obj)include $(obj)board/xilinx/ppc405-generic
-	@mkdir -p $(obj)include $(obj)board/avnet/fx12mm
-	@echo "LDSCRIPT:=$(SRCTREE)/board/xilinx/ppc405-generic/u-boot-ram.lds"\
-		> $(obj)board/avnet/fx12mm/config.tmp
-	@echo "TEXT_BASE := 0x03000000" \
-		>> $(obj)board/avnet/fx12mm/config.tmp
-	@$(MKCONFIG) fx12mm ppc ppc4xx fx12mm avnet
-
-G2000_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx g2000
-
-gdppc440etx_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx gdppc440etx gdsys
-
-hcu4_config:	unconfig
-	@mkdir -p $(obj)board/netstal/common
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx hcu4 netstal
-
-hcu5_config:	unconfig
-	@mkdir -p $(obj)board/netstal/common
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx hcu5 netstal
-
-HH405_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx hh405 esd
-
-HUB405_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx hub405 esd
-
-JSE_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx jse
-
-KAREF_config: unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx karef sandburst
-
-katmai_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx katmai amcc
-
-# Kilauea & Haleakala images are identical (recognized via PVR)
-kilauea_config \
-haleakala_config: unconfig
-	@$(MKCONFIG) -n $@ -a kilauea ppc ppc4xx kilauea amcc
-
-kilauea_nand_config \
-haleakala_nand_config: unconfig
-	@mkdir -p $(obj)include $(obj)board/amcc/kilauea
-	@mkdir -p $(obj)nand_spl/board/amcc/kilauea
-	@echo "#define CONFIG_NAND_U_BOOT" > $(obj)include/config.h
-	@$(MKCONFIG) -n $@ -a kilauea ppc ppc4xx kilauea amcc
-	@echo "TEXT_BASE = 0x01000000" > $(obj)board/amcc/kilauea/config.tmp
-	@echo "CONFIG_NAND_U_BOOT = y" >> $(obj)include/config.mk
-
-korat_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx korat
-
-luan_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx luan amcc
-
-lwmon5_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx lwmon5
-
-makalu_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx makalu amcc
-
-mcu25_config:  unconfig
-	@mkdir -p $(obj)board/netstal/common
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx mcu25 netstal
-
-METROBOX_config: unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx metrobox sandburst
-
-MIP405_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx mip405 mpl
-
-MIP405T_config:	unconfig
-	@mkdir -p $(obj)include
-	@echo "#define CONFIG_MIP405T" >$(obj)include/config.h
-	@$(XECHO) "Enable subset config for MIP405T"
-	@$(MKCONFIG) -a MIP405 ppc ppc4xx mip405 mpl
-
-ML2_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx ml2
-
-ml300_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx ml300 xilinx
-
-ml507_flash_config: unconfig
-	@mkdir -p $(obj)include $(obj)board/xilinx/ppc440-generic
-	@mkdir -p $(obj)include $(obj)board/xilinx/ml507
-	@echo "LDSCRIPT:=$(SRCTREE)/board/xilinx/ppc440-generic/u-boot-rom.lds"\
-		> $(obj)board/xilinx/ml507/config.tmp
-	@echo "TEXT_BASE := 0xFE360000" \
-		>> $(obj)board/xilinx/ml507/config.tmp
-	@$(MKCONFIG) ml507 ppc ppc4xx ml507 xilinx
-
-ml507_config: unconfig
-	@mkdir -p $(obj)include $(obj)board/xilinx/ppc440-generic
-	@mkdir -p $(obj)include $(obj)board/xilinx/ml507
-	@echo "LDSCRIPT:=$(SRCTREE)/board/xilinx/ppc440-generic/u-boot-ram.lds"\
-		> $(obj)board/xilinx/ml507/config.tmp
-	@echo "TEXT_BASE := 0x04000000"  \
-		>> $(obj)board/xilinx/ml507/config.tmp
-	@$(MKCONFIG) ml507 ppc ppc4xx ml507 xilinx
-
-neo_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx neo gdsys
-
-ocotea_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx ocotea amcc
-
-OCRTC_config		\
-ORSG_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx ocrtc esd
-
-p3p440_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx p3p440 prodrive
-
-PCI405_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx pci405 esd
-
-pcs440ep_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx pcs440ep
-
-PIP405_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx pip405 mpl
-
-PLU405_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx plu405 esd
-
-PMC405_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx pmc405 esd
-
-PMC405DE_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx pmc405de esd
-
-PMC440_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx pmc440 esd
-
-PPChameleonEVB_config		\
-PPChameleonEVB_BA_25_config	\
-PPChameleonEVB_ME_25_config	\
-PPChameleonEVB_HI_25_config	\
-PPChameleonEVB_BA_33_config	\
-PPChameleonEVB_ME_33_config	\
-PPChameleonEVB_HI_33_config:	unconfig
-	@mkdir -p $(obj)include
-	@[ -z "$(findstring EVB_BA,$@)" ] || \
-		{ echo "#define CONFIG_PPCHAMELEON_MODULE_MODEL 0" >>$(obj)include/config.h ; \
-		  $(XECHO) "... BASIC model" ; \
-		}
-	@[ -z "$(findstring EVB_ME,$@)" ] || \
-		{ echo "#define CONFIG_PPCHAMELEON_MODULE_MODEL 1" >>$(obj)include/config.h ; \
-		  $(XECHO) "... MEDIUM model" ; \
-		}
-	@[ -z "$(findstring EVB_HI,$@)" ] || \
-		{ echo "#define CONFIG_PPCHAMELEON_MODULE_MODEL 2" >>$(obj)include/config.h ; \
-		  $(XECHO) "... HIGH-END model" ; \
-		}
-	@[ -z "$(findstring _25,$@)" ] || \
-		{ echo "#define CONFIG_PPCHAMELEON_CLK_25" >>$(obj)include/config.h ; \
-		  $(XECHO) "SysClk = 25MHz" ; \
-		}
-	@[ -z "$(findstring _33,$@)" ] || \
-		{ echo "#define CONFIG_PPCHAMELEON_CLK_33" >>$(obj)include/config.h ; \
-		  $(XECHO) "SysClk = 33MHz" ; \
-		}
-	@$(MKCONFIG) -a $(call xtract_4xx,$@) ppc ppc4xx PPChameleonEVB dave
-
-quad100hd_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx quad100hd
-
-redwood_config: unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx redwood amcc
-
-sbc405_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx sbc405
-
-sc3_config:unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx sc3
-
-sequoia_config \
-rainier_config: unconfig
-	@mkdir -p $(obj)include
-	@echo "#define CONFIG_$$(echo $(subst ,,$(@:_config=)) | \
-		tr '[:lower:]' '[:upper:]')" >$(obj)include/config.h
-	@$(MKCONFIG) -n $@ -a sequoia ppc ppc4xx sequoia amcc
-
-sequoia_nand_config \
-rainier_nand_config: unconfig
-	@mkdir -p $(obj)include $(obj)board/amcc/sequoia
-	@mkdir -p $(obj)nand_spl/board/amcc/sequoia
-	@echo "#define CONFIG_NAND_U_BOOT" > $(obj)include/config.h
-	@echo "#define CONFIG_$$(echo $(subst ,,$(@:_config=)) | \
-		tr '[:lower:]' '[:upper:]')" >> $(obj)include/config.h
-	@$(MKCONFIG) -n $@ -a sequoia ppc ppc4xx sequoia amcc
-	@echo "TEXT_BASE = 0x01000000" > $(obj)board/amcc/sequoia/config.tmp
-	@echo "CONFIG_NAND_U_BOOT = y" >> $(obj)include/config.mk
-
-sequoia_ramboot_config \
-rainier_ramboot_config: unconfig
-	@mkdir -p $(obj)include $(obj)board/amcc/sequoia
-	@echo "#define CONFIG_SYS_RAMBOOT" > $(obj)include/config.h
-	@echo "#define CONFIG_$$(echo $(subst ,,$(@:_config=)) | \
-		tr '[:lower:]' '[:upper:]')" >> $(obj)include/config.h
-	@$(MKCONFIG) -n $@ -a sequoia ppc ppc4xx sequoia amcc
-	@echo "TEXT_BASE = 0x01000000" > $(obj)board/amcc/sequoia/config.tmp
-	@echo "LDSCRIPT = board/amcc/sequoia/u-boot-ram.lds" >> \
-		$(obj)board/amcc/sequoia/config.tmp
-
-taihu_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx taihu amcc
-
-taishan_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx taishan amcc
-
-v5fx30teval_config: unconfig
-	@mkdir -p $(obj)include $(obj)board/xilinx/ppc440-generic
-	@mkdir -p $(obj)include $(obj)board/avnet/v5fx30teval
-	@echo "LDSCRIPT:=$(SRCTREE)/board/xilinx/ppc440-generic/u-boot-ram.lds"\
-		> $(obj)board/avnet/v5fx30teval/config.tmp
-	@echo "TEXT_BASE := 0x03000000" \
-		>> $(obj)board/avnet/v5fx30teval/config.tmp
-	@$(MKCONFIG) v5fx30teval ppc ppc4xx v5fx30teval avnet
-
-v5fx30teval_flash_config: unconfig
-	@mkdir -p $(obj)include $(obj)board/xilinx/ppc440-generic
-	@mkdir -p $(obj)include $(obj)board/avnet/v5fx30teval
-	@echo "LDSCRIPT:=$(SRCTREE)/board/xilinx/ppc440-generic/u-boot-rom.lds"\
-		> $(obj)board/avnet/v5fx30teval/config.tmp
-	@echo "TEXT_BASE := 0xFF1C0000" \
-		>> $(obj)board/avnet/v5fx30teval/config.tmp
-	@$(MKCONFIG) v5fx30teval ppc ppc4xx v5fx30teval avnet
-
-VOH405_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx voh405 esd
-
-VOM405_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx vom405 esd
-
-W7OLMC_config	\
-W7OLMG_config: unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx w7o
-
-# Walnut & Sycamore images are identical (recognized via PVR)
-walnut_config \
-sycamore_config: unconfig
-	@$(MKCONFIG) -n $@ -a walnut ppc ppc4xx walnut amcc
-
-WUH405_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx wuh405 esd
-
-xilinx-ppc405-generic_flash_config: unconfig
-	@mkdir -p $(obj)include $(obj)board/xilinx/ppc405-generic
-	@echo "LDSCRIPT:=$(SRCTREE)/board/xilinx/ppc405-generic/u-boot-rom.lds"\
-		> $(obj)board/xilinx/ppc405-generic/config.tmp
-	@echo "TEXT_BASE := 0xFE360000" \
-		>> $(obj)board/xilinx/ppc405-generic/config.tmp
-	@$(MKCONFIG) xilinx-ppc405-generic ppc ppc4xx ppc405-generic xilinx
-
-xilinx-ppc405-generic_config: unconfig
-	@mkdir -p $(obj)include $(obj)board/xilinx/ppc405-generic
-	@echo "LDSCRIPT:=$(SRCTREE)/board/xilinx/ppc405-generic/u-boot-ram.lds"\
-		> $(obj)board/xilinx/ppc405-generic/config.tmp
-	@echo "TEXT_BASE := 0x04000000" \
-		>> $(obj)board/xilinx/ppc405-generic/config.tmp
-	@$(MKCONFIG) xilinx-ppc405-generic ppc ppc4xx ppc405-generic xilinx
-
-xilinx-ppc440-generic_flash_config: unconfig
-	@mkdir -p $(obj)include $(obj)board/xilinx/ppc440-generic
-	@echo "LDSCRIPT:=$(SRCTREE)/board/xilinx/ppc440-generic/u-boot-rom.lds"\
-		> $(obj)board/xilinx/ppc440-generic/config.tmp
-	@echo "TEXT_BASE := 0xFE360000" \
-		>> $(obj)board/xilinx/ppc440-generic/config.tmp
-	@$(MKCONFIG) xilinx-ppc440-generic ppc ppc4xx ppc440-generic xilinx
-
-xilinx-ppc440-generic_config: unconfig
-	@mkdir -p $(obj)include $(obj)board/xilinx/ppc440-generic
-	@echo "LDSCRIPT:=$(SRCTREE)/board/xilinx/ppc440-generic/u-boot-ram.lds"\
-		> $(obj)board/xilinx/ppc440-generic/config.tmp
-	@echo "TEXT_BASE := 0x04000000" \
-		>> $(obj)board/xilinx/ppc440-generic/config.tmp
-	@$(MKCONFIG) xilinx-ppc440-generic ppc ppc4xx ppc440-generic xilinx
-
-XPEDITE1000_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx xpedite1000 xes
-
-yosemite_config \
-yellowstone_config: unconfig
-	@mkdir -p $(obj)include
-	@echo "#define CONFIG_$$(echo $(subst ,,$(@:_config=)) | \
-		tr '[:lower:]' '[:upper:]')" >$(obj)include/config.h
-	@$(MKCONFIG) -n $@ -a yosemite ppc ppc4xx yosemite amcc
-
-yucca_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx yucca amcc
-
-zeus_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc ppc4xx zeus
-
-#########################################################################
-## MPC8220 Systems
-#########################################################################
-
-Alaska8220_config	\
-Yukon8220_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8220 alaska
-
-sorcery_config:		unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8220 sorcery
-
-#########################################################################
-## MPC824x Systems
-#########################################################################
-xtract_82xx = $(subst _BIGFLASH,,$(subst _ROMBOOT,,$(subst _L2,,$(subst _266MHz,,$(subst _300MHz,,$(subst _config,,$1))))))
-
-A3000_config: unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc824x a3000
-
-barco_config: unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc824x barco
-
-BMW_config: unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc824x bmw
-
-CPC45_config	\
-CPC45_ROMBOOT_config:	unconfig
-	@$(MKCONFIG) $(call xtract_82xx,$@) ppc mpc824x cpc45
-	@cd $(obj)include ;				\
-	if [ "$(findstring _ROMBOOT_,$@)" ] ; then \
-		echo "CONFIG_BOOT_ROM = y" >> config.mk ; \
-		$(XECHO) "... booting from 8-bit flash" ; \
-	else \
-		echo "CONFIG_BOOT_ROM = n" >> config.mk ; \
-		$(XECHO) "... booting from 64-bit flash" ; \
-	fi; \
-	echo "export CONFIG_BOOT_ROM" >> config.mk;
-
-CU824_config: unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc824x cu824
-
-debris_config: unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc824x debris etin
-
-eXalion_config: unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc824x eXalion
-
-HIDDEN_DRAGON_config: unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc824x hidden_dragon
-
-kvme080_config: unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc824x kvme080 etin
-
-# HDLAN is broken ATM. Should be fixed as soon as hardware is available and as
-# time permits.
-#linkstation_HDLAN_config \
-# Remove this line when HDLAN is fixed
-linkstation_HGLAN_config: unconfig
-	@mkdir -p $(obj)include
-	@case $@ in \
-		*HGLAN*) echo "#define CONFIG_HGLAN 1" >$(obj)include/config.h; ;; \
-		*HDLAN*) echo "#define CONFIG_HLAN 1" >$(obj)include/config.h; ;; \
-	esac
-	@$(MKCONFIG) -n $@ -a linkstation ppc mpc824x linkstation
-
-MOUSSE_config: unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc824x mousse
-
-MUSENKI_config: unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc824x musenki
-
-MVBLUE_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc824x mvblue
-
-OXC_config: unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc824x oxc
-
-PN62_config: unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc824x pn62
-
-Sandpoint8240_config: unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc824x sandpoint
-
-Sandpoint8245_config: unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc824x sandpoint
-
-sbc8240_config: unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc824x sbc8240
-
-SL8245_config: unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc824x sl8245
-
-utx8245_config: unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc824x utx8245
-
-#########################################################################
-## MPC8260 Systems
-#########################################################################
-
-atc_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8260 atc
-
-cogent_mpc8260_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8260 cogent
-
-CPU86_config	\
-CPU86_ROMBOOT_config: unconfig
-	@$(MKCONFIG) $(call xtract_82xx,$@) ppc mpc8260 cpu86
-	@cd $(obj)include ;				\
-	if [ "$(findstring _ROMBOOT_,$@)" ] ; then \
-		echo "CONFIG_BOOT_ROM = y" >> config.mk ; \
-		$(XECHO) "... booting from 8-bit flash" ; \
-	else \
-		echo "CONFIG_BOOT_ROM = n" >> config.mk ; \
-		$(XECHO) "... booting from 64-bit flash" ; \
-	fi; \
-	echo "export CONFIG_BOOT_ROM" >> config.mk;
-
-CPU87_config	\
-CPU87_ROMBOOT_config: unconfig
-	@$(MKCONFIG) $(call xtract_82xx,$@) ppc mpc8260 cpu87
-	@cd $(obj)include ;				\
-	if [ "$(findstring _ROMBOOT_,$@)" ] ; then \
-		echo "CONFIG_BOOT_ROM = y" >> config.mk ; \
-		$(XECHO) "... booting from 8-bit flash" ; \
-	else \
-		echo "CONFIG_BOOT_ROM = n" >> config.mk ; \
-		$(XECHO) "... booting from 64-bit flash" ; \
-	fi; \
-	echo "export CONFIG_BOOT_ROM" >> config.mk;
-
-ep8248_config	\
-ep8248E_config	:	unconfig
-	@$(MKCONFIG) ep8248 ppc mpc8260 ep8248
-
-ep8260_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8260 ep8260
-
-ep82xxm_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8260 ep82xxm
-
-gw8260_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8260 gw8260
-
-hymod_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8260 hymod
-
-IDS8247_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8260 ids8247
-
-IPHASE4539_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8260 iphase4539
-
-ISPAN_config		\
-ISPAN_REVB_config:	unconfig
-	@mkdir -p $(obj)include
-	@if [ "$(findstring _REVB_,$@)" ] ; then \
-		echo "#define CONFIG_SYS_REV_B" > $(obj)include/config.h ; \
-	fi
-	@$(MKCONFIG) -a ISPAN ppc mpc8260 ispan
-
-mgcoge_config	:	unconfig
-	@$(MKCONFIG) mgcoge ppc mpc8260 mgcoge keymile
-
-MPC8260ADS_config	\
-MPC8260ADS_lowboot_config	\
-MPC8260ADS_33MHz_config	\
-MPC8260ADS_33MHz_lowboot_config	\
-MPC8260ADS_40MHz_config	\
-MPC8260ADS_40MHz_lowboot_config	\
-MPC8272ADS_config	\
-MPC8272ADS_lowboot_config	\
-PQ2FADS_config		\
-PQ2FADS_lowboot_config		\
-PQ2FADS-VR_config	\
-PQ2FADS-VR_lowboot_config	\
-PQ2FADS-ZU_config	\
-PQ2FADS-ZU_lowboot_config	\
-PQ2FADS-ZU_66MHz_config	\
-PQ2FADS-ZU_66MHz_lowboot_config	\
-	:		unconfig
-	@mkdir -p $(obj)include
-	@mkdir -p $(obj)board/freescale/mpc8260ads
-	$(if $(findstring PQ2FADS,$@), \
-	@echo "#define CONFIG_ADSTYPE CONFIG_SYS_PQ2FADS" > $(obj)include/config.h, \
-	@echo "#define CONFIG_ADSTYPE CONFIG_SYS_"$(subst MPC,,$(word 1,$(subst _, ,$@))) > $(obj)include/config.h)
-	$(if $(findstring MHz,$@), \
-	@echo "#define CONFIG_8260_CLKIN" $(subst MHz,,$(word 2,$(subst _, ,$@)))"000000" >> $(obj)include/config.h, \
-	$(if $(findstring VR,$@), \
-	@echo "#define CONFIG_8260_CLKIN 66000000" >> $(obj)include/config.h))
-	@[ -z "$(findstring lowboot_,$@)" ] || \
-		{ echo "TEXT_BASE = 0xFF800000" >$(obj)board/freescale/mpc8260ads/config.tmp ; \
-		  $(XECHO) "... with lowboot configuration" ; \
-		}
-	@$(MKCONFIG) -a MPC8260ADS ppc mpc8260 mpc8260ads freescale
-
-MPC8266ADS_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8260 mpc8266ads freescale
-
-muas3001_dev_config \
-muas3001_config	:	unconfig
-	@mkdir -p $(obj)include
-	@mkdir -p $(obj)board/muas3001
-	@if [ "$(findstring dev,$@)" ] ; then \
-		echo "#define CONFIG_MUAS_DEV_BOARD" > $(obj)include/config.h ; \
-	fi
-	@$(MKCONFIG) -a muas3001 ppc mpc8260 muas3001
-
-# PM825/PM826 default configuration:  small (= 8 MB) Flash / boot from 64-bit flash
-PM825_config	\
-PM825_ROMBOOT_config	\
-PM825_BIGFLASH_config	\
-PM825_ROMBOOT_BIGFLASH_config	\
-PM826_config	\
-PM826_ROMBOOT_config	\
-PM826_BIGFLASH_config	\
-PM826_ROMBOOT_BIGFLASH_config:	unconfig
-	@mkdir -p $(obj)include
-	@mkdir -p $(obj)board/pm826
-	@if [ "$(findstring PM825_,$@)" ] ; then \
-		echo "#define CONFIG_PCI"	>$(obj)include/config.h ; \
-	else \
-		>$(obj)include/config.h ; \
-	fi
-	@if [ "$(findstring _ROMBOOT_,$@)" ] ; then \
-		$(XECHO) "... booting from 8-bit flash" ; \
-		echo "#define CONFIG_BOOT_ROM" >>$(obj)include/config.h ; \
-		echo "TEXT_BASE = 0xFF800000" >$(obj)board/pm826/config.tmp ; \
-		if [ "$(findstring _BIGFLASH_,$@)" ] ; then \
-			$(XECHO) "... with 32 MB Flash" ; \
-			echo "#define CONFIG_FLASH_32MB" >>$(obj)include/config.h ; \
-		fi; \
-	else \
-		$(XECHO) "... booting from 64-bit flash" ; \
-		if [ "$(findstring _BIGFLASH_,$@)" ] ; then \
-			$(XECHO) "... with 32 MB Flash" ; \
-			echo "#define CONFIG_FLASH_32MB" >>$(obj)include/config.h ; \
-			echo "TEXT_BASE = 0x40000000" >$(obj)board/pm826/config.tmp ; \
-		else \
-			echo "TEXT_BASE = 0xFF000000" >$(obj)board/pm826/config.tmp ; \
-		fi; \
-	fi
-	@$(MKCONFIG) -a PM826 ppc mpc8260 pm826
-
-PM828_config	\
-PM828_PCI_config	\
-PM828_ROMBOOT_config	\
-PM828_ROMBOOT_PCI_config:	unconfig
-	@mkdir -p $(obj)include
-	@mkdir -p $(obj)board/pm826
-	@if [ "$(findstring _PCI_,$@)" ] ; then \
-		echo "#define CONFIG_PCI"  >>$(obj)include/config.h ; \
-		$(XECHO) "... with PCI enabled" ; \
-	fi
-	@if [ "$(findstring _ROMBOOT_,$@)" ] ; then \
-		$(XECHO) "... booting from 8-bit flash" ; \
-		echo "#define CONFIG_BOOT_ROM" >>$(obj)include/config.h ; \
-		echo "TEXT_BASE = 0xFF800000" >$(obj)board/pm826/config.tmp ; \
-	fi
-	@$(MKCONFIG) -a PM828 ppc mpc8260 pm828
-
-ppmc8260_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8260 ppmc8260
-
-Rattler8248_config	\
-Rattler_config:		unconfig
-	@mkdir -p $(obj)include
-	$(if $(findstring 8248,$@), \
-	@echo "#define CONFIG_MPC8248" > $(obj)include/config.h)
-	@$(MKCONFIG) -a Rattler ppc mpc8260 rattler
-
-RPXsuper_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8260 rpxsuper
-
-rsdproto_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8260 rsdproto
-
-sacsng_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8260 sacsng
-
-sbc8260_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8260 sbc8260
-
-SCM_config:		unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8260 SCM siemens
-
-TQM8255_AA_config \
-TQM8260_AA_config \
-TQM8260_AB_config \
-TQM8260_AC_config \
-TQM8260_AD_config \
-TQM8260_AE_config \
-TQM8260_AF_config \
-TQM8260_AG_config \
-TQM8260_AH_config \
-TQM8260_AI_config \
-TQM8265_AA_config:  unconfig
-	@mkdir -p $(obj)include
-	@case "$@" in \
-	TQM8255_AA_config) CTYPE=MPC8255; CFREQ=300; CACHE=no;	BMODE=8260;;  \
-	TQM8260_AA_config) CTYPE=MPC8260; CFREQ=200; CACHE=no;	BMODE=8260;; \
-	TQM8260_AB_config) CTYPE=MPC8260; CFREQ=200; CACHE=yes;	BMODE=60x;;  \
-	TQM8260_AC_config) CTYPE=MPC8260; CFREQ=200; CACHE=yes;	BMODE=60x;;  \
-	TQM8260_AD_config) CTYPE=MPC8260; CFREQ=300; CACHE=no;	BMODE=60x;;  \
-	TQM8260_AE_config) CTYPE=MPC8260; CFREQ=266; CACHE=no;	BMODE=8260;; \
-	TQM8260_AF_config) CTYPE=MPC8260; CFREQ=300; CACHE=no;	BMODE=60x;;  \
-	TQM8260_AG_config) CTYPE=MPC8260; CFREQ=300; CACHE=no;	BMODE=8260;; \
-	TQM8260_AH_config) CTYPE=MPC8260; CFREQ=300; CACHE=yes;	BMODE=60x;;  \
-	TQM8260_AI_config) CTYPE=MPC8260; CFREQ=300; CACHE=no;	BMODE=60x;;  \
-	TQM8265_AA_config) CTYPE=MPC8265; CFREQ=300; CACHE=no;	BMODE=60x;;  \
-	esac; \
-	if [ "$${CTYPE}" != "MPC8260" ] ; then \
-		echo "#define CONFIG_$${CTYPE}"	>>$(obj)include/config.h ; \
-	fi; \
-	echo "#define CONFIG_$${CFREQ}MHz"	>>$(obj)include/config.h ; \
-	echo "... with $${CFREQ}MHz system clock" ; \
-	if [ "$${CACHE}" = "yes" ] ; then \
-		echo "#define CONFIG_L2_CACHE"	>>$(obj)include/config.h ; \
-		$(XECHO) "... with L2 Cache support" ; \
-	else \
-		echo "#undef CONFIG_L2_CACHE"	>>$(obj)include/config.h ; \
-		$(XECHO) "... without L2 Cache support" ; \
-	fi; \
-	if [ "$${BMODE}" = "60x" ] ; then \
-		echo "#define CONFIG_BUSMODE_60x" >>$(obj)include/config.h ; \
-		$(XECHO) "... with 60x Bus Mode" ; \
-	else \
-		echo "#undef CONFIG_BUSMODE_60x"  >>$(obj)include/config.h ; \
-		$(XECHO) "... without 60x Bus Mode" ; \
-	fi
-	@$(MKCONFIG) -a TQM8260 ppc mpc8260 tqm8260 tqc
-
-TQM8272_config: unconfig
-	@$(MKCONFIG) TQM8272 ppc mpc8260 tqm8272 tqc
-
-VoVPN-GW_66MHz_config	\
-VoVPN-GW_100MHz_config:		unconfig
-	@mkdir -p $(obj)include
-	@echo "#define CONFIG_CLKIN_$(word 2,$(subst _, ,$@))" > $(obj)include/config.h
-	@$(MKCONFIG) -a VoVPN-GW ppc mpc8260 vovpn-gw funkwerk
-
-ZPC1900_config: unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc8260 zpc1900
-
-#########################################################################
-## Coldfire
-#########################################################################
-
-M5208EVBE_config :		unconfig
-	@$(MKCONFIG) $(@:_config=) m68k mcf52x2 m5208evbe freescale
-
-M52277EVB_config \
-M52277EVB_spansion_config \
-M52277EVB_stmicro_config :	unconfig
-	@case "$@" in \
-	M52277EVB_config)		FLASH=SPANSION;; \
-	M52277EVB_spansion_config)	FLASH=SPANSION;; \
-	M52277EVB_stmicro_config)	FLASH=STMICRO;; \
-	esac; \
-	if [ "$${FLASH}" = "SPANSION" ] ; then \
-		echo "#define CONFIG_SYS_SPANSION_BOOT"	>> $(obj)include/config.h ; \
-		echo "TEXT_BASE = 0x00000000" > $(obj)board/freescale/m52277evb/config.tmp ; \
-		cp $(obj)board/freescale/m52277evb/u-boot.spa $(obj)board/freescale/m52277evb/u-boot.lds ; \
-		$(XECHO) "... with SPANSION boot..." ; \
-	fi; \
-	if [ "$${FLASH}" = "STMICRO" ] ; then \
-		echo "#define CONFIG_CF_SBF"	>> $(obj)include/config.h ; \
-		echo "#define CONFIG_SYS_STMICRO_BOOT"	>> $(obj)include/config.h ; \
-		echo "TEXT_BASE = 0x43E00000" > $(obj)board/freescale/m52277evb/config.tmp ; \
-		cp $(obj)board/freescale/m52277evb/u-boot.stm $(obj)board/freescale/m52277evb/u-boot.lds ; \
-		$(XECHO) "... with ST Micro boot..." ; \
-	fi
-	@$(MKCONFIG) -a M52277EVB m68k mcf5227x m52277evb freescale
-
-M5235EVB_config \
-M5235EVB_Flash16_config \
-M5235EVB_Flash32_config:	unconfig
-	@case "$@" in \
-	M5235EVB_config)		FLASH=16;; \
-	M5235EVB_Flash16_config)	FLASH=16;; \
-	M5235EVB_Flash32_config)	FLASH=32;; \
-	esac; \
-	if [ "$${FLASH}" != "16" ] ; then \
-		echo "#define NORFLASH_PS32BIT	1" >> $(obj)include/config.h ; \
-		echo "TEXT_BASE = 0xFFC00000" > $(obj)board/freescale/m5235evb/config.tmp ; \
-		cp $(obj)board/freescale/m5235evb/u-boot.32 $(obj)board/freescale/m5235evb/u-boot.lds ; \
-	else \
-		echo "TEXT_BASE = 0xFFE00000" > $(obj)board/freescale/m5235evb/config.tmp ; \
-		cp $(obj)board/freescale/m5235evb/u-boot.16 $(obj)board/freescale/m5235evb/u-boot.lds ; \
-	fi
-	@$(MKCONFIG) -a M5235EVB m68k mcf523x m5235evb freescale
-
-M5249EVB_config :		unconfig
-	@$(MKCONFIG) $(@:_config=) m68k mcf52x2 m5249evb freescale
-
-M5253DEMO_config :		unconfig
-	@$(MKCONFIG) $(@:_config=) m68k mcf52x2 m5253demo freescale
-
-M5253EVBE_config :		unconfig
-	@$(MKCONFIG) $(@:_config=) m68k mcf52x2 m5253evbe freescale
-
-cobra5272_config :		unconfig
-	@$(MKCONFIG) $(@:_config=) m68k mcf52x2 cobra5272
-
-EB+MCF-EV123_config :		unconfig
-	@mkdir -p $(obj)include
-	@mkdir -p $(obj)board/BuS/EB+MCF-EV123
-	@echo "TEXT_BASE = 0xFFE00000"|tee $(obj)board/BuS/EB+MCF-EV123/textbase.mk
-	@$(MKCONFIG) EB+MCF-EV123 m68k mcf52x2 EB+MCF-EV123 BuS
-
-EB+MCF-EV123_internal_config :	unconfig
-	@mkdir -p $(obj)include
-	@mkdir -p $(obj)board/BuS/EB+MCF-EV123
-	@echo "TEXT_BASE = 0xF0000000"|tee $(obj)board/BuS/EB+MCF-EV123/textbase.mk
-	@$(MKCONFIG) EB+MCF-EV123 m68k mcf52x2 EB+MCF-EV123 BuS
-
-idmr_config :			unconfig
-	@$(MKCONFIG) $(@:_config=) m68k mcf52x2 idmr
-
-M5271EVB_config :		unconfig
-	@$(MKCONFIG) $(@:_config=) m68k mcf52x2 m5271evb freescale
-
-M5272C3_config :		unconfig
-	@$(MKCONFIG) $(@:_config=) m68k mcf52x2 m5272c3 freescale
-
-M5275EVB_config :		unconfig
-	@$(MKCONFIG) $(@:_config=) m68k mcf52x2 m5275evb freescale
-
-M5282EVB_config :		unconfig
-	@$(MKCONFIG) $(@:_config=) m68k mcf52x2 m5282evb freescale
-
-M53017EVB_config :		unconfig
-	@$(MKCONFIG) $(@:_config=) m68k mcf532x m53017evb freescale
-
-M5329AFEE_config \
-M5329BFEE_config :	unconfig
-	@case "$@" in \
-	M5329AFEE_config)	NAND=0;; \
-	M5329BFEE_config)	NAND=16;; \
-	esac; \
-	if [ "$${NAND}" != "0" ] ; then \
-		echo "#define NANDFLASH_SIZE	$${NAND}" > $(obj)include/config.h ; \
-	fi
-	@$(MKCONFIG) -a M5329EVB m68k mcf532x m5329evb freescale
-
-M5373EVB_config :	unconfig
-	@case "$@" in \
-	M5373EVB_config)	NAND=16;; \
-	esac; \
-	if [ "$${NAND}" != "0" ] ; then \
-		echo "#define NANDFLASH_SIZE	$${NAND}" > $(obj)include/config.h ; \
-	fi
-	@$(MKCONFIG) -a M5373EVB m68k mcf532x m5373evb freescale
-
-M54451EVB_config \
-M54451EVB_stmicro_config :	unconfig
-	@case "$@" in \
-	M54451EVB_config)		FLASH=NOR;; \
-	M54451EVB_stmicro_config)	FLASH=STMICRO;; \
-	esac; \
-	if [ "$${FLASH}" = "NOR" ] ; then \
-		echo "TEXT_BASE = 0x00000000" > $(obj)board/freescale/m54451evb/config.tmp ; \
-		cp $(obj)board/freescale/m54451evb/u-boot.spa $(obj)board/freescale/m54451evb/u-boot.lds ; \
-		$(XECHO) "... with NOR boot..." ; \
-	fi; \
-	if [ "$${FLASH}" = "STMICRO" ] ; then \
-		echo "#define CONFIG_CF_SBF"	>> $(obj)include/config.h ; \
-		echo "#define CONFIG_SYS_STMICRO_BOOT"	>> $(obj)include/config.h ; \
-		echo "TEXT_BASE = 0x47E00000" > $(obj)board/freescale/m54451evb/config.tmp ; \
-		cp $(obj)board/freescale/m54451evb/u-boot.stm $(obj)board/freescale/m54451evb/u-boot.lds ; \
-		$(XECHO) "... with ST Micro boot..." ; \
-	fi; \
-	echo "#define CONFIG_SYS_INPUT_CLKSRC 24000000" >> $(obj)include/config.h ;
-	@$(MKCONFIG) -a M54451EVB m68k mcf5445x m54451evb freescale
-
-M54455EVB_config \
-M54455EVB_atmel_config \
-M54455EVB_intel_config \
-M54455EVB_a33_config \
-M54455EVB_a66_config \
-M54455EVB_i33_config \
-M54455EVB_i66_config \
-M54455EVB_stm33_config :	unconfig
-	@case "$@" in \
-	M54455EVB_config)		FLASH=ATMEL; FREQ=33333333;; \
-	M54455EVB_atmel_config)		FLASH=ATMEL; FREQ=33333333;; \
-	M54455EVB_intel_config)		FLASH=INTEL; FREQ=33333333;; \
-	M54455EVB_a33_config)		FLASH=ATMEL; FREQ=33333333;; \
-	M54455EVB_a66_config)		FLASH=ATMEL; FREQ=66666666;; \
-	M54455EVB_i33_config)		FLASH=INTEL; FREQ=33333333;; \
-	M54455EVB_i66_config)		FLASH=INTEL; FREQ=66666666;; \
-	M54455EVB_stm33_config)		FLASH=STMICRO; FREQ=33333333;; \
-	esac; \
-	if [ "$${FLASH}" = "INTEL" ] ; then \
-		echo "#define CONFIG_SYS_INTEL_BOOT" >> $(obj)include/config.h ; \
-		echo "TEXT_BASE = 0x00000000" > $(obj)board/freescale/m54455evb/config.tmp ; \
-		cp $(obj)board/freescale/m54455evb/u-boot.int $(obj)board/freescale/m54455evb/u-boot.lds ; \
-		$(XECHO) "... with INTEL boot..." ; \
-	fi; \
-	if [ "$${FLASH}" = "ATMEL" ] ; then \
-		echo "#define CONFIG_SYS_ATMEL_BOOT"	>> $(obj)include/config.h ; \
-		echo "TEXT_BASE = 0x04000000" > $(obj)board/freescale/m54455evb/config.tmp ; \
-		cp $(obj)board/freescale/m54455evb/u-boot.atm $(obj)board/freescale/m54455evb/u-boot.lds ; \
-		$(XECHO) "... with ATMEL boot..." ; \
-	fi; \
-	if [ "$${FLASH}" = "STMICRO" ] ; then \
-		echo "#define CONFIG_CF_SBF"	>> $(obj)include/config.h ; \
-		echo "#define CONFIG_SYS_STMICRO_BOOT"	>> $(obj)include/config.h ; \
-		echo "TEXT_BASE = 0x4FE00000" > $(obj)board/freescale/m54455evb/config.tmp ; \
-		cp $(obj)board/freescale/m54455evb/u-boot.stm $(obj)board/freescale/m54455evb/u-boot.lds ; \
-		$(XECHO) "... with ST Micro boot..." ; \
-	fi; \
-	echo "#define CONFIG_SYS_INPUT_CLKSRC $${FREQ}" >> $(obj)include/config.h ; \
-	$(XECHO) "... with $${FREQ}Hz input clock"
-	@$(MKCONFIG) -a M54455EVB m68k mcf5445x m54455evb freescale
-
-M5475AFE_config \
-M5475BFE_config \
-M5475CFE_config \
-M5475DFE_config \
-M5475EFE_config \
-M5475FFE_config \
-M5475GFE_config :	unconfig
-	@case "$@" in \
-	M5475AFE_config)	BOOT=2;CODE=0;VID=0;USB=0;RAM=64;RAM1=0;; \
-	M5475BFE_config)	BOOT=2;CODE=16;VID=0;USB=0;RAM=64;RAM1=0;; \
-	M5475CFE_config)	BOOT=2;CODE=16;VID=1;USB=1;RAM=64;RAM1=0;; \
-	M5475DFE_config)	BOOT=2;CODE=0;VID=0;USB=1;RAM=64;RAM1=0;; \
-	M5475EFE_config)	BOOT=2;CODE=0;VID=1;USB=1;RAM=64;RAM1=0;; \
-	M5475FFE_config)	BOOT=2;CODE=32;VID=1;USB=1;RAM=64;RAM1=64;; \
-	M5475GFE_config)	BOOT=4;CODE=0;VID=0;USB=0;RAM=64;RAM1=0;; \
-	esac; \
-	echo "#define CONFIG_SYS_BUSCLK	133333333" > $(obj)include/config.h ; \
-	echo "#define CONFIG_SYS_BOOTSZ	$${BOOT}" >> $(obj)include/config.h ; \
-	echo "#define CONFIG_SYS_DRAMSZ	$${RAM}" >> $(obj)include/config.h ; \
-	if [ "$${RAM1}" != "0" ] ; then \
-		echo "#define CONFIG_SYS_DRAMSZ1	$${RAM1}" >> $(obj)include/config.h ; \
-	fi; \
-	if [ "$${CODE}" != "0" ] ; then \
-		echo "#define CONFIG_SYS_NOR1SZ	$${CODE}" >> $(obj)include/config.h ; \
-	fi; \
-	if [ "$${VID}" == "1" ] ; then \
-		echo "#define CONFIG_SYS_VIDEO" >> $(obj)include/config.h ; \
-	fi; \
-	if [ "$${USB}" == "1" ] ; then \
-		echo "#define CONFIG_SYS_USBCTRL" >> $(obj)include/config.h ; \
-	fi
-	@$(MKCONFIG) -a M5475EVB m68k mcf547x_8x m547xevb freescale
-
-M5485AFE_config \
-M5485BFE_config \
-M5485CFE_config \
-M5485DFE_config \
-M5485EFE_config \
-M5485FFE_config \
-M5485GFE_config \
-M5485HFE_config :	unconfig
-	@case "$@" in \
-	M5485AFE_config)	BOOT=2;CODE=0;VID=0;USB=0;RAM=64;RAM1=0;; \
-	M5485BFE_config)	BOOT=2;CODE=16;VID=0;USB=0;RAM=64;RAM1=0;; \
-	M5485CFE_config)	BOOT=2;CODE=16;VID=1;USB=1;RAM=64;RAM1=0;; \
-	M5485DFE_config)	BOOT=2;CODE=0;VID=0;USB=1;RAM=64;RAM1=0;; \
-	M5485EFE_config)	BOOT=2;CODE=0;VID=1;USB=1;RAM=64;RAM1=0;; \
-	M5485FFE_config)	BOOT=2;CODE=32;VID=1;USB=1;RAM=64;RAM1=64;; \
-	M5485GFE_config)	BOOT=4;CODE=0;VID=0;USB=0;RAM=64;RAM1=0;; \
-	M5485HFE_config)	BOOT=2;CODE=16;VID=1;USB=0;RAM=64;RAM1=0;; \
-	esac; \
-	echo "#define CONFIG_SYS_BUSCLK	100000000" > $(obj)include/config.h ; \
-	echo "#define CONFIG_SYS_BOOTSZ	$${BOOT}" >> $(obj)include/config.h ; \
-	echo "#define CONFIG_SYS_DRAMSZ	$${RAM}" >> $(obj)include/config.h ; \
-	if [ "$${RAM1}" != "0" ] ; then \
-		echo "#define CONFIG_SYS_DRAMSZ1	$${RAM1}" >> $(obj)include/config.h ; \
-	fi; \
-	if [ "$${CODE}" != "0" ] ; then \
-		echo "#define CONFIG_SYS_NOR1SZ	$${CODE}" >> $(obj)include/config.h ; \
-	fi; \
-	if [ "$${VID}" == "1" ] ; then \
-		echo "#define CONFIG_SYS_VIDEO" >> $(obj)include/config.h ; \
-	fi; \
-	if [ "$${USB}" == "1" ] ; then \
-		echo "#define CONFIG_SYS_USBCTRL" >> $(obj)include/config.h ; \
-	fi
-	@$(MKCONFIG) -a M5485EVB m68k mcf547x_8x m548xevb freescale
-
-TASREG_config :		unconfig
-	@$(MKCONFIG) $(@:_config=) m68k mcf52x2 tasreg esd
-
-#########################################################################
-## MPC83xx Systems
-#########################################################################
-
-kmeter1_config: unconfig
-	@$(MKCONFIG) kmeter1 ppc mpc83xx kmeter1 keymile
-
-MPC8313ERDB_33_config \
-MPC8313ERDB_66_config \
-MPC8313ERDB_NAND_33_config \
-MPC8313ERDB_NAND_66_config: unconfig
-	@mkdir -p $(obj)include
-	@mkdir -p $(obj)board/freescale/mpc8313erdb
-	@if [ "$(findstring _33_,$@)" ] ; then \
-		$(XECHO) -n "...33M ..." ; \
-		echo "#define CONFIG_SYS_33MHZ" >>$(obj)include/config.h ; \
-	fi ; \
-	if [ "$(findstring _66_,$@)" ] ; then \
-		$(XECHO) -n "...66M..." ; \
-		echo "#define CONFIG_SYS_66MHZ" >>$(obj)include/config.h ; \
-	fi ; \
-	if [ "$(findstring _NAND_,$@)" ] ; then \
-		$(XECHO) -n "...NAND..." ; \
-		echo "TEXT_BASE = 0x00100000" > $(obj)board/freescale/mpc8313erdb/config.tmp ; \
-		echo "#define CONFIG_NAND_U_BOOT" >>$(obj)include/config.h ; \
-	fi ;
-	@$(MKCONFIG) -a MPC8313ERDB ppc mpc83xx mpc8313erdb freescale
-	@if [ "$(findstring _NAND_,$@)" ] ; then \
-		echo "CONFIG_NAND_U_BOOT = y" >> $(obj)include/config.mk ; \
-	fi ;
-
-MPC8315ERDB_config: unconfig
-	@$(MKCONFIG) -a MPC8315ERDB ppc mpc83xx mpc8315erdb freescale
-
-MPC8323ERDB_config:	unconfig
-	@$(MKCONFIG) -a MPC8323ERDB ppc mpc83xx mpc8323erdb freescale
-
-MPC832XEMDS_config \
-MPC832XEMDS_HOST_33_config \
-MPC832XEMDS_HOST_66_config \
-MPC832XEMDS_SLAVE_config \
-MPC832XEMDS_ATM_config:	unconfig
-	@mkdir -p $(obj)include
-	@if [ "$(findstring _HOST_,$@)" ] ; then \
-		$(XECHO) -n "... PCI HOST " ; \
-		echo "#define CONFIG_PCI" >>$(obj)include/config.h ; \
-	fi ; \
-	if [ "$(findstring _SLAVE_,$@)" ] ; then \
-		$(XECHO) "...PCI SLAVE 66M"  ; \
-		echo "#define CONFIG_PCI" >>$(obj)include/config.h ; \
-		echo "#define CONFIG_PCISLAVE" >>$(obj)include/config.h ; \
-	fi ; \
-	if [ "$(findstring _33_,$@)" ] ; then \
-		$(XECHO) -n "...33M ..." ; \
-		echo "#define PCI_33M" >>$(obj)include/config.h ; \
-		echo "#define CONFIG_PQ_MDS_PIB 1" >>$(obj)include/config.h ; \
-	fi ; \
-	if [ "$(findstring _66_,$@)" ] ; then \
-		$(XECHO) -n "...66M..." ; \
-		echo "#define PCI_66M" >>$(obj)include/config.h ; \
-		echo "#define CONFIG_PQ_MDS_PIB 1" >>$(obj)include/config.h ; \
-	fi ; \
-	if [ "$(findstring _ATM_,$@)" ] ; then \
-		$(XECHO) -n "...ATM..." ; \
-		echo "#define CONFIG_PQ_MDS_PIB 1" >>$(obj)include/config.h ; \
-		echo "#define CONFIG_PQ_MDS_PIB_ATM	1" >>$(obj)include/config.h ; \
-	fi ;
-	@$(MKCONFIG) -a MPC832XEMDS ppc mpc83xx mpc832xemds freescale
-
-MPC8349EMDS_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc83xx mpc8349emds freescale
-
-MPC8349ITX_config \
-MPC8349ITX_LOWBOOT_config \
-MPC8349ITXGP_config:	unconfig
-	@mkdir -p $(obj)include
-	@mkdir -p $(obj)board/freescale/mpc8349itx
-	@echo "#define CONFIG_$(subst _LOWBOOT,,$(@:_config=))" >> $(obj)include/config.h
-	@if [ "$(findstring GP,$@)" ] ; then \
-		echo "TEXT_BASE = 0xFE000000" >$(obj)board/freescale/mpc8349itx/config.tmp ; \
-	fi
-	@if [ "$(findstring LOWBOOT,$@)" ] ; then \
-		echo "TEXT_BASE = 0xFE000000" >$(obj)board/freescale/mpc8349itx/config.tmp ; \
-	fi
-	@$(MKCONFIG) -a -n $(@:_config=) MPC8349ITX ppc mpc83xx mpc8349itx freescale
-
-MPC8360EMDS_config \
-MPC8360EMDS_HOST_33_config \
-MPC8360EMDS_HOST_66_config \
-MPC8360EMDS_SLAVE_config \
-MPC8360EMDS_ATM_config: unconfig
-	@mkdir -p $(obj)include
-	@if [ "$(findstring _HOST_,$@)" ] ; then \
-		$(XECHO) -n "... PCI HOST " ; \
-		echo "#define CONFIG_PCI" >>$(obj)include/config.h ; \
-	fi ; \
-	if [ "$(findstring _SLAVE_,$@)" ] ; then \
-		$(XECHO) "...PCI SLAVE 66M"  ; \
-		echo "#define CONFIG_PCI" >>$(obj)include/config.h ; \
-		echo "#define CONFIG_PCISLAVE" >>$(obj)include/config.h ; \
-	fi ; \
-	if [ "$(findstring _33_,$@)" ] ; then \
-		$(XECHO) -n "...33M ..." ; \
-		echo "#define PCI_33M" >>$(obj)include/config.h ; \
-		echo "#define CONFIG_PQ_MDS_PIB 1" >>$(obj)include/config.h ; \
-	fi ; \
-	if [ "$(findstring _66_,$@)" ] ; then \
-		$(XECHO) -n "...66M..." ; \
-		echo "#define PCI_66M" >>$(obj)include/config.h ; \
-		echo "#define CONFIG_PQ_MDS_PIB 1" >>$(obj)include/config.h ; \
-	fi ; \
-	if [ "$(findstring _ATM_,$@)" ] ; then \
-		$(XECHO) -n "...ATM..." ; \
-		echo "#define CONFIG_PQ_MDS_PIB 1" >>$(obj)include/config.h ; \
-		echo "#define CONFIG_PQ_MDS_PIB_ATM	1" >>$(obj)include/config.h ; \
-	fi ;
-	@$(MKCONFIG) -a MPC8360EMDS ppc mpc83xx mpc8360emds freescale
-
-MPC8360ERDK_33_config \
-MPC8360ERDK_66_config \
-MPC8360ERDK_config:	unconfig
-	@mkdir -p $(obj)include
-	@if [ "$(findstring _33_,$@)" ] ; then \
-		$(XECHO) -n "... CLKIN 33MHz " ; \
-		echo "#define CONFIG_CLKIN_33MHZ" >>$(obj)include/config.h ;\
-	fi ;
-	@$(MKCONFIG) -a MPC8360ERDK ppc mpc83xx mpc8360erdk freescale
-
-MPC837XEMDS_config \
-MPC837XEMDS_HOST_config:	unconfig
-	@mkdir -p $(obj)include
-	@if [ "$(findstring _HOST_,$@)" ] ; then \
-		$(XECHO) -n "... PCI HOST " ; \
-		echo "#define CONFIG_PCI" >>$(obj)include/config.h ; \
-	fi ;
-	@$(MKCONFIG) -a MPC837XEMDS ppc mpc83xx mpc837xemds freescale
-
-MPC837XERDB_config:	unconfig
-	@$(MKCONFIG) -a MPC837XERDB ppc mpc83xx mpc837xerdb freescale
-
-MVBLM7_config: unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc83xx mvblm7 matrix_vision
-
-sbc8349_config \
-sbc8349_PCI_33_config \
-sbc8349_PCI_66_config: unconfig
-	@mkdir -p $(obj)include
-	@if [ "$(findstring _PCI_,$@)" ] ; then \
-		$(XECHO) -n "... PCI HOST at " ; \
-		echo "#define CONFIG_PCI" >>$(obj)include/config.h ; \
-	fi ; \
-	if [ "$(findstring _33_,$@)" ] ; then \
-		$(XECHO) -n "33MHz... " ; \
-		echo "#define PCI_33M" >>$(obj)include/config.h ; \
-	fi ; \
-	if [ "$(findstring _66_,$@)" ] ; then \
-		$(XECHO) -n "66MHz... " ; \
-		echo "#define PCI_66M" >>$(obj)include/config.h ; \
-	fi ;
-	@$(MKCONFIG) -a sbc8349 ppc mpc83xx sbc8349
-
-SIMPC8313_LP_config \
-SIMPC8313_SP_config: unconfig
-	@mkdir -p $(obj)include
-	@mkdir -p $(obj)board/sheldon/simpc8313
-	@if [ "$(findstring _LP_,$@)" ] ; then \
-		$(XECHO) -n "...Large Page NAND..." ; \
-		echo "#define CONFIG_NAND_LP" >> $(obj)include/config.h ; \
-	fi ; \
-	if [ "$(findstring _SP_,$@)" ] ; then \
-		$(XECHO) -n "...Small Page NAND..." ; \
-		echo "#define CONFIG_NAND_SP" >> $(obj)include/config.h ; \
-	fi ;
-	@$(MKCONFIG) -a SIMPC8313 ppc mpc83xx simpc8313 sheldon
-	@echo "CONFIG_NAND_U_BOOT = y" >> $(obj)include/config.mk
-
-TQM834x_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc83xx tqm834x tqc
-
-vme8349_config:		unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc83xx vme8349 esd
-
-#########################################################################
-## MPC85xx Systems
-#########################################################################
-
-ATUM8548_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc85xx atum8548
-
-MPC8536DS_config:       unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc85xx mpc8536ds freescale
-
-MPC8540ADS_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc85xx mpc8540ads freescale
-
-MPC8540EVAL_config \
-MPC8540EVAL_33_config \
-MPC8540EVAL_66_config \
-MPC8540EVAL_33_slave_config \
-MPC8540EVAL_66_slave_config:	  unconfig
-	@mkdir -p $(obj)include
-	@if [ "$(findstring _33_,$@)" ] ; then \
-		$(XECHO) "... 33 MHz PCI" ; \
-	else \
-		echo "#define CONFIG_SYSCLK_66M" >>$(obj)include/config.h ; \
-		$(XECHO) "... 66 MHz PCI" ; \
-	fi ; \
-	if [ "$(findstring _slave_,$@)" ] ; then \
-		echo "#define CONFIG_PCI_SLAVE" >>$(obj)include/config.h ; \
-		$(XECHO) " slave" ; \
-	else \
-		$(XECHO) " host" ; \
-	fi
-	@$(MKCONFIG) -a MPC8540EVAL ppc mpc85xx mpc8540eval
-
-MPC8560ADS_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc85xx mpc8560ads freescale
-
-MPC8541CDS_legacy_config \
-MPC8541CDS_config:	unconfig
-	@mkdir -p $(obj)include
-	@if [ "$(findstring _legacy_,$@)" ] ; then \
-		echo "#define CONFIG_LEGACY" >>$(obj)include/config.h ; \
-		$(XECHO) "... legacy" ; \
-	fi
-	@$(MKCONFIG) -a MPC8541CDS ppc mpc85xx mpc8541cds freescale
-
-MPC8544DS_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc85xx mpc8544ds freescale
-
-MPC8548CDS_legacy_config \
-MPC8548CDS_config:	unconfig
-	@mkdir -p $(obj)include
-	@if [ "$(findstring _legacy_,$@)" ] ; then \
-		echo "#define CONFIG_LEGACY" >>$(obj)include/config.h ; \
-		$(XECHO) "... legacy" ; \
-	fi
-	@$(MKCONFIG) -a MPC8548CDS ppc mpc85xx mpc8548cds freescale
-
-MPC8555CDS_legacy_config \
-MPC8555CDS_config:	unconfig
-	@mkdir -p $(obj)include
-	@if [ "$(findstring _legacy_,$@)" ] ; then \
-		echo "#define CONFIG_LEGACY" >>$(obj)include/config.h ; \
-		$(XECHO) "... legacy" ; \
-	fi
-	@$(MKCONFIG) -a MPC8555CDS ppc mpc85xx mpc8555cds freescale
-
-MPC8568MDS_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc85xx mpc8568mds freescale
-
-MPC8569MDS_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc85xx mpc8569mds freescale
-
-MPC8572DS_36BIT_config \
-MPC8572DS_config:       unconfig
-	@mkdir -p $(obj)include
-	@if [ "$(findstring _36BIT_,$@)" ] ; then \
-		echo "#define CONFIG_PHYS_64BIT" >>$(obj)include/config.h ; \
-		$(XECHO) "... enabling 36-bit physical addressing." ; \
-	fi
-	@$(MKCONFIG) -a MPC8572DS ppc mpc85xx mpc8572ds freescale
-
-P2020DS_36BIT_config \
-P2020DS_config:		unconfig
-	@mkdir -p $(obj)include
-	@if [ "$(findstring _36BIT_,$@)" ] ; then \
-		echo "#define CONFIG_PHYS_64BIT" >>$(obj)include/config.h ; \
-		$(XECHO) "... enabling 36-bit physical addressing." ; \
-	fi
-	@$(MKCONFIG) -a P2020DS ppc mpc85xx p2020ds freescale
-
-PM854_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc85xx pm854
-
-PM856_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc85xx pm856
-
-sbc8540_config \
-sbc8540_33_config \
-sbc8540_66_config:	unconfig
-	@mkdir -p $(obj)include
-	@if [ "$(findstring _66_,$@)" ] ; then \
-		echo "#define CONFIG_PCI_66"	>>$(obj)include/config.h ; \
-		$(XECHO) "... 66 MHz PCI" ; \
-	else \
-		$(XECHO) "... 33 MHz PCI" ; \
-	fi
-	@$(MKCONFIG) -a SBC8540 ppc mpc85xx sbc8560
-
-sbc8548_config:		unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc85xx sbc8548
-
-sbc8560_config \
-sbc8560_33_config \
-sbc8560_66_config:	unconfig
-	@mkdir -p $(obj)include
-	@if [ "$(findstring _66_,$@)" ] ; then \
-		echo "#define CONFIG_PCI_66"	>>$(obj)include/config.h ; \
-		$(XECHO) "... 66 MHz PCI" ; \
-	else \
-		$(XECHO) "... 33 MHz PCI" ; \
-	fi
-	@$(MKCONFIG) -a sbc8560 ppc mpc85xx sbc8560
-
-socrates_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc85xx socrates
-
-stxgp3_config:		unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc85xx stxgp3
-
-stxssa_config		\
-stxssa_4M_config:	unconfig
-	@mkdir -p $(obj)include
-	@if [ "$(findstring _4M_,$@)" ] ; then \
-		echo "#define CONFIG_STXSSA_4M" >>$(obj)include/config.h ; \
-		$(XECHO) "... with 4 MiB flash memory" ; \
-	fi
-	@$(MKCONFIG) -a stxssa ppc mpc85xx stxssa
-
-TQM8540_config		\
-TQM8541_config		\
-TQM8548_config		\
-TQM8548_AG_config	\
-TQM8548_BE_config	\
-TQM8555_config		\
-TQM8560_config:		unconfig
-	@mkdir -p $(obj)include
-	@BTYPE=$(@:_config=); \
-	CTYPE=$(subst TQM,,$(subst _AG,,$(subst _BE,,$(@:_config=)))); \
-	$(XECHO) "... "$${BTYPE}" (MPC"$${CTYPE}")"; \
-	echo "#define CONFIG_MPC$${CTYPE}">>$(obj)include/config.h; \
-	echo "#define CONFIG_$${BTYPE}">>$(obj)include/config.h; \
-	echo "#define CONFIG_HOSTNAME tqm$${CTYPE}">>$(obj)include/config.h; \
-	echo "#define CONFIG_BOARDNAME \"$${BTYPE}\"">>$(obj)include/config.h;
-	@$(MKCONFIG) -a TQM85xx ppc mpc85xx tqm85xx tqc
-	@echo "CONFIG_$(@:_config=) = y">>$(obj)include/config.mk;
-
-XPEDITE5200_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc85xx xpedite5200 xes
-
-XPEDITE5370_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc85xx xpedite5370 xes
-
-#########################################################################
-## MPC86xx Systems
-#########################################################################
-
-MPC8610HPCD_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc86xx mpc8610hpcd freescale
-
-MPC8641HPCN_36BIT_config \
-MPC8641HPCN_config:    unconfig
-	@mkdir -p $(obj)include
-	@if [ "$(findstring _36BIT_,$@)" ] ; then \
-		echo "#define CONFIG_PHYS_64BIT" >>$(obj)include/config.h ; \
-		$(XECHO) "... enabling 36-bit physical addressing." ; \
-	fi
-	@$(MKCONFIG) -a MPC8641HPCN ppc mpc86xx mpc8641hpcn freescale
-
-sbc8641d_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc86xx sbc8641d
-
-XPEDITE5170_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc mpc86xx xpedite5170 xes
-
-#########################################################################
-## 74xx/7xx Systems
-#########################################################################
-
-AmigaOneG3SE_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc 74xx_7xx AmigaOneG3SE MAI
-
-BAB7xx_config: unconfig
-	@$(MKCONFIG) $(@:_config=) ppc 74xx_7xx bab7xx eltec
-
-CPCI750_config:	unconfig
-	@$(MKCONFIG) CPCI750 ppc 74xx_7xx cpci750 esd
-
-DB64360_config:	unconfig
-	@$(MKCONFIG) DB64360 ppc 74xx_7xx db64360 Marvell
-
-DB64460_config:	unconfig
-	@$(MKCONFIG) DB64460 ppc 74xx_7xx db64460 Marvell
-
-ELPPC_config: unconfig
-	@$(MKCONFIG) $(@:_config=) ppc 74xx_7xx elppc eltec
-
-EVB64260_config	\
-EVB64260_750CX_config:	unconfig
-	@$(MKCONFIG) EVB64260 ppc 74xx_7xx evb64260
-
-mpc7448hpc2_config:  unconfig
-	@$(MKCONFIG) $(@:_config=) ppc 74xx_7xx mpc7448hpc2 freescale
-
-P3G4_config: unconfig
-	@$(MKCONFIG) $(@:_config=) ppc 74xx_7xx evb64260
-
-p3m750_config	\
-p3m7448_config:		unconfig
-	@mkdir -p $(obj)include
-	@if [ "$(findstring 750_,$@)" ] ; then \
-		echo "#define CONFIG_P3M750" >>$(obj)include/config.h ; \
-	else \
-		echo "#define CONFIG_P3M7448" >>$(obj)include/config.h ; \
-	fi
-	@$(MKCONFIG) -a p3mx ppc 74xx_7xx p3mx prodrive
-
-PCIPPC2_config \
-PCIPPC6_config: unconfig
-	@$(MKCONFIG) $(@:_config=) ppc 74xx_7xx pcippc2
-
-ppmc7xx_config: unconfig
-	@$(MKCONFIG) $(@:_config=) ppc 74xx_7xx ppmc7xx
-
-ZUMA_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) ppc 74xx_7xx evb64260
-
-#========================================================================
-# ARM
-#========================================================================
-#########################################################################
-## StrongARM Systems
-#########################################################################
-
-assabet_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm sa1100 assabet
-
-dnp1110_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm sa1100 dnp1110
-
-gcplus_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm sa1100 gcplus
-
-lart_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm sa1100 lart
-
-shannon_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm sa1100 shannon
-
-#########################################################################
-## ARM92xT Systems
-#########################################################################
-
-#########################################################################
-## Atmel AT91RM9200 Systems
-#########################################################################
-
-at91rm9200dk_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm920t at91rm9200dk atmel at91rm9200
-
-at91rm9200ek_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm920t at91rm9200ek atmel at91rm9200
-
-cmc_pu2_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm920t cmc_pu2 NULL at91rm9200
-
-csb637_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm920t csb637 NULL at91rm9200
-
-kb9202_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm920t kb9202 NULL at91rm9200
-
-m501sk_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm920t m501sk NULL at91rm9200
-
-mp2usb_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm920t mp2usb NULL at91rm9200
-
-#########################################################################
-## Atmel ARM926EJ-S Systems
-#########################################################################
-
-afeb9260_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm926ejs afeb9260 NULL at91
-
-at91cap9adk_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm926ejs at91cap9adk atmel at91
-
-at91sam9260ek_nandflash_config \
-at91sam9260ek_dataflash_cs0_config \
-at91sam9260ek_dataflash_cs1_config \
-at91sam9260ek_config \
-at91sam9g20ek_nandflash_config \
-at91sam9g20ek_dataflash_cs0_config \
-at91sam9g20ek_dataflash_cs1_config \
-at91sam9g20ek_config	:	unconfig
-	@mkdir -p $(obj)include
-	@if [ "$(findstring 9g20,$@)" ] ; then \
-		echo "#define CONFIG_AT91SAM9G20EK 1"	>>$(obj)include/config.h ; \
-		$(XECHO) "... 9G20 Variant" ; \
-	else \
-		echo "#define CONFIG_AT91SAM9260EK 1"	>>$(obj)include/config.h ; \
-	fi;
-	@if [ "$(findstring _nandflash,$@)" ] ; then \
-		echo "#define CONFIG_SYS_USE_NANDFLASH 1"	>>$(obj)include/config.h ; \
-		$(XECHO) "... with environment variable in NAND FLASH" ; \
-	elif [ "$(findstring dataflash_cs0,$@)" ] ; then \
-		echo "#define CONFIG_SYS_USE_DATAFLASH_CS0 1"	>>$(obj)include/config.h ; \
-		$(XECHO) "... with environment variable in SPI DATAFLASH CS0" ; \
-	else \
-		echo "#define CONFIG_SYS_USE_DATAFLASH_CS1 1"	>>$(obj)include/config.h ; \
-		$(XECHO) "... with environment variable in SPI DATAFLASH CS1" ; \
-	fi;
-	@$(MKCONFIG) -a at91sam9260ek arm arm926ejs at91sam9260ek atmel at91
-
-at91sam9xeek_nandflash_config \
-at91sam9xeek_dataflash_cs0_config \
-at91sam9xeek_dataflash_cs1_config \
-at91sam9xeek_config	:	unconfig
-	@mkdir -p $(obj)include
-	@if [ "$(findstring _nandflash,$@)" ] ; then \
-		echo "#define CONFIG_SYS_USE_NANDFLASH 1"	>>$(obj)include/config.h ; \
-		$(XECHO) "... with environment variable in NAND FLASH" ; \
-	elif [ "$(findstring dataflash_cs0,$@)" ] ; then \
-		echo "#define CONFIG_SYS_USE_DATAFLASH_CS0 1"	>>$(obj)include/config.h ; \
-		$(XECHO) "... with environment variable in SPI DATAFLASH CS0" ; \
-	else \
-		echo "#define CONFIG_SYS_USE_DATAFLASH_CS1 1"	>>$(obj)include/config.h ; \
-		$(XECHO) "... with environment variable in SPI DATAFLASH CS1" ; \
-	fi;
-	@$(MKCONFIG) -n at91sam9xeek -a at91sam9260ek arm arm926ejs at91sam9260ek atmel at91
-
-at91sam9261ek_nandflash_config \
-at91sam9261ek_dataflash_cs0_config \
-at91sam9261ek_dataflash_cs3_config \
-at91sam9261ek_config \
-at91sam9g10ek_nandflash_config \
-at91sam9g10ek_dataflash_cs0_config \
-at91sam9g10ek_dataflash_cs3_config \
-at91sam9g10ek_config	:	unconfig
-	@mkdir -p $(obj)include
-	@if [ "$(findstring 9g10,$@)" ] ; then \
-		echo "#define CONFIG_AT91SAM9G10EK 1"	>>$(obj)include/config.h ; \
-		$(XECHO) "... 9G10 Variant" ; \
-	else \
-		echo "#define CONFIG_AT91SAM9261EK 1"	>>$(obj)include/config.h ; \
-	fi;
-	@if [ "$(findstring _nandflash,$@)" ] ; then \
-		echo "#define CONFIG_SYS_USE_NANDFLASH 1"	>>$(obj)include/config.h ; \
-		$(XECHO) "... with environment variable in NAND FLASH" ; \
-	elif [ "$(findstring dataflash_cs0,$@)" ] ; then \
-		echo "#define CONFIG_SYS_USE_DATAFLASH_CS3 1"	>>$(obj)include/config.h ; \
-		$(XECHO) "... with environment variable in SPI DATAFLASH CS3" ; \
-	else \
-		echo "#define CONFIG_SYS_USE_DATAFLASH_CS0 1"	>>$(obj)include/config.h ; \
-		$(XECHO) "... with environment variable in SPI DATAFLASH CS0" ; \
-	fi;
-	@$(MKCONFIG) -a at91sam9261ek arm arm926ejs at91sam9261ek atmel at91
-
-at91sam9263ek_norflash_config \
-at91sam9263ek_norflash_boot_config \
-at91sam9263ek_nandflash_config \
-at91sam9263ek_dataflash_config \
-at91sam9263ek_dataflash_cs0_config \
-at91sam9263ek_config	:	unconfig
-	@mkdir -p $(obj)include
-	@if [ "$(findstring _nandflash,$@)" ] ; then \
-		echo "#define CONFIG_SYS_USE_NANDFLASH 1"	>>$(obj)include/config.h ; \
-		$(XECHO) "... with environment variable in NAND FLASH" ; \
-	elif [ "$(findstring norflash,$@)" ] ; then \
-		echo "#define CONFIG_SYS_USE_NORFLASH 1"	>>$(obj)include/config.h ; \
-		$(XECHO) "... with environment variable in NOR FLASH" ; \
-	else \
-		echo "#define CONFIG_SYS_USE_DATAFLASH 1"	>>$(obj)include/config.h ; \
-		$(XECHO) "... with environment variable in SPI DATAFLASH CS0" ; \
-	fi;
-	@if [ "$(findstring norflash_boot,$@)" ] ; then \
-		echo "#define CONFIG_SYS_USE_BOOT_NORFLASH 1"	>>$(obj)include/config.h ; \
-		$(XECHO) "... and boot from NOR FLASH" ; \
-	fi;
-	@$(MKCONFIG) -a at91sam9263ek arm arm926ejs at91sam9263ek atmel at91
-
-at91sam9rlek_nandflash_config \
-at91sam9rlek_dataflash_config \
-at91sam9rlek_dataflash_cs0_config \
-at91sam9rlek_config	:	unconfig
-	@mkdir -p $(obj)include
-	@if [ "$(findstring _nandflash,$@)" ] ; then \
-		echo "#define CONFIG_SYS_USE_NANDFLASH 1"	>>$(obj)include/config.h ; \
-		$(XECHO) "... with environment variable in NAND FLASH" ; \
-	else \
-		echo "#define CONFIG_SYS_USE_DATAFLASH 1"	>>$(obj)include/config.h ; \
-		$(XECHO) "... with environment variable in SPI DATAFLASH CS0" ; \
-	fi;
-	@$(MKCONFIG) -a at91sam9rlek arm arm926ejs at91sam9rlek atmel at91
-
-meesc_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm926ejs meesc esd at91
-
-pm9261_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm926ejs pm9261 ronetix at91
-
-at91sam9m10g45ek_nandflash_config \
-at91sam9m10g45ek_dataflash_config \
-at91sam9m10g45ek_dataflash_cs0_config \
-at91sam9m10g45ek_config \
-at91sam9g45ekes_nandflash_config \
-at91sam9g45ekes_dataflash_config \
-at91sam9g45ekes_dataflash_cs0_config \
-at91sam9g45ekes_config	:	unconfig
-	@mkdir -p $(obj)include
-		@if [ "$(findstring 9m10,$@)" ] ; then \
-		echo "#define CONFIG_AT91SAM9M10G45EK 1"	>>$(obj)include/config.h ; \
-		$(XECHO) "... 9M10G45 Variant" ; \
-	else \
-		echo "#define CONFIG_AT91SAM9G45EKES 1"	>>$(obj)include/config.h ; \
-	fi;
-
-	@if [ "$(findstring _nandflash,$@)" ] ; then \
-		echo "#define CONFIG_SYS_USE_NANDFLASH 1"	>>$(obj)include/config.h ; \
-		$(XECHO) "... with environment variable in NAND FLASH" ; \
-	else \
-		echo "#define CONFIG_ATMEL_SPI 1"	>>$(obj)include/config.h ; \
-		$(XECHO) "... with environment variable in SPI DATAFLASH CS0" ; \
-	fi;
-	@$(MKCONFIG) -a at91sam9m10g45ek arm arm926ejs at91sam9m10g45ek atmel at91
-
-pm9263_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm926ejs pm9263 ronetix at91
-
-########################################################################
-## ARM Integrator boards - see doc/README-integrator for more info.
-integratorap_config	\
-ap_config		\
-ap966_config		\
-ap922_config		\
-ap922_XA10_config	\
-ap7_config		\
-ap720t_config		\
-ap920t_config		\
-ap926ejs_config		\
-ap946es_config: unconfig
-	@board/armltd/integrator/split_by_variant.sh ap $@
-
-integratorcp_config	\
-cp_config		\
-cp920t_config		\
-cp926ejs_config		\
-cp946es_config		\
-cp1136_config		\
-cp966_config		\
-cp922_config		\
-cp922_XA10_config	\
-cp1026_config: unconfig
-	@board/armltd/integrator/split_by_variant.sh cp $@
-
-davinci_dvevm_config :	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm926ejs dvevm davinci davinci
-
-davinci_schmoogie_config :	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm926ejs schmoogie davinci davinci
-
-davinci_sffsdr_config :	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm926ejs sffsdr davinci davinci
-
-davinci_sonata_config :	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm926ejs sonata davinci davinci
-
-davinci_dm355evm_config :	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm926ejs dm355evm davinci davinci
-
-lpd7a400_config \
-lpd7a404_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm lh7a40x lpd7a40x
-
-mv88f6281gtw_ge_config: unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm926ejs $(@:_config=) Marvell kirkwood
-
-mx1ads_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm920t mx1ads NULL imx
-
-mx1fs2_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm920t mx1fs2 NULL imx
-
-netstar_config:		unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm925t netstar
-
-nhk8815_config \
-nhk8815_onenand_config:	unconfig
-	@mkdir -p $(obj)include
-	@ > $(obj)include/config.h
-	@if [ "$(findstring _onenand, $@)" ] ; then \
-		echo "#define CONFIG_BOOT_ONENAND" >> $(obj)include/config.h; \
-		$(XECHO) "... configured to boot from OneNand Flash"; \
-	else \
-		$(XECHO) "... configured to boot from Nand Flash"; \
-	fi
-	@$(MKCONFIG) -a nhk8815 arm arm926ejs nhk8815 st nomadik
-
-omap1510inn_config :	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm925t omap1510inn
-
-xtract_omap1610xxx = $(subst _cs0boot,,$(subst _cs3boot,,$(subst _cs_autoboot,,$(subst _config,,$1))))
-
-omap1610inn_config \
-omap1610inn_cs0boot_config \
-omap1610inn_cs3boot_config \
-omap1610inn_cs_autoboot_config \
-omap1610h2_config \
-omap1610h2_cs0boot_config \
-omap1610h2_cs3boot_config \
-omap1610h2_cs_autoboot_config:	unconfig
-	@mkdir -p $(obj)include
-	@if [ "$(findstring _cs0boot_, $@)" ] ; then \
-		echo "#define CONFIG_CS0_BOOT" >> .$(obj)include/config.h ; \
-		$(XECHO) "... configured for CS0 boot"; \
-	elif [ "$(findstring _cs_autoboot_, $@)" ] ; then \
-		echo "#define CONFIG_CS_AUTOBOOT" >> $(obj)include/config.h ; \
-		$(XECHO) "... configured for CS_AUTO boot"; \
-	else \
-		echo "#define CONFIG_CS3_BOOT" >> $(obj)include/config.h ; \
-		$(XECHO) "... configured for CS3 boot"; \
-	fi;
-	@$(MKCONFIG) -a $(call xtract_omap1610xxx,$@) arm arm926ejs omap1610inn NULL omap
-
-omap5912osk_config :	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm926ejs omap5912osk NULL omap
-
-xtract_omap730p2 = $(subst _cs0boot,,$(subst _cs3boot,, $(subst _config,,$1)))
-
-omap730p2_config \
-omap730p2_cs0boot_config \
-omap730p2_cs3boot_config :	unconfig
-	@mkdir -p $(obj)include
-	@if [ "$(findstring _cs0boot_, $@)" ] ; then \
-		echo "#define CONFIG_CS0_BOOT" >> $(obj)include/config.h ; \
-		$(XECHO) "... configured for CS0 boot"; \
-	else \
-		echo "#define CONFIG_CS3_BOOT" >> $(obj)include/config.h ; \
-		$(XECHO) "... configured for CS3 boot"; \
-	fi;
-	@$(MKCONFIG) -a $(call xtract_omap730p2,$@) arm arm926ejs omap730p2 NULL omap
-
-rd6281a_config: unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm926ejs $(@:_config=) Marvell kirkwood
-
-sbc2410x_config: unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm920t sbc2410x NULL s3c24x0
-
-scb9328_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm920t scb9328 NULL imx
-
-sheevaplug_config: unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm926ejs $(@:_config=) Marvell kirkwood
-
-smdk2400_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm920t smdk2400 samsung s3c24x0
-
-smdk2410_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm920t smdk2410 samsung s3c24x0
-
-SX1_stdout_serial_config \
-SX1_config:		unconfig
-	@mkdir -p $(obj)include
-	@if [ "$(findstring _stdout_serial_, $@)" ] ; then \
-		echo "#undef CONFIG_STDOUT_USBTTY" >> $(obj)include/config.h ; \
-		$(XECHO) "... configured for stdout serial"; \
-	else \
-		echo "#define CONFIG_STDOUT_USBTTY" >> $(obj)include/config.h ; \
-		$(XECHO) "... configured for stdout usbtty"; \
-	fi;
-	@$(MKCONFIG) SX1 arm arm925t sx1
-
-# TRAB default configuration:	8 MB Flash, 32 MB RAM
-xtract_trab = $(subst _bigram,,$(subst _bigflash,,$(subst _old,,$(subst _config,,$1))))
-
-trab_config \
-trab_bigram_config \
-trab_bigflash_config \
-trab_old_config:	unconfig
-	@mkdir -p $(obj)include
-	@mkdir -p $(obj)board/trab
-	@[ -z "$(findstring _bigram,$@)" ] || \
-		{ echo "#define CONFIG_FLASH_8MB"  >>$(obj)include/config.h ; \
-		  echo "#define CONFIG_RAM_32MB"   >>$(obj)include/config.h ; \
-		  $(XECHO) "... with 8 MB Flash, 32 MB RAM" ; \
-		}
-	@[ -z "$(findstring _bigflash,$@)" ] || \
-		{ echo "#define CONFIG_FLASH_16MB" >>$(obj)include/config.h ; \
-		  echo "#define CONFIG_RAM_16MB"   >>$(obj)include/config.h ; \
-		  $(XECHO) "... with 16 MB Flash, 16 MB RAM" ; \
-		  echo "TEXT_BASE = 0x0CF40000" >$(obj)board/trab/config.tmp ; \
-		}
-	@[ -z "$(findstring _old,$@)" ] || \
-		{ echo "#define CONFIG_FLASH_8MB"  >>$(obj)include/config.h ; \
-		  echo "#define CONFIG_RAM_16MB"   >>$(obj)include/config.h ; \
-		  $(XECHO) "... with 8 MB Flash, 16 MB RAM" ; \
-		  echo "TEXT_BASE = 0x0CF40000" >$(obj)board/trab/config.tmp ; \
-		}
-	@$(MKCONFIG) -a $(call xtract_trab,$@) arm arm920t trab NULL s3c24x0
-
-VCMA9_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm920t vcma9 mpl s3c24x0
-
-#########################################################################
-# ARM supplied Versatile development boards
-#########################################################################
-
-cm4008_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm920t cm4008 NULL ks8695
-
-cm41xx_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm920t cm41xx NULL ks8695
-
-versatile_config	\
-versatileab_config	\
-versatilepb_config :	unconfig
-	@board/armltd/versatile/split_by_variant.sh $@
-
-voiceblue_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm925t voiceblue
-
-#########################################################################
-## S3C44B0 Systems
-#########################################################################
-
-B2_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm s3c44b0 B2 dave
-
-#########################################################################
-## ARM720T Systems
-#########################################################################
-
-armadillo_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm720t armadillo
-
-ep7312_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm720t ep7312
-
-impa7_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm720t impa7
-
-modnet50_config :	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm720t modnet50
-
-evb4510_config :	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm720t evb4510 NULL s3c4510b
-
-lpc2292sodimm_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm720t lpc2292sodimm NULL lpc2292
-
-SMN42_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm720t SMN42 siemens lpc2292
-
-#########################################################################
-## ARM CORTEX Systems
-#########################################################################
-
-omap3_beagle_config :	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm_cortexa8 beagle omap3 omap3
-
-omap3_overo_config :	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm_cortexa8 overo omap3 omap3
-
-omap3_evm_config :	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm_cortexa8 evm omap3 omap3
-
-omap3_pandora_config :	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm_cortexa8 pandora omap3 omap3
-
-omap3_zoom1_config :	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm_cortexa8 zoom1 omap3 omap3
-
-vpe_apollo_config :	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm_cortexa8 vpe_apollo nxp pnx84xx
-
-vpe_apollo_eth_emu_config :	unconfig
-	@mkdir -p $(obj)include
-	@ >$(obj)include/config.h
-	@echo "#define CONFIG_LIPP_6300ETH" >>$(obj)include/config.h
-	@echo "#define CONFIG_USING_EMU_PHY" >>$(obj)include/config.h
-	@echo "#define __USING_EMU_PHY__" >>$(obj)include/config.h
-	@echo "#define TMFL_LIPP6100ETH_GMII_ADDRESS_CSR_VAL 0x0U" >>$(obj)include/config.h
-	@echo "#define TMFL_LIPP6100ETH_GMII_PHY_ADDRESS_VAL 0x0U" >>$(obj)include/config.h
-	@$(MKCONFIG) $(@:_eth_emu_config=) arm arm_cortexa8 vpe_apollo nxp pnx84xx
-
-omap3_zoom2_config :	unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm_cortexa8 zoom2 omap3 omap3
-
-#########################################################################
-## XScale Systems
-#########################################################################
-
-actux1_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm ixp actux1
-
-actux2_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm ixp actux2
-
-actux3_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm ixp actux3
-
-actux4_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm ixp actux4
-
-cerf250_config :	unconfig
-	@$(MKCONFIG) $(@:_config=) arm pxa cerf250
-
-cradle_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm pxa cradle
-
-csb226_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm pxa csb226
-
-delta_config :	unconfig
-	@$(MKCONFIG) $(@:_config=) arm pxa delta
-
-innokom_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm pxa innokom
-
-ixdp425_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm ixp ixdp425
-
-ixdpg425_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm ixp ixdp425
-
-lubbock_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm pxa lubbock
-
-pleb2_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm pxa pleb2
-
-logodl_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm pxa logodl
-
-pdnb3_config \
-scpu_config:	unconfig
-	@mkdir -p $(obj)include
-	@if [ "$(findstring scpu_,$@)" ] ; then \
-		echo "#define CONFIG_SCPU"	>>$(obj)include/config.h ; \
-		$(XECHO) "... on SCPU board variant" ; \
-	fi
-	@$(MKCONFIG) -a pdnb3 arm ixp pdnb3 prodrive
-
-pxa255_idp_config:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm pxa pxa255_idp
-
-polaris_config \
-trizepsiv_config	:	unconfig
-	@mkdir -p $(obj)include
-	@if [ "$(findstring polaris,$@)" ] ; then \
-		echo "#define CONFIG_POLARIS 1"	>>$(obj)include/config.h ; \
-	fi;
-	@$(MKCONFIG) -a trizepsiv arm pxa trizepsiv
-
-wepep250_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm pxa wepep250
-
-xaeniax_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm pxa xaeniax
-
-xm250_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) arm pxa xm250
-
-xsengine_config :	unconfig
-	@$(MKCONFIG) $(@:_config=) arm pxa xsengine
-
-zylonite_config :
-	@$(MKCONFIG) $(@:_config=) arm pxa zylonite
-
-#########################################################################
-## ARM1136 Systems
-#########################################################################
-
-apollon_config		: unconfig
-	@mkdir -p $(obj)include
-	@mkdir -p $(obj)onenand_ipl/board/apollon
-	@echo "#define CONFIG_ONENAND_U_BOOT" > $(obj)include/config.h
-	@$(MKCONFIG) $(@:_config=) arm arm1136 apollon NULL omap24xx
-	@echo "CONFIG_ONENAND_U_BOOT = y" >> $(obj)include/config.mk
-
-imx31_litekit_config	: unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm1136 imx31_litekit NULL mx31
-
-imx31_phycore_eet_config \
-imx31_phycore_config	: unconfig
-	@mkdir -p $(obj)include
-	@if [ -n "$(findstring _eet_,$@)" ]; then			\
-		echo "#define CONFIG_IMX31_PHYCORE_EET" >> $(obj)include/config.h;	\
-	fi
-	@$(MKCONFIG) -a imx31_phycore arm arm1136 imx31_phycore NULL mx31
-
-mx31ads_config		: unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm1136 mx31ads freescale mx31
-
-mx31pdk_config \
-mx31pdk_nand_config	: unconfig
-	@mkdir -p $(obj)include
-	@if [ -n "$(findstring _nand_,$@)" ]; then					\
-		echo "#define CONFIG_NAND_U_BOOT" >> $(obj)include/config.h;		\
-	else										\
-		echo "#define CONFIG_SKIP_LOWLEVEL_INIT" >> $(obj)include/config.h;	\
-		echo "#define CONFIG_SKIP_RELOCATE_UBOOT" >> $(obj)include/config.h;	\
-	fi
-	@$(MKCONFIG) -a mx31pdk arm arm1136 mx31pdk freescale mx31
-
-omap2420h4_config	: unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm1136 omap2420h4 NULL omap24xx
-
-qong_config		: unconfig
-	@$(MKCONFIG) $(@:_config=) arm arm1136 qong davedenx mx31
-
-#########################################################################
-## ARM1176 Systems
-#########################################################################
-smdk6400_noUSB_config	\
-smdk6400_config	:	unconfig
-	@mkdir -p $(obj)include $(obj)board/samsung/smdk6400
-	@mkdir -p $(obj)nand_spl/board/samsung/smdk6400
-	@echo "#define CONFIG_NAND_U_BOOT" > $(obj)include/config.h
-	@if [ -z "$(findstring smdk6400_noUSB_config,$@)" ]; then			\
-		echo "RAM_TEXT = 0x57e00000" >> $(obj)board/samsung/smdk6400/config.tmp;\
-		$(MKCONFIG) $(@:_config=) arm arm1176 smdk6400 samsung s3c64xx;		\
-	else										\
-		echo "RAM_TEXT = 0xc7e00000" >> $(obj)board/samsung/smdk6400/config.tmp;\
-		$(MKCONFIG) $(@:_noUSB_config=) arm arm1176 smdk6400 samsung s3c64xx;	\
-	fi
-	@echo "CONFIG_NAND_U_BOOT = y" >> $(obj)include/config.mk
-
-#========================================================================
-# i386
-#========================================================================
-#########################################################################
-## AMD SC520 CDP
-#########################################################################
-eNET_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) i386 i386 eNET NULL sc520
-
-sc520_cdp_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) i386 i386 sc520_cdp NULL sc520
-
-sc520_spunk_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) i386 i386 sc520_spunk NULL sc520
-
-sc520_spunk_rel_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) i386 i386 sc520_spunk NULL sc520
-
-#========================================================================
-# MIPS
-#========================================================================
-#########################################################################
-## MIPS32 4Kc
-#########################################################################
-
-xtract_incaip = $(subst _100MHz,,$(subst _133MHz,,$(subst _150MHz,,$(subst _config,,$1))))
-
-incaip_100MHz_config	\
-incaip_133MHz_config	\
-incaip_150MHz_config	\
-incaip_config: unconfig
-	@mkdir -p $(obj)include
-	@[ -z "$(findstring _100MHz,$@)" ] || \
-		{ echo "#define CPU_CLOCK_RATE 100000000" >>$(obj)include/config.h ; \
-		  $(XECHO) "... with 100MHz system clock" ; \
-		}
-	@[ -z "$(findstring _133MHz,$@)" ] || \
-		{ echo "#define CPU_CLOCK_RATE 133000000" >>$(obj)include/config.h ; \
-		  $(XECHO) "... with 133MHz system clock" ; \
-		}
-	@[ -z "$(findstring _150MHz,$@)" ] || \
-		{ echo "#define CPU_CLOCK_RATE 150000000" >>$(obj)include/config.h ; \
-		  $(XECHO) "... with 150MHz system clock" ; \
-		}
-	@$(MKCONFIG) -a $(call xtract_incaip,$@) mips mips incaip
-
-tb0229_config: unconfig
-	@$(MKCONFIG) $(@:_config=) mips mips tb0229
-
-vct_premium_config		\
-vct_premium_small_config	\
-vct_premium_onenand_config	\
-vct_premium_onenand_small_config \
-vct_platinum_config		\
-vct_platinum_small_config	\
-vct_platinum_onenand_config	\
-vct_platinum_onenand_small_config \
-vct_platinumavc_config		\
-vct_platinumavc_small_config	\
-vct_platinumavc_onenand_config	\
-vct_platinumavc_onenand_small_config: unconfig
-	@mkdir -p $(obj)include
-	@if [ "$(findstring _premium,$@)" ] ; then \
-		echo "#define CONFIG_VCT_PREMIUM" > $(obj)include/config.h ; \
-		$(XECHO) "... on Premium board variant" ; \
-	fi
-	@if [ "$(findstring _platinum_,$@)" ] ; then \
-		echo "#define CONFIG_VCT_PLATINUM" > $(obj)include/config.h ; \
-		$(XECHO) "... on Platinum board variant" ; \
-	fi
-	@if [ "$(findstring _platinumavc,$@)" ] ; then \
-		echo "#define CONFIG_VCT_PLATINUMAVC" > $(obj)include/config.h ; \
-		$(XECHO) "... on PlatinumAVC board variant" ; \
-	fi
-	@if [ "$(findstring _onenand,$@)" ] ; then \
-		echo "#define CONFIG_VCT_ONENAND" >> $(obj)include/config.h ; \
-		$(XECHO) "... on OneNAND board variant" ; \
-	fi
-	@if [ "$(findstring _small,$@)" ] ; then \
-		echo "#define CONFIG_VCT_SMALL_IMAGE" >> $(obj)include/config.h ; \
-		$(XECHO) "... stripped down image variant" ; \
-	fi
-	@$(MKCONFIG) -a vct mips mips vct micronas
-
-#########################################################################
-## MIPS32 AU1X00
-#########################################################################
-
-dbau1000_config		:	unconfig
-	@mkdir -p $(obj)include
-	@echo "#define CONFIG_DBAU1000 1" >$(obj)include/config.h
-	@$(MKCONFIG) -a dbau1x00 mips mips dbau1x00
-
-dbau1100_config		:	unconfig
-	@mkdir -p $(obj)include
-	@echo "#define CONFIG_DBAU1100 1" >$(obj)include/config.h
-	@$(MKCONFIG) -a dbau1x00 mips mips dbau1x00
-
-dbau1500_config		:	unconfig
-	@mkdir -p $(obj)include
-	@echo "#define CONFIG_DBAU1500 1" >$(obj)include/config.h
-	@$(MKCONFIG) -a dbau1x00 mips mips dbau1x00
-
-dbau1550_config		:	unconfig
-	@mkdir -p $(obj)include
-	@echo "#define CONFIG_DBAU1550 1" >$(obj)include/config.h
-	@$(MKCONFIG) -a dbau1x00 mips mips dbau1x00
-
-dbau1550_el_config	:	unconfig
-	@mkdir -p $(obj)include
-	@echo "#define CONFIG_DBAU1550 1" >$(obj)include/config.h
-	@$(MKCONFIG) -a dbau1x00 mips mips dbau1x00
-
-gth2_config		:	unconfig
-	@mkdir -p $(obj)include
-	@echo "#define CONFIG_GTH2 1" >$(obj)include/config.h
-	@$(MKCONFIG) -a gth2 mips mips gth2
-
-pb1000_config		:	unconfig
-	@mkdir -p $(obj)include
-	@echo "#define CONFIG_PB1000 1" >$(obj)include/config.h
-	@$(MKCONFIG) -a pb1x00 mips mips pb1x00
-
-qemu_mips_config	: unconfig
-	@mkdir -p $(obj)include
-	@echo "#define CONFIG_QEMU_MIPS 1" >$(obj)include/config.h
-	@$(MKCONFIG) -a qemu-mips mips mips qemu-mips
-
-#########################################################################
-## MIPS64 5Kc
-#########################################################################
-
-purple_config :		unconfig
-	@$(MKCONFIG) $(@:_config=) mips mips purple
-
-#========================================================================
-# Nios
-#========================================================================
-#########################################################################
-## Nios32
-#########################################################################
-
-ADNPESC1_DNPEVA2_base_32_config	\
-ADNPESC1_base_32_config		\
-ADNPESC1_config: unconfig
-	@mkdir -p $(obj)include
-	@[ -z "$(findstring _DNPEVA2,$@)" ] || \
-		{ echo "#define CONFIG_DNPEVA2 1" >>$(obj)include/config.h ; \
-		  $(XECHO) "... DNP/EVA2 configuration" ; \
-		}
-	@[ -z "$(findstring _base_32,$@)" ] || \
-		{ echo "#define CONFIG_NIOS_BASE_32 1" >>$(obj)include/config.h ; \
-		  $(XECHO) "... NIOS 'base_32' configuration" ; \
-		}
-	@[ -z "$(findstring ADNPESC1_config,$@)" ] || \
-		{ echo "#define CONFIG_NIOS_BASE_32 1" >>$(obj)include/config.h ; \
-		  $(XECHO) "... NIOS 'base_32' configuration (DEFAULT)" ; \
-		}
-	@$(MKCONFIG) -a ADNPESC1 nios nios adnpesc1 ssv
-
-DK1C20_safe_32_config		\
-DK1C20_standard_32_config	\
-DK1C20_config:	unconfig
-	@mkdir -p $(obj)include
-	@[ -z "$(findstring _safe_32,$@)" ] || \
-		{ echo "#define CONFIG_NIOS_SAFE_32 1" >>$(obj)include/config.h ; \
-		  $(XECHO) "... NIOS 'safe_32' configuration" ; \
-		}
-	@[ -z "$(findstring _standard_32,$@)" ] || \
-		{ echo "#define CONFIG_NIOS_STANDARD_32 1" >>$(obj)include/config.h ; \
-		  $(XECHO) "... NIOS 'standard_32' configuration" ; \
-		}
-	@[ -z "$(findstring DK1C20_config,$@)" ] || \
-		{ echo "#define CONFIG_NIOS_STANDARD_32 1" >>$(obj)include/config.h ; \
-		  $(XECHO) "... NIOS 'standard_32' configuration (DEFAULT)" ; \
-		}
-	@$(MKCONFIG) -a DK1C20 nios nios dk1c20 altera
-
-DK1S10_safe_32_config		\
-DK1S10_standard_32_config	\
-DK1S10_mtx_ldk_20_config	\
-DK1S10_config:	unconfig
-	@mkdir -p $(obj)include
-	@[ -z "$(findstring _safe_32,$@)" ] || \
-		{ echo "#define CONFIG_NIOS_SAFE_32 1" >>$(obj)include/config.h ; \
-		  $(XECHO) "... NIOS 'safe_32' configuration" ; \
-		}
-	@[ -z "$(findstring _standard_32,$@)" ] || \
-		{ echo "#define CONFIG_NIOS_STANDARD_32 1" >>$(obj)include/config.h ; \
-		  $(XECHO) "... NIOS 'standard_32' configuration" ; \
-		}
-	@[ -z "$(findstring _mtx_ldk_20,$@)" ] || \
-		{ echo "#define CONFIG_NIOS_MTX_LDK_20 1" >>$(obj)include/config.h ; \
-		  $(XECHO) "... NIOS 'mtx_ldk_20' configuration" ; \
-		}
-	@[ -z "$(findstring DK1S10_config,$@)" ] || \
-		{ echo "#define CONFIG_NIOS_STANDARD_32 1" >>$(obj)include/config.h ; \
-		  $(XECHO) "... NIOS 'standard_32' configuration (DEFAULT)" ; \
-		}
-	@$(MKCONFIG) -a DK1S10 nios nios dk1s10 altera
-
-#########################################################################
-## Nios-II
-#########################################################################
-
-EP1C20_config : unconfig
-	@$(MKCONFIG)  EP1C20 nios2 nios2 ep1c20 altera
-
-EP1S10_config : unconfig
-	@$(MKCONFIG)  EP1S10 nios2 nios2 ep1s10 altera
-
-EP1S40_config : unconfig
-	@$(MKCONFIG)  EP1S40 nios2 nios2 ep1s40 altera
-
-PK1C20_config : unconfig
-	@$(MKCONFIG)  PK1C20 nios2 nios2 pk1c20 psyent
-
-PCI5441_config : unconfig
-	@$(MKCONFIG)  PCI5441 nios2 nios2 pci5441 psyent
-
-#========================================================================
-## Microblaze
-#========================================================================
-
-microblaze-generic_config:	unconfig
-	@mkdir -p $(obj)include
-	@$(MKCONFIG) -a $(@:_config=) microblaze microblaze microblaze-generic xilinx
-
-suzaku_config:	unconfig
-	@mkdir -p $(obj)include
-	@echo "#define CONFIG_SUZAKU 1" > $(obj)include/config.h
-	@$(MKCONFIG) -a $(@:_config=) microblaze microblaze suzaku AtmarkTechno
-
-#========================================================================
-# Blackfin
-#========================================================================
-
-# Analog Devices boards
-BFIN_BOARDS = bf518f-ezbrd bf526-ezbrd bf527-ezkit bf533-ezkit bf533-stamp \
-	bf537-pnav bf537-stamp bf538f-ezkit bf548-ezkit bf561-ezkit
-
-# Bluetechnix tinyboards
-BFIN_BOARDS += cm-bf527 cm-bf533 cm-bf537e cm-bf548 cm-bf561 tcm-bf537
-
-# Misc third party boards
-BFIN_BOARDS += bf537-minotaur bf537-srv1 blackstamp
-
-# I-SYST Micromodule
-BFIN_BOARDS += ibf-dsp561
-
-$(BFIN_BOARDS:%=%_config)	: unconfig
-	@$(MKCONFIG) $(@:_config=) blackfin blackfin $(@:_config=)
-
-$(BFIN_BOARDS):
-	$(MAKE) $@_config
-	$(MAKE)
-
-#========================================================================
-# AVR32
-#========================================================================
-
-atngw100_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) avr32 at32ap atngw100 atmel at32ap700x
-
-atstk1002_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) avr32 at32ap atstk1000 atmel at32ap700x
-
-atstk1003_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) avr32 at32ap atstk1000 atmel at32ap700x
-
-atstk1004_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) avr32 at32ap atstk1000 atmel at32ap700x
-
-atstk1006_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) avr32 at32ap atstk1000 atmel at32ap700x
-
-favr-32-ezkit_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) avr32 at32ap favr-32-ezkit earthlcd at32ap700x
-
-hammerhead_config	:	unconfig
-	@$(MKCONFIG) $(@:_config=) avr32 at32ap hammerhead miromico at32ap700x
-
-mimc200_config		:	unconfig
-	@$(MKCONFIG) $(@:_config=) avr32 at32ap mimc200 mimc at32ap700x
-
-#========================================================================
-# SH3 (SuperH)
-#========================================================================
-
-#########################################################################
-## sh2 (Renesas SuperH)
-#########################################################################
-rsk7203_config: unconfig
-	@mkdir -p $(obj)include
-	@echo "#define CONFIG_RSK7203 1" > $(obj)include/config.h
-	@$(MKCONFIG) -a $(@:_config=) sh sh2 rsk7203 renesas
-
-#########################################################################
-## sh3 (Renesas SuperH)
-#########################################################################
-
-mpr2_config: unconfig
-	@mkdir -p $(obj)include
-	@echo "#define CONFIG_MPR2 1" > $(obj)include/config.h
-	@$(MKCONFIG) -a $(@:_config=) sh sh3 mpr2
-
-ms7720se_config: unconfig
-	@mkdir -p $(obj)include
-	@echo "#define CONFIG_MS7720SE 1" > $(obj)include/config.h
-	@$(MKCONFIG) -a $(@:_config=) sh sh3 ms7720se
-
-#########################################################################
-## sh4 (Renesas SuperH)
-#########################################################################
-
-MigoR_config :       unconfig
-	@mkdir -p $(obj)include
-	@echo "#define CONFIG_MIGO_R 1" > $(obj)include/config.h
-	@$(MKCONFIG) -a $(@:_config=) sh sh4 MigoR renesas
-
-ms7750se_config: unconfig
-	@mkdir -p $(obj)include
-	@echo "#define CONFIG_MS7750SE 1" > $(obj)include/config.h
-	@$(MKCONFIG) -a $(@:_config=) sh sh4 ms7750se
-
-ms7722se_config :	unconfig
-	@mkdir -p $(obj)include
-	@echo "#define CONFIG_MS7722SE 1" > $(obj)include/config.h
-	@$(MKCONFIG) -a $(@:_config=) sh sh4 ms7722se
-
-r2dplus_config  :   unconfig
-	@mkdir -p $(obj)include
-	@echo "#define CONFIG_R2DPLUS 1" > $(obj)include/config.h
-	@$(MKCONFIG) -a $(@:_config=) sh sh4 r2dplus renesas
-
-r7780mp_config: unconfig
-	@mkdir -p $(obj)include
-	@echo "#define CONFIG_R7780MP 1" > $(obj)include/config.h
-	@$(MKCONFIG) -a $(@:_config=) sh sh4 r7780mp renesas
-
-sh7763rdp_config  :   unconfig
-	@mkdir -p $(obj)include
-	@echo "#define CONFIG_SH7763RDP 1" > $(obj)include/config.h
-	@$(MKCONFIG) -a $(@:_config=) sh sh4 sh7763rdp renesas
-
-xtract_sh7785lcr = $(subst _32bit,,$(subst _config,,$1))
-sh7785lcr_32bit_config \
-sh7785lcr_config  :   unconfig
-	@mkdir -p $(obj)include
-	@mkdir -p $(obj)board/renesas/sh7785lcr
-	@echo "#define CONFIG_SH7785LCR 1" > $(obj)include/config.h
-	@if [ "$(findstring 32bit, $@)" ] ; then \
-		echo "#define CONFIG_SH_32BIT 1" >> $(obj)include/config.h ; \
-		echo "TEXT_BASE = 0x8ff80000" > \
-			$(obj)board/renesas/sh7785lcr/config.tmp ; \
-		  $(XECHO) " ... enable 32-Bit Address Extended Mode" ; \
-	fi
-	@$(MKCONFIG) -a $(call xtract_sh7785lcr,$@) sh sh4 sh7785lcr renesas
-
-ap325rxa_config  :   unconfig
-	@mkdir -p $(obj)include
-	@echo "#define CONFIG_AP325RXA 1" > $(obj)include/config.h
-	@$(MKCONFIG) -a $(@:_config=) sh sh4 ap325rxa renesas
-
-espt_config  :   unconfig
-	@mkdir -p $(obj)include
-	@echo "#define CONFIG_ESPT 1" > $(obj)include/config.h
-	@$(MKCONFIG) -a $(@:_config=) sh sh4 espt
-
-#========================================================================
-# SPARC
-#========================================================================
-
-#########################################################################
-## LEON3
-#########################################################################
-
-# Gaisler GR-XC3S-1500 board
-gr_xc3s_1500_config : unconfig
-	@$(MKCONFIG) $(@:_config=) sparc leon3 gr_xc3s_1500 gaisler
-
-# Gaisler GR-CPCI-AX2000 board, a General purpose FPGA-AX system
-gr_cpci_ax2000_config : unconfig
-	@$(MKCONFIG) $(@:_config=) sparc leon3 gr_cpci_ax2000 gaisler
-
-# Gaisler GRLIB template design (GPL SPARC/LEON3) for Altera NIOS
-# Development board Stratix II edition, FPGA Device EP2S60.
-gr_ep2s60_config: unconfig
-	@$(MKCONFIG) $(@:_config=) sparc leon3 gr_ep2s60 gaisler
-
-# Gaisler LEON3 GRSIM simulator
-grsim_config : unconfig
-	@$(MKCONFIG) $(@:_config=) sparc leon3 grsim gaisler
-
-#########################################################################
-## LEON2
-#########################################################################
-
-# Gaisler LEON2 GRSIM simulator
-grsim_leon2_config : unconfig
-	@$(MKCONFIG) $(@:_config=) sparc leon2 grsim_leon2 gaisler
-
-#########################################################################
-#########################################################################
-#########################################################################
-
-clean:
-	@rm -f $(obj)examples/standalone/82559_eeprom			  \
-	       $(obj)examples/standalone/eepro100_eeprom		  \
-	       $(obj)examples/standalone/hello_world			  \
-	       $(obj)examples/standalone/interrupt			  \
-	       $(obj)examples/standalone/mem_to_mem_idma2intr		  \
-	       $(obj)examples/standalone/sched				  \
-	       $(obj)examples/standalone/smc91111_eeprom		  \
-	       $(obj)examples/standalone/test_burst			  \
-	       $(obj)examples/standalone/timer
-	@rm -f $(obj)examples/api/demo{,.bin}
-	@rm -f $(obj)tools/bmp_logo	   $(obj)tools/easylogo/easylogo  \
-	       $(obj)tools/env/{fw_printenv,fw_setenv}			  \
-	       $(obj)tools/envcrc					  \
-	       $(obj)tools/gdb/{astest,gdbcont,gdbsend}			  \
-	       $(obj)tools/gen_eth_addr    $(obj)tools/img2srec		  \
-	       $(obj)tools/mkimage	   $(obj)tools/mpc86x_clk	  \
-	       $(obj)tools/ncb		   $(obj)tools/ubsha1
-	@rm -f $(obj)board/cray/L1/{bootscript.c,bootscript.image}	  \
-	       $(obj)board/netstar/{eeprom,crcek,crcit,*.srec,*.bin}	  \
-	       $(obj)board/trab/trab_fkt   $(obj)board/voiceblue/eeprom   \
-	       $(obj)board/armltd/{integratorap,integratorcp}/u-boot.lds  \
-	       $(obj)lib_blackfin/u-boot.lds				  \
-	       $(obj)u-boot.lds						  \
-	       $(obj)cpu/blackfin/bootrom-asm-offsets.[chs]
-	@rm -f $(obj)include/bmp_logo.h
-	@rm -f $(obj)nand_spl/{u-boot.lds,u-boot-spl,u-boot-spl.map,System.map}
-	@rm -f $(obj)onenand_ipl/onenand-{ipl,ipl.bin,ipl-2k.bin,ipl-4k.bin,ipl.map}
-	@rm -f $(obj)onenand_ipl/u-boot.lds
-	@rm -f $(TIMESTAMP_FILE) $(VERSION_FILE)
-	@find $(OBJTREE) -type f \
-		\( -name 'core' -o -name '*.bak' -o -name '*~' \
-		-o -name '*.o'	-o -name '*.a' -o -name '*.exe'	\) -print \
-		| xargs rm -f
-
-clobber:	clean
-	@find $(OBJTREE) -type f \( -name .depend \
-		-o -name '*.srec' -o -name '*.bin' -o -name u-boot.img \) \
-		-print0 \
-		| xargs -0 rm -f
-	@rm -f $(OBJS) $(obj)*.bak $(obj)ctags $(obj)etags $(obj)TAGS \
-		$(obj)cscope.* $(obj)*.*~
-	@rm -f $(obj)u-boot $(obj)u-boot.map $(obj)u-boot.hex $(ALL)
-	@rm -f $(obj)tools/{env/crc32.c,inca-swap-bytes}
-	@rm -f $(obj)cpu/mpc824x/bedbug_603e.c
-	@rm -f $(obj)include/asm/proc $(obj)include/asm/arch $(obj)include/asm
-	@[ ! -d $(obj)nand_spl ] || find $(obj)nand_spl -name "*" -type l -print | xargs rm -f
-	@[ ! -d $(obj)onenand_ipl ] || find $(obj)onenand_ipl -name "*" -type l -print | xargs rm -f
-
-ifeq ($(OBJTREE),$(SRCTREE))
-mrproper \
-distclean:	clobber unconfig
-else
-mrproper \
-distclean:	clobber unconfig
-	rm -rf $(obj)*
-endif
-
-backup:
-	F=`basename $(TOPDIR)` ; cd .. ; \
-	gtar --force-local -zcvf `date "+$$F-%Y-%m-%d-%T.tar.gz"` $$F
-
-#########################################################################
diff -Naur u-boot-2009.08.orig3/common/Makefile~ u-boot-2009.08.mine2/common/Makefile~
--- u-boot-2009.08.orig3/common/Makefile~	2010-10-13 16:01:49.512251476 -0500
+++ u-boot-2009.08.mine2/common/Makefile~	1969-12-31 18:00:00.000000000 -0600
@@ -1,193 +0,0 @@
-#
-# (C) Copyright 2004-2006
-# Wolfgang Denk, DENX Software Engineering, wd@denx.de.
-#
-# See file CREDITS for list of people who contributed to this
-# project.
-#
-# This program is free software; you can redistribute it and/or
-# modify it under the terms of the GNU General Public License as
-# published by the Free Software Foundation; either version 2 of
-# the License, or (at your option) any later version.
-#
-# This program is distributed in the hope that it will be useful,
-# but WITHOUT ANY WARRANTY; without even the implied warranty of
-# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.	See the
-# GNU General Public License for more details.
-#
-# You should have received a copy of the GNU General Public License
-# along with this program; if not, write to the Free Software
-# Foundation, Inc., 59 Temple Place, Suite 330, Boston,
-# MA 02111-1307 USA
-#
-
-include $(TOPDIR)/config.mk
-
-LIB	= $(obj)libcommon.a
-
-AOBJS	=
-
-# core
-COBJS-y += main.o
-COBJS-y += circbuf.o
-COBJS-y += console.o
-COBJS-y += command.o
-COBJS-y += dlmalloc.o
-COBJS-y += exports.o
-COBJS-$(CONFIG_SYS_HUSH_PARSER) += hush.o
-COBJS-y += image.o
-COBJS-y += memsize.o
-COBJS-y += s_record.o
-COBJS-$(CONFIG_SERIAL_MULTI) += serial.o
-COBJS-y += stdio.o
-COBJS-y += xyzModem.o
-
-# core command
-COBJS-y += cmd_boot.o
-COBJS-y += cmd_bootm.o
-COBJS-y += cmd_nvedit.o
-
-# environment
-COBJS-y += env_common.o
-COBJS-$(CONFIG_ENV_IS_IN_DATAFLASH) += env_dataflash.o
-COBJS-$(CONFIG_ENV_IS_IN_EEPROM) += env_eeprom.o
-COBJS-$(CONFIG_ENV_IS_EMBEDDED) += env_embedded.o
-COBJS-$(CONFIG_ENV_IS_IN_EEPROM) += env_embedded.o
-COBJS-$(CONFIG_ENV_IS_IN_FLASH) += env_embedded.o
-COBJS-$(CONFIG_ENV_IS_IN_NVRAM) += env_embedded.o
-COBJS-$(CONFIG_ENV_IS_IN_FLASH) += env_flash.o
-COBJS-$(CONFIG_ENV_IS_IN_MG_DISK) += env_mgdisk.o
-COBJS-$(CONFIG_ENV_IS_IN_NAND) += env_nand.o
-COBJS-$(CONFIG_ENV_IS_IN_NVRAM) += env_nvram.o
-COBJS-$(CONFIG_ENV_IS_IN_ONENAND) += env_onenand.o
-COBJS-$(CONFIG_ENV_IS_IN_SPI_FLASH) += env_sf.o
-COBJS-$(CONFIG_ENV_IS_NOWHERE) += env_nowhere.o
-
-# command
-COBJS-$(CONFIG_CMD_AMBAPP) += cmd_ambapp.o
-COBJS-$(CONFIG_SOURCE) += cmd_source.o
-COBJS-$(CONFIG_CMD_SOURCE) += cmd_source.o
-COBJS-$(CONFIG_CMD_BDI) += cmd_bdinfo.o
-COBJS-$(CONFIG_CMD_BEDBUG) += bedbug.o cmd_bedbug.o
-COBJS-$(CONFIG_CMD_BMP) += cmd_bmp.o
-COBJS-$(CONFIG_CMD_BOOTLDR) += cmd_bootldr.o
-COBJS-$(CONFIG_CMD_CACHE) += cmd_cache.o
-COBJS-$(CONFIG_CMD_CONSOLE) += cmd_console.o
-COBJS-$(CONFIG_CMD_CPLBINFO) += cmd_cplbinfo.o
-COBJS-$(CONFIG_DATAFLASH_MMC_SELECT) += cmd_dataflash_mmc_mux.o
-COBJS-$(CONFIG_CMD_DATE) += cmd_date.o
-ifdef CONFIG_4xx
-COBJS-$(CONFIG_CMD_SETGETDCR) += cmd_dcr.o
-endif
-ifdef CONFIG_POST
-COBJS-$(CONFIG_CMD_DIAG) += cmd_diag.o
-endif
-COBJS-$(CONFIG_CMD_DISPLAY) += cmd_display.o
-COBJS-$(CONFIG_CMD_DTT) += cmd_dtt.o
-COBJS-$(CONFIG_ENV_IS_IN_EEPROM) += cmd_eeprom.o
-COBJS-$(CONFIG_CMD_EEPROM) += cmd_eeprom.o
-COBJS-$(CONFIG_CMD_ELF) += cmd_elf.o
-COBJS-$(CONFIG_CMD_EXT2) += cmd_ext2.o
-COBJS-$(CONFIG_CMD_FAT) += cmd_fat.o
-COBJS-$(CONFIG_CMD_FDC)$(CONFIG_CMD_FDOS) += cmd_fdc.o
-COBJS-$(CONFIG_OF_LIBFDT) += cmd_fdt.o fdt_support.o
-COBJS-$(CONFIG_CMD_FDOS) += cmd_fdos.o
-COBJS-$(CONFIG_CMD_FLASH) += cmd_flash.o
-ifdef CONFIG_FPGA
-COBJS-$(CONFIG_CMD_FPGA) += cmd_fpga.o
-endif
-COBJS-$(CONFIG_CMD_I2C) += cmd_i2c.o
-COBJS-$(CONFIG_CMD_IDE) += cmd_ide.o
-COBJS-$(CONFIG_CMD_IMMAP) += cmd_immap.o
-COBJS-$(CONFIG_CMD_IRQ) += cmd_irq.o
-COBJS-$(CONFIG_CMD_ITEST) += cmd_itest.o
-COBJS-$(CONFIG_CMD_JFFS2) += cmd_jffs2.o
-COBJS-$(CONFIG_CMD_LICENSE) += cmd_license.o
-COBJS-y += cmd_load.o
-COBJS-$(CONFIG_LOGBUFFER) += cmd_log.o
-COBJS-$(CONFIG_ID_EEPROM) += cmd_mac.o
-COBJS-$(CONFIG_CMD_MEMORY) += cmd_mem.o
-COBJS-$(CONFIG_CMD_MFSL) += cmd_mfsl.o
-COBJS-$(CONFIG_CMD_MG_DISK) += cmd_mgdisk.o
-COBJS-$(CONFIG_MII) += miiphyutil.o
-COBJS-$(CONFIG_CMD_MII) += miiphyutil.o
-COBJS-$(CONFIG_CMD_MII) += cmd_mii.o
-COBJS-$(CONFIG_CMD_MISC) += cmd_misc.o
-COBJS-$(CONFIG_CMD_MMC) += cmd_mmc.o
-COBJS-$(CONFIG_MP) += cmd_mp.o
-COBJS-$(CONFIG_CMD_MTDPARTS) += cmd_mtdparts.o
-COBJS-y += cmd_nand.o
-COBJS-$(CONFIG_CMD_NET) += cmd_net.o
-COBJS-$(CONFIG_CMD_ONENAND) += cmd_onenand.o
-COBJS-$(CONFIG_CMD_OTP) += cmd_otp.o
-ifdef CONFIG_PCI
-COBJS-$(CONFIG_CMD_PCI) += cmd_pci.o
-endif
-COBJS-y += cmd_pcmcia.o
-COBJS-$(CONFIG_CMD_PORTIO) += cmd_portio.o
-COBJS-$(CONFIG_CMD_REGINFO) += cmd_reginfo.o
-COBJS-$(CONFIG_CMD_REISER) += cmd_reiser.o
-COBJS-$(CONFIG_CMD_SATA) += cmd_sata.o
-COBJS-$(CONFIG_CMD_SF) += cmd_sf.o
-COBJS-$(CONFIG_CMD_SCSI) += cmd_scsi.o
-COBJS-$(CONFIG_CMD_SETEXPR) += cmd_setexpr.o
-COBJS-$(CONFIG_CMD_SPI) += cmd_spi.o
-COBJS-$(CONFIG_CMD_SPIBOOTLDR) += cmd_spibootldr.o
-COBJS-$(CONFIG_CMD_STRINGS) += cmd_strings.o
-COBJS-$(CONFIG_CMD_TERMINAL) += cmd_terminal.o
-COBJS-$(CONFIG_CMD_TSI148) += cmd_tsi148.o
-COBJS-$(CONFIG_CMD_UBI) += cmd_ubi.o
-COBJS-$(CONFIG_CMD_UBIFS) += cmd_ubifs.o
-COBJS-$(CONFIG_CMD_UNIVERSE) += cmd_universe.o
-ifdef CONFIG_CMD_USB
-COBJS-y += cmd_usb.o
-COBJS-y += cmd_sari.o
-COBJS-y += usb.o
-COBJS-$(CONFIG_USB_STORAGE) += usb_storage.o
-COBJS-$(CONFIG_USB_NETWORK) += usb_network.o
-endif
-COBJS-$(CONFIG_CMD_XIMG) += cmd_ximg.o
-COBJS-$(CONFIG_YAFFS2) += cmd_yaffs2.o
-COBJS-$(CONFIG_VFD) += cmd_vfd.o
-
-# others
-COBJS-$(CONFIG_DDR_SPD) += ddr_spd.o
-COBJS-$(CONFIG_HWCONFIG) += hwconfig.o
-COBJS-$(CONFIG_CONSOLE_MUX) += iomux.o
-COBJS-y += flash.o
-COBJS-$(CONFIG_CMD_KGDB) += kgdb.o
-COBJS-$(CONFIG_KALLSYMS) += kallsyms.o
-COBJS-$(CONFIG_LCD) += lcd.o
-COBJS-$(CONFIG_LYNXKDI) += lynxkdi.o
-COBJS-$(CONFIG_MODEM_SUPPORT) += modem.o
-COBJS-$(CONFIG_UPDATE_TFTP) += update.o
-COBJS-$(CONFIG_USB_KEYBOARD) += usb_kbd.o
-
-
-COBJS	:= $(sort $(COBJS-y))
-SRCS	:= $(AOBJS:.o=.S) $(COBJS:.o=.c)
-OBJS	:= $(addprefix $(obj),$(AOBJS) $(COBJS))
-
-CPPFLAGS += -I..
-
-all:	$(LIB) $(AOBJS)
-
-$(LIB): $(obj).depend $(OBJS)
-	$(AR) $(ARFLAGS) $@ $(OBJS)
-
-$(obj)env_embedded.o: $(src)env_embedded.c $(obj)../tools/envcrc
-	$(CC) $(AFLAGS) -Wa,--no-warn \
-		-DENV_CRC=$(shell $(obj)../tools/envcrc) \
-		-c -o $@ $(src)env_embedded.c
-
-$(obj)../tools/envcrc:
-	$(MAKE) -C ../tools
-
-#########################################################################
-
-# defines $(obj).depend target
-include $(SRCTREE)/rules.mk
-
-sinclude $(obj).depend
-
-#########################################################################
diff -Naur u-boot-2009.08.orig3/drivers/mtd/nand/nx_nand_ip2070.c u-boot-2009.08.mine2/drivers/mtd/nand/nx_nand_ip2070.c
--- u-boot-2009.08.orig3/drivers/mtd/nand/nx_nand_ip2070.c	2010-10-13 16:01:49.988005522 -0500
+++ u-boot-2009.08.mine2/drivers/mtd/nand/nx_nand_ip2070.c	2010-10-13 16:13:02.120006011 -0500
@@ -20,7 +20,7 @@
  *
  * Revision history
  * Version      Date          Remarks
- * 0.0.1	 		20081211		Draft-Initial version
+ * 0.0.1                        20081211                Draft-Initial version
  */
 
 #include <common.h>
@@ -35,9 +35,8 @@
 #include <asm/io.h>
 #include <asm/errno.h>
 
-#ifdef CONFIG_JFFS2_NAND
-#include <jffs2/jffs2.h>
-#endif
+#include "nx_nand_ip2070.h"
+#include <linux/nx_dmac_ip1902.h>
 
 #undef DEBUG
 #ifdef DEBUG
@@ -46,1629 +45,1154 @@
 #define DBG_PRINT(x)
 #endif
 
-/* NAND specific files */
-#include "nx_nand_ip2070.h"
-#include <linux/nx_dmac_ip1902.h>
-
-extern void flush_dcache_range(ulong start_addr, ulong stop);
-extern void invalidate_dcache_range(ulong start_addr, ulong stop);
 
-#ifdef CONFIG_MTD_NX_NAND_HWECC
 /**
-*	OOB structure
-*/
+ *      OOB structure
+ */
 /* For LPF */
 static struct nand_ecclayout nx_nand_oob_128 = {
-	.eccbytes = 96,
-	.eccpos = {
-		   4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
-		   20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31,
-			 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47,
-			 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63,
-			 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79,
-			 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95,
-			 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111,
-			 116, 117, 118, 119, 120, 121, 122, 123, 124, 125,126, 127
-			 },
-
-	.oobfree = {
-		{.offset = 2,
-		 .length = 2},
-		{.offset = 16,
-		 .length = 4},
-		{.offset = 32,
-		 .length = 4},
-		{.offset = 48,
-		 .length = 4},
-		{.offset = 64,
-		 .length = 4},
-		{.offset = 80,
-		 .length = 4},
-		{.offset = 96,
-		 .length = 4},
-		{.offset = 112,
-		 .length = 4},
-	}
+    .eccbytes = 96,
+    .eccpos = {
+        4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
+        20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31,
+        36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47,
+        52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63,
+        68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79,
+        84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95,
+        100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111,
+        116, 117, 118, 119, 120, 121, 122, 123, 124, 125,126, 127
+    },
+
+    .oobfree = {
+        {.offset = 2,
+         .length = 2},
+        {.offset = 16,
+         .length = 4},
+        {.offset = 32,
+         .length = 4},
+        {.offset = 48,
+         .length = 4},
+        {.offset = 64,
+         .length = 4},
+        {.offset = 80,
+         .length = 4},
+        {.offset = 96,
+         .length = 4},
+        {.offset = 112,
+         .length = 4},
+    }
 };
 
 static struct nand_ecclayout nx_nand_oob_64 = {
-	.eccbytes = 48,
-	.eccpos = {
-		   4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
-		   20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31,
-			 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47,
-			 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63},
-	.oobfree = {
-		{.offset = 2,
-		 .length = 2},
-		{.offset = 16,
-		 .length = 4},
-		{.offset = 32,
-		 .length = 4},
-		{.offset = 48,
-		 .length = 4},
-	}
+    .eccbytes = 48,
+    .eccpos = {
+        4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
+        20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31,
+        36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47,
+        52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63},
+    .oobfree = {
+        {.offset = 2,
+         .length = 2},
+        {.offset = 16,
+         .length = 4},
+        {.offset = 32,
+         .length = 4},
+        {.offset = 48,
+         .length = 4},
+    }
 };
 
 /* For SPF */
 static struct nand_ecclayout nx_nand_oob_16 = {
-	.eccbytes = 16,
-	.eccpos = {
-				4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15 },
-	.oobfree = {
-		{.offset = 0,
-		 .length = 4},
-		}
+    .eccbytes = 16,
+    .eccpos = {
+        4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15 },
+    .oobfree = {
+        {.offset = 0,
+         .length = 4},
+    }
 };
 
 /**
-*	Flash based BBT information
-*/
+ *      Flash based BBT information
+ */
 static uint8_t nx_bbt_pattern[] = {'N', 'X', 'P' };
 static uint8_t nx_mirror_pattern[] = {'P', 'X', 'N' };
 
 static struct nand_bbt_descr nx_bbt_main = {
-	.options = NAND_BBT_LASTBLOCK | NAND_BBT_CREATE | NAND_BBT_WRITE
-		| NAND_BBT_2BIT | NAND_BBT_VERSION | NAND_BBT_PERCHIP,
-	.offs =	0,
-	.len = 3,
-	.veroffs = 3,
-	.maxblocks = 4,
-	.pattern = nx_bbt_pattern
+    .options = NAND_BBT_LASTBLOCK | NAND_BBT_CREATE | NAND_BBT_WRITE
+    | NAND_BBT_2BIT | NAND_BBT_VERSION | NAND_BBT_PERCHIP,
+    .offs =     0,
+    .len = 3,
+    .veroffs = 3,
+    .maxblocks = 4,
+    .pattern = nx_bbt_pattern
 };
 
 static struct nand_bbt_descr nx_bbt_mirror = {
-	.options = NAND_BBT_LASTBLOCK | NAND_BBT_CREATE | NAND_BBT_WRITE
-		| NAND_BBT_2BIT | NAND_BBT_VERSION | NAND_BBT_PERCHIP,
-	.offs =	0,
-	.len = 3,
-	.veroffs = 3,
-	.maxblocks = 4,
-	.pattern = nx_mirror_pattern
+    .options = NAND_BBT_LASTBLOCK | NAND_BBT_CREATE | NAND_BBT_WRITE
+    | NAND_BBT_2BIT | NAND_BBT_VERSION | NAND_BBT_PERCHIP,
+    .offs =     0,
+    .len = 3,
+    .veroffs = 3,
+    .maxblocks = 4,
+    .pattern = nx_mirror_pattern
 };
 
-#endif
 
 /**
-* NAND control structure
-*/
+ * NAND control structure
+ */
 struct nx_nand_ctrl *nx_nc = NULL;
 
 
 /*------------------------------------------------------------------------------------
-* Internal functions
---------------------------------------------------------------------------------------*/
-/**
-* nx_nand_dmac_init - Configure the DMAC scatter gather list
-* @nc: NAND control structure
-* @read: Read command
-* @req: Request structure
-* @stgt: Scatter gather array
-*
-* Initialise the DMAC scatter gather list
-*/
-static inline void nx_nand_dmac_init(struct nx_nand_ctrl *nc,
-			uint32_t cmd, nx_dmac_tfr_t *req, nx_dmac_stgt_t *stgt)
-{
-	int i;
-
-	if(cmd) {
-
-		/* Read Main Area */
-		for(i=0; i < nc->num_blks; i++) {
-			stgt[i].src_addr = NX_NAND_AHB_BUF;
-			stgt[i].dst_addr = virt_to_phys(nc->dmabuf + (i * NX_NAND_BLK_SIZE));
-			stgt[i].tfr_size = NX_NAND_BLK_SIZE >> 2;
-			stgt[i].flowctl = nx_dmac_per2mem_dma;
-/*			stgt[i].flowctl = nx_dmac_mem2mem_dma; */
-			stgt[i].src_per = 0;
-			stgt[i].dst_per = 0;
-			stgt[i].src_ahb = 1;		          /* Source AHB master 2 */
-			stgt[i].dst_ahb = 0;              /* Dest AHB master 1 */
-			stgt[i].src_inc = 1;
-			stgt[i].dst_inc = 1;
-			stgt[i].src_brst = nx_dmac_128;
-			stgt[i].dst_brst = nx_dmac_128;
-			stgt[i].src_width = nx_dmac_width_32;
-			stgt[i].dst_width = nx_dmac_width_32;
-		}
-
-		/* Read OOB area */
-		stgt[i].src_addr = NX_NAND_AHB_BUF + NX_NAND_BLK_SIZE;
-		stgt[i].dst_addr = virt_to_phys(nc->dmabuf + (i * NX_NAND_BLK_SIZE));
-		stgt[i].tfr_size = nc->mtd->oobsize >> 2;
-
-		stgt[i].flowctl = nx_dmac_per2mem_dma;
-/*		stgt[i].flowctl = nx_dmac_mem2mem_dma; */
- 		stgt[i].src_ahb = 1;		          /* Source AHB master 1 */
- 		stgt[i].dst_ahb = 0;              /* Dest AHB master 0 */
-		stgt[i].src_per = 0;
- 		stgt[i].dst_per = 0;
- 		stgt[i].src_inc = 1;
- 		stgt[i].dst_inc = 1;
-		if(nc->mtd->oobsize == 128) {
- 			stgt[i].src_brst = nx_dmac_32;
- 			stgt[i].dst_brst = nx_dmac_32;
-		}
-		else if(nc->mtd->oobsize == 64) {
- 			stgt[i].src_brst = nx_dmac_16;
- 			stgt[i].dst_brst = nx_dmac_16;
-		}
-		else {
- 			stgt[i].src_brst = nx_dmac_4;
- 			stgt[i].dst_brst = nx_dmac_4;
-		}
-		stgt[i].src_width = nx_dmac_width_32;
-		stgt[i].dst_width = nx_dmac_width_32;
-	}
-	else {
-
-		/* Write OOB area */
-		i=0;
-		stgt[i].dst_addr = NX_NAND_AHB_BUF + NX_NAND_BLK_SIZE;
-		stgt[i].src_addr = virt_to_phys(nc->dmabuf + (nc->num_blks * NX_NAND_BLK_SIZE));
-		stgt[i].tfr_size = nc->mtd->oobsize >> 2;
-		stgt[i].flowctl = nx_dmac_mem2per_dma;
-/*		stgt[i].flowctl = nx_dmac_mem2mem_dma; */
- 		stgt[i].src_ahb = 0;		          /* Source AHB master 0 */
- 		stgt[i].dst_ahb = 1;              /* Dest AHB master 1 */
-		stgt[i].src_per = 0;
- 		stgt[i].dst_per = 0;
- 		stgt[i].src_inc = 1;
- 		stgt[i].dst_inc = 1;
-		if(nc->mtd->oobsize == 128) {
- 			stgt[i].src_brst = nx_dmac_32;
- 			stgt[i].dst_brst = nx_dmac_32;
-		}
-		else if(nc->mtd->oobsize == 64) {
- 			stgt[i].src_brst = nx_dmac_16;
- 			stgt[i].dst_brst = nx_dmac_16;
-		}
-		else {
- 			stgt[i].src_brst = nx_dmac_4;
- 			stgt[i].dst_brst = nx_dmac_4;
-		}
-		stgt[i].src_width = nx_dmac_width_32;
-		stgt[i].dst_width = nx_dmac_width_32;
-
-		/* Write Main area */
-		for(i=1; i< (nc->num_blks+1); i++) {
-  		stgt[i].src_addr = virt_to_phys(nc->dmabuf + ( (i-1) * NX_NAND_BLK_SIZE));
-		stgt[i].dst_addr = NX_NAND_AHB_BUF;
-  		stgt[i].tfr_size = NX_NAND_BLK_SIZE >> 2;
-		stgt[i].flowctl = nx_dmac_mem2per_dma;
-/*		stgt[i].flowctl = nx_dmac_mem2mem_dma; */
- 		stgt[i].src_per = 0;
-  		stgt[i].dst_per = 0;
- 		stgt[i].src_ahb = 0;		          /* Source AHB master 0 */
-  		stgt[i].dst_ahb = 1;              /* Dest AHB master 1 */
-  		stgt[i].src_inc = 1;
-  		stgt[i].dst_inc = 1;
-  		stgt[i].src_brst = nx_dmac_128;
-  		stgt[i].dst_brst = nx_dmac_128;
-  		stgt[i].src_width = nx_dmac_width_32;
-  		stgt[i].dst_width = nx_dmac_width_32;
-		}
-	}
-
-	req->num_reqs = nc->num_blks + 1;
-	req->req = &stgt[0];
-}
-
+ * Internal functions
+ --------------------------------------------------------------------------------------*/
 /**
-* nx_nand_cmd_addr - Send cmd & address cycles to chip
-* @nc: NAND control structure
-* @cmd: Command to be send
-* @data: command or data
-* @last: Last cycle
-*
-* Send command & address cycles to chip for small page chips
-*/
+ * nx_nand_cmd_addr - Send cmd & address cycles to chip
+ * @nc: NAND control structure
+ * @cmd: Command to be send
+ * @data: command or data
+ * @last: Last cycle
+ *
+ * Send command & address cycles to chip for small page chips
+ */
 static inline void nx_nand_cmd_addr(struct nx_nand_ctrl *nc, uint32_t cmd,
-				     uint32_t data, int last)
-{
-	uint32_t cmd_addr = 0;
-
-	/* Send command & address to chip */
-	cmd_addr = (0 << (nc->slotid + CMD_FIFO_CE_POS));
-	cmd_addr |= ((cmd & CMD_FIFO_CYCLE_MSK) << CMD_FIFO_CYCLE_POS);
-	cmd_addr |= ((last & CMD_FIFO_LAST_MSK) << CMD_FIFO_LAST_POS);
-	cmd_addr |= (data & CMD_FIFO_IO_MSK);
-	writel(cmd_addr, (nx_nc->ctrl_base + CMD_ADDR_FIFO_OFFSET));
-	DBG_PRINT(("nx_nand_cmd_addr: 0x%x \r\n", cmd_addr));
-
-	return;
-}
-
-/**
-* nx_nand_erase - Erase the block
-* @nc: NAND control structure
-*
-* Erase the block
-*/
-static inline void nx_nand_erase(struct nx_nand_ctrl *nc)
+                                    uint32_t data, int last)
 {
-	struct mtd_info *mtd=nc->mtd;
-	struct nand_chip *chip = mtd->priv;
-	uint32_t intr;
-	volatile uint32_t int_status;
-	int addr;
-
-	/* Enable READY interupt */
-	intr = (1 << (NX_NAND_INT_READY_START + nc->slotid));
-	writel(intr, (nx_nc->ctrl_base + INT_SET_ENABLE_OFFSET));
-
-	/* Clear interrupt */
-	writel(intr, (nx_nc->ctrl_base + INT_CLR_STATUS_OFFSET));
-
-	/* Send address ERASE1 command */
-	nx_nand_cmd_addr(nc, 1, NAND_CMD_ERASE1, 0);
-
-	/* Send address cycles */
-	addr = nc->cur_page & NX_NAND_SP_ADDR_MASK;
-	nx_nand_cmd_addr(nc, 0, addr, 0);
-
-	addr = (nc->cur_page >> 8) & NX_NAND_SP_ADDR_MASK;
-	nx_nand_cmd_addr(nc, 0, addr, 0);
-
-	if(nc->lb_chip) {
-		/* LPF */
-		if (chip->chipsize >= (1 << 28)) {
-			addr = (nc->cur_page >> 16) & NX_NAND_SP_ADDR_MASK;
-			nx_nand_cmd_addr(nc, 0, addr, 0);
-		}
-	}
-	else {
-		/* SPF */
-		if (chip->chipsize > (32 << 20)) {
-			addr = (nc->cur_page >> 16) & NX_NAND_SP_ADDR_MASK;
-			nx_nand_cmd_addr(nc, 0, addr, 0);
-		}
-	}
-
-	/* Send ERASE2 command */
-	nx_nand_cmd_addr(nc, 1, NAND_CMD_ERASE2, 1);
-
-	/* Wait for ready interrupt */
-	set_timeout(PNX8XXX_TIMEOUT);
-	int_status = readl(nx_nc->ctrl_base + INT_STATUS_OFFSET);
-	while (!(int_status & (1 << (NX_NAND_INT_READY_START + nc->slotid)))) {
-		if(did_timeout()) {
-			printk("TIMEOUT:Erase \r\n");
-			return;
-		}
-		int_status = readl(nx_nc->ctrl_base + INT_STATUS_OFFSET);
-	}
-
-	/* Clear interrupt */
-	writel(intr, (nx_nc->ctrl_base + INT_CLR_STATUS_OFFSET));
+    uint32_t cmd_addr = 0;
 
-	/* Disable interrupt */
-	writel(intr, (nx_nc->ctrl_base + INT_CLR_ENABLE_OFFSET));
+    /* Send command & address to chip */
+    cmd_addr = (0 << (nc->slotid + CMD_FIFO_CE_POS));
+    cmd_addr |= ((cmd & CMD_FIFO_CYCLE_MSK) << CMD_FIFO_CYCLE_POS);
+    cmd_addr |= ((last & CMD_FIFO_LAST_MSK) << CMD_FIFO_LAST_POS);
+    cmd_addr |= (data & CMD_FIFO_IO_MSK);
+    writel(cmd_addr, (nx_nc->ctrl_base + CMD_ADDR_FIFO_OFFSET));
 
-	return;
+    return;
 }
 
 /**
-* nx_nand_read - Read page into driver buffer
-* @nc: NAND control structure
-*
-* Read a page into driver buffer
-*/
-static inline void nx_nand_read(struct nx_nand_ctrl *nc)
-{
-	struct mtd_info *mtd=nc->mtd;
-	struct nand_chip *chip = mtd->priv;
-	uint32_t intr, page_cfg, int_ecc;
-	volatile uint32_t int_status;
-	int status, addr, chanid;
-	nx_dmac_tfr_t	req;
-	nx_dmac_stgt_t	stgt[5];
-
-	DBG_PRINT(("> IP2017 nx_nand_read enter \r\n"));
-
-	/* Init DMAC Scatter gather list */
-	nx_nand_dmac_init(nc, 1, &req, stgt);
-
-	/* Set DMAC Flow control */
-
-/* TODO: TH  are we not permited to do this multiple times
+ * nx_nand_erase - Erase the block
+ * @nc: NAND control structure
  *
- *	DBG_PRINT(  ("IP2017_DMA_CTRL = 0x%x \r\n", DMA_CTRL_PER_2_MEM) 	);
- *	writel(DMA_CTRL_PER_2_MEM, (nc->ctrl_base + DMA_CTRL_OFFSET));
+ * Erase the block
  */
-	/* Enable the SEQ READ PAGE DONE interrupt */
-	intr = NX_NAND_INT_SEQ_READ;
-	writel(intr, (nc->ctrl_base + INT_SET_ENABLE_OFFSET));
-
-	/* Clear interrupt */
-	DBG_PRINT(("IP2017_INT_CLR_STATUS 0x%x \r\n", intr));
-	writel(intr, (nc->ctrl_base + INT_CLR_STATUS_OFFSET));
-
-	/* Clear interrupt */
-	DBG_PRINT(("nx_nand_read: reset all interrupts \r\n"));
-	writel(0xFFFFFFFF, (nc->ctrl_base + INT_CLR_STATUS_OFFSET));
-	int_status = readl(nx_nc->ctrl_base + INT_STATUS_OFFSET);
-	DBG_PRINT(("nx_nand_read: interrupt status: 0x%x \r\n", int_status));
-	if(nc->cur_cmd == NAND_CMD_READ0) {
-
-		/* Page operation */
-		page_cfg = PAGE_RW_OOB_MSK | PAGE_RW_PAGE_READ_MSK;
-		if(nc->aes) {
-			page_cfg |= PAGE_RW_AES_MSK;
-		}
-
-		if(chip->ecc.mode == NAND_ECC_HW) {
-			page_cfg |= PAGE_RW_ECC_MSK;
-		}
-
-		DBG_PRINT(("IP2017_PAGE_RW 0x%x \r\n", page_cfg));
-		writel(page_cfg, (nc->ctrl_base + PAGE_RW_OFFSET));
-
-		/* Start DMAC */
-		chanid = nx_dmac_tfr(&req);
-		if(chanid < 0) {
-			printk( "nx_nand_read: NAND_READ0 DMAC config \r\n");
-			return;
-		}
-
-		/* Send READ0 command */
-		nx_nand_cmd_addr(nc, 1, NAND_CMD_READ0, 0);
-
-		/* Send address cycles */
-		addr = nc->cur_col & NX_NAND_SP_ADDR_MASK;
-		nx_nand_cmd_addr(nc, 0, addr, 0);
-
-		if(nc->lb_chip) {
-			addr = (nc->cur_col >> 8) & NX_NAND_SP_ADDR_MASK;
-			nx_nand_cmd_addr(nc, 0, addr, 0);
-		}
-
-		addr = nc->cur_page & NX_NAND_SP_ADDR_MASK;
-		nx_nand_cmd_addr(nc, 0, addr, 0);
-		if(nc->lb_chip) {
-			/* LPF */
-			addr = (nc->cur_page >> 8) & NX_NAND_SP_ADDR_MASK;
-			nx_nand_cmd_addr(nc, 0, addr, 0);
-			if (chip->chipsize >= (1 << 28)) {
-				addr = (nc->cur_page >> 16) & NX_NAND_SP_ADDR_MASK;
-				nx_nand_cmd_addr(nc, 0, addr, 0);
-			}
-
-			/* Send READSTART command */
-			nx_nand_cmd_addr(nc, 1, NAND_CMD_READSTART, 1);
-
-		}
-		else {
-			/* SPF */
-			if (chip->chipsize > (32 << 20)) {
-				/* Chip size > 64MB */
-				addr = (nc->cur_page >> 8) & NX_NAND_SP_ADDR_MASK;
-				nx_nand_cmd_addr(nc, 0, addr, 0);
-
-				addr = (nc->cur_page >> 16) & NX_NAND_SP_ADDR_MASK;
-				nx_nand_cmd_addr(nc, 0, addr, 1);
-			}
-			else {
-				/* Chip size < 64MB */
-				addr = (nc->cur_page >> 8) & NX_NAND_SP_ADDR_MASK;
-				nx_nand_cmd_addr(nc, 0, addr, 1);
-			}
-		}
-
-	}
-	else {
-		/* Page operation */
-		page_cfg = PAGE_RW_OOB_MSK | PAGE_RW_PAGE_READ_MSK;
-		if(nc->aes) {
-			page_cfg |= PAGE_RW_AES_MSK;
-		}
-
-		if(chip->ecc.mode == NAND_ECC_HW) {
-			page_cfg |= PAGE_RW_ECC_MSK;
-		}
-		writel(page_cfg, (nc->ctrl_base + PAGE_RW_OFFSET));
-
-		/* Start DMAC */
-		chanid = nx_dmac_tfr(&req);
-		if(chanid < 0) {
-			printk( "nx_nand_read: NAND_READ0 DMAC config \r\n");
-			return;
-		}
-		/* Send CACHED READ cmd */
-		nx_nand_cmd_addr(nc, 1, NAND_CMD_CACHEREAD, 1);
-	}
-
-#if (1)
-	/* Wait for SEQ_READ interrupt */
-	DBG_PRINT(("nx_nand_read: Wait for SEQ_READ interrupt \r\n"));
-	set_timeout(PNX8XXX_TIMEOUT);
-	int_status = readl(nx_nc->ctrl_base + INT_STATUS_OFFSET);
-	while (!(int_status & NX_NAND_INT_SEQ_READ))
-	{
-		DBG_PRINT(("nx_nand_read:interrupt status: 0x%x \r\n", int_status));
-		/* Check Timeout */
-		if(did_timeout()) {
-			printk("TIMEOUT: Read\r\n");
-			return;
-		}
-		int_status = readl(nx_nc->ctrl_base + INT_STATUS_OFFSET);
-	}
-
-	/* Check ECC status */
-	if(chip->ecc.mode == NAND_ECC_HW) {
-		DBG_PRINT(("nx_nand_read: Check ECC status \r\n"));
-		/* Get HW ECC status */
-		int_ecc = int_status & (NX_NAND_INT_DEC_UNCOR |
-                   NX_NAND_INT_DEC_0_ERR |
-                   NX_NAND_INT_DEC_1_ERR |
-                   NX_NAND_INT_DEC_2_ERR |
-                   NX_NAND_INT_DEC_3_ERR |
-                   NX_NAND_INT_DEC_4_ERR |
-                   NX_NAND_INT_DEC_5_ERR);
-
-		if(int_ecc) {
-			int i = 0 ;
-		 	nc->ecc_status[i] = int_ecc;
-			writel(int_ecc, (nx_nc->ctrl_base + INT_CLR_STATUS_OFFSET));
-			i++;
-		}
-	}
+static inline void nx_nand_erase(struct nx_nand_ctrl *nc)
+{
+    struct mtd_info *mtd=nc->mtd;
+    struct nand_chip *chip = mtd->priv;
+    uint32_t intr;
+    volatile uint32_t int_status;
+    int addr;
+
+    /* Enable READY interupt */
+    intr = (1 << (NX_NAND_INT_READY_START + nc->slotid));
+    writel(intr, (nx_nc->ctrl_base + INT_SET_ENABLE_OFFSET));
+
+    /* Clear interrupt */
+    writel(intr, (nx_nc->ctrl_base + INT_CLR_STATUS_OFFSET));
+
+    /* Send address ERASE1 command */
+    nx_nand_cmd_addr(nc, 1, NAND_CMD_ERASE1, 0);
+
+    /* Send address cycles */
+    addr = nc->cur_page & NX_NAND_SP_ADDR_MASK;
+    nx_nand_cmd_addr(nc, 0, addr, 0);
+
+    addr = (nc->cur_page >> 8) & NX_NAND_SP_ADDR_MASK;
+    nx_nand_cmd_addr(nc, 0, addr, 0);
+
+    if (nc->lb_chip) {
+        /* LPF */
+        if (chip->chipsize >= (1 << 28)) {
+            addr = (nc->cur_page >> 16) & NX_NAND_SP_ADDR_MASK;
+            nx_nand_cmd_addr(nc, 0, addr, 0);
+        }
+    } else {
+        /* SPF */
+        if (chip->chipsize > (32 << 20)) {
+            addr = (nc->cur_page >> 16) & NX_NAND_SP_ADDR_MASK;
+            nx_nand_cmd_addr(nc, 0, addr, 0);
+        }
+    }
+
+    /* Send ERASE2 command */
+    nx_nand_cmd_addr(nc, 1, NAND_CMD_ERASE2, 1);
+
+    /* Wait for ready interrupt */
+    set_timeout(PNX8XXX_TIMEOUT);
+    int_status = readl(nx_nc->ctrl_base + INT_STATUS_OFFSET);
+    while (!(int_status & (1 << (NX_NAND_INT_READY_START + nc->slotid)))) {
+        if (did_timeout()) {
+            printf("%s:%d TIMEOUT:Erase\n", __FUNCTION__, __LINE__);
+            return;
+        }
+        int_status = readl(nx_nc->ctrl_base + INT_STATUS_OFFSET);
+    }
+
+    /* Clear interrupt */
+    writel(intr, (nx_nc->ctrl_base + INT_CLR_STATUS_OFFSET));
+
+    /* Disable interrupt */
+    writel(intr, (nx_nc->ctrl_base + INT_CLR_ENABLE_OFFSET));
+
+    return;
+}
+
+static void setup_dma_desc(nx_dmac_stgt_t *desc,
+                         uint32_t src_addr, uint32_t dst_addr,
+                         uint32_t tfr_size,
+                         nx_dmac_flctl_t flowctl,
+                         nx_dmac_burst_t src_brst, nx_dmac_burst_t dst_brst,
+                         int src_ahb, int dst_ahb)
+{
+    desc->src_addr = src_addr;
+    desc->dst_addr = dst_addr;
+    desc->tfr_size = tfr_size;
+    desc->src_brst = src_brst;
+    desc->dst_brst = dst_brst;
+    desc->src_ahb = src_ahb;
+    desc->dst_ahb = dst_ahb;
+    desc->flowctl = flowctl;
+    desc->src_per = 0;
+    desc->dst_per = 0;
+    desc->src_inc = 1;
+    desc->dst_inc = 1;
+    desc->src_width = nx_dmac_width_32;
+    desc->dst_width = nx_dmac_width_32;
+}
+
+static void nand_read_page(struct mtd_info *mtd, uint8_t *buf, uint8_t *oob_buf)
+{
+    struct nand_chip *chip= mtd->priv;
+    struct nx_nand_ctrl *nc = chip->priv;
+    int i;
+    int ndesc = (mtd->writesize / NX_NAND_BUF_SIZE) + 1;  /* 512 byte chunks + oob */
+    nx_dmac_stgt_t stgt[ndesc];
+    uint32_t intr;
+    nx_dmac_tfr_t req;
+    uint32_t int_status;
+    uint32_t page_cfg;
+    int chanid;
+    int addr;
+    int status;
+    nx_dmac_burst_t burst;
+
+    /*
+     * The NAND controller only has a 512 byt buffer, so we
+     * have to do 4 DMA operations for a 2K page plus 1 for
+     * the OOB data.
+     */
+    for (i = 0; i < (ndesc - 1); i++) {
+        /* page data */
+        setup_dma_desc(&stgt[i],
+                       NX_NAND_AHB_BUF,
+                       virt_to_phys(buf + (i * NX_NAND_BUF_SIZE)),
+                       NX_NAND_BUF_SIZE >> 2,
+                       nx_dmac_per2mem_dma,
+                       nx_dmac_128, nx_dmac_32,
+                       1, 0);
+    }
+    /* oob data */
+    switch (mtd->oobsize) {
+    case 128:
+        burst = nx_dmac_32;
+        break;
+    case 64:
+        burst = nx_dmac_16;
+        break;
+    default:
+        burst = nx_dmac_4;
+        break;
+    }
+    setup_dma_desc(&stgt[ndesc - 1],
+                   NX_NAND_AHB_BUF + NX_NAND_BUF_SIZE,
+                   virt_to_phys(oob_buf),
+                   mtd->oobsize >> 2,
+                   nx_dmac_per2mem_dma,
+                   burst, burst,
+                   1, 0);
+
+    req.num_reqs = ndesc;
+    req.req = &stgt[0];
+
+    /* Enable the SEQ READ PAGE DONE interrupt */
+    intr = NX_NAND_INT_SEQ_READ;
+    writel(intr, (nc->ctrl_base + INT_SET_ENABLE_OFFSET));
+
+    /* Clear all interrupts */
+    writel(0xFFFFFFFF, (nc->ctrl_base + INT_CLR_STATUS_OFFSET));
+
+    if (nc->cur_cmd == NAND_CMD_READ0) {
+        /* Page operation */
+        page_cfg = PAGE_RW_OOB_MSK | PAGE_RW_PAGE_READ_MSK;
+        if (nc->aes) {
+            page_cfg |= PAGE_RW_AES_MSK;
+        }
+
+        if (chip->ecc.mode == NAND_ECC_HW) {
+            page_cfg |= PAGE_RW_ECC_MSK;
+        }
+
+        writel(page_cfg, (nc->ctrl_base + PAGE_RW_OFFSET));
+
+        /* Start DMAC */
+        chanid = nx_dmac_tfr(&req);
+        if (chanid < 0) {
+            printf("nx_nand_read: NAND_READ0 DMAC config\n");
+            return;
+        }
+
+        /* Send READ0 command */
+        nx_nand_cmd_addr(nc, 1, NAND_CMD_READ0, 0);
+
+        /* Send address cycles */
+        addr = nc->cur_col & NX_NAND_SP_ADDR_MASK;
+        nx_nand_cmd_addr(nc, 0, addr, 0);
+
+        if (nc->lb_chip) {
+            addr = (nc->cur_col >> 8) & NX_NAND_SP_ADDR_MASK;
+            nx_nand_cmd_addr(nc, 0, addr, 0);
+        }
+
+        addr = nc->cur_page & NX_NAND_SP_ADDR_MASK;
+        nx_nand_cmd_addr(nc, 0, addr, 0);
+        if (nc->lb_chip) {
+            /* LPF */
+            addr = (nc->cur_page >> 8) & NX_NAND_SP_ADDR_MASK;
+            nx_nand_cmd_addr(nc, 0, addr, 0);
+            if (chip->chipsize >= (1 << 28)) {
+                addr = (nc->cur_page >> 16) & NX_NAND_SP_ADDR_MASK;
+                nx_nand_cmd_addr(nc, 0, addr, 0);
+            }
+
+            /* Send READSTART command */
+            nx_nand_cmd_addr(nc, 1, NAND_CMD_READSTART, 1);
+
+        } else {
+            /* SPF */
+            if (chip->chipsize > (32 << 20)) {
+                /* Chip size > 32MB */
+                addr = (nc->cur_page >> 8) & NX_NAND_SP_ADDR_MASK;
+                nx_nand_cmd_addr(nc, 0, addr, 0);
+
+                addr = (nc->cur_page >> 16) & NX_NAND_SP_ADDR_MASK;
+                nx_nand_cmd_addr(nc, 0, addr, 1);
+            } else {
+                /* Chip size <= 32MB */
+                addr = (nc->cur_page >> 8) & NX_NAND_SP_ADDR_MASK;
+                nx_nand_cmd_addr(nc, 0, addr, 1);
+            }
+        }
+    } else {
+        /* Page operation */
+        page_cfg = PAGE_RW_OOB_MSK | PAGE_RW_PAGE_READ_MSK;
+        if (nc->aes) {
+            page_cfg |= PAGE_RW_AES_MSK;
+        }
+
+        if (chip->ecc.mode == NAND_ECC_HW) {
+            page_cfg |= PAGE_RW_ECC_MSK;
+        }
+        writel(page_cfg, (nc->ctrl_base + PAGE_RW_OFFSET));
+
+        /* Start DMAC */
+        chanid = nx_dmac_tfr(&req);
+        if (chanid < 0) {
+            printf("nx_nand_read: NAND_READ0 DMAC config\n");
+            return;
+        }
+        /* Send CACHED READ cmd */
+        nx_nand_cmd_addr(nc, 1, NAND_CMD_CACHEREAD, 1);
+    }
+
+    /* Wait for SEQ_READ interrupt */
+    set_timeout(PNX8XXX_TIMEOUT);
+    int_status = readl(nx_nc->ctrl_base + INT_STATUS_OFFSET);
+    while (!(int_status & NX_NAND_INT_SEQ_READ))
+    {
+        /* Check Timeout */
+        if (did_timeout()) {
+            printf("TIMEOUT: Read - int_status = 0x%x\n", int_status);
+            return;
+        }
+        int_status = readl(nx_nc->ctrl_base + INT_STATUS_OFFSET);
+    }
+
+    /* Check ECC status */
+    nc->ecc_status = int_status & (NX_NAND_INT_DEC_UNCOR |
+                                   NX_NAND_INT_DEC_0_ERR |
+                                   NX_NAND_INT_DEC_1_ERR |
+                                   NX_NAND_INT_DEC_2_ERR |
+                                   NX_NAND_INT_DEC_3_ERR |
+                                   NX_NAND_INT_DEC_4_ERR |
+                                   NX_NAND_INT_DEC_5_ERR);
+
+    /* Clear interrupt */
+    writel(int_status, (nx_nc->ctrl_base + INT_CLR_STATUS_OFFSET));
+
+    /* Complete DMAC transfer */
+    status = nx_dmac_tfr_comp(chanid);
+    if (status) {
+        printf("nx_nand: NAND_READ0 DMAC complete - status=%d\n", status);
+        return;
+    }
+
+    /* Disable interrupt */
+    writel(intr, (nx_nc->ctrl_base + INT_CLR_ENABLE_OFFSET));
+
+    return;
+}
+
+static void nand_write_page(struct mtd_info *mtd, const uint8_t *buf, uint8_t *oob_buf)
+{
+    struct nand_chip *chip= mtd->priv;
+    struct nx_nand_ctrl *nc = chip->priv;
+    int i;
+    int ndesc = (mtd->writesize / NX_NAND_BUF_SIZE) + 1; /* 512 byte chunks + oob */
+    nx_dmac_stgt_t stgt[ndesc];
+    uint32_t intr;
+    nx_dmac_tfr_t req;
+    uint32_t int_status;
+    uint32_t page_cfg;
+    int chanid;
+    int addr;
+    int status;
+    nx_dmac_burst_t burst;
+
+    /*
+     * The NAND controller only has a 512 byt buffer, so we
+     * have to do 4 DMA operations for a 2K page plus 1 for
+     * the OOB data.
+     */
+
+    /* oob data */
+    switch (mtd->oobsize) {
+    case 128:
+        burst = nx_dmac_32;
+        break;
+    case 64:
+        burst = nx_dmac_16;
+        break;
+    default:
+        burst = nx_dmac_4;
+        break;
+    }
+    setup_dma_desc(&stgt[0],
+                   virt_to_phys(oob_buf),
+                   NX_NAND_AHB_BUF + NX_NAND_BUF_SIZE,
+                   mtd->oobsize >> 2,
+                   nx_dmac_mem2per_dma,
+                   burst, burst,
+                   0, 1);
+
+    for (i = 1; i < ndesc; i++) {
+        /* page data */
+        setup_dma_desc(&stgt[i],
+                       virt_to_phys((void *)buf + ((i - 1) * NX_NAND_BUF_SIZE)),
+                       NX_NAND_AHB_BUF,
+                       NX_NAND_BUF_SIZE >> 2,
+                       nx_dmac_mem2per_dma,
+                       nx_dmac_32, nx_dmac_128,
+                       0, 1);
+    }
+
+    req.num_reqs = ndesc;
+    req.req = &stgt[0];
+
+    chanid = nx_dmac_tfr(&req);
+    if (chanid < 0) {
+        printf("nx_nand_write: Error initiating DMA write transfer\n");
+        return;
+    }
+
+    /* Page operation */
+    page_cfg = PAGE_RW_OOB_MSK | PAGE_RW_PAGE_WRITE_MSK;
+    if (nc->aes) {
+        page_cfg |= PAGE_RW_AES_MSK;
+    }
+
+    if (chip->ecc.mode == NAND_ECC_HW) {
+        page_cfg |= PAGE_RW_ECC_MSK;
+    }
+    writel(page_cfg, (nx_nc->ctrl_base + PAGE_RW_OFFSET));
+
+    /* Clear interrupt */
+    writel(NX_NAND_INT_ALL, (nx_nc->ctrl_base + INT_CLR_STATUS_OFFSET));
+
+    /* Enable SEQ WRIEt & READY interrupts */
+    intr = NX_NAND_INT_SEQ_WRITE | (1 << (NX_NAND_INT_READY_START + nc->slotid));
+    writel(intr, (nx_nc->ctrl_base + INT_SET_ENABLE_OFFSET));
+
+    /* Send SEQIN command */
+    nx_nand_cmd_addr(nc, 1, NAND_CMD_SEQIN, 0);
+
+    /* Send address commands */
+    addr = nc->cur_col & NX_NAND_SP_ADDR_MASK;
+    nx_nand_cmd_addr(nc, 0, addr, 0);
+
+    if (nc->lb_chip) {
+        addr = (nc->cur_col >> 8) & NX_NAND_SP_ADDR_MASK;
+        nx_nand_cmd_addr(nc, 0, addr, 0);
+    }
+
+    addr = nc->cur_page & NX_NAND_SP_ADDR_MASK;
+    nx_nand_cmd_addr(nc, 0, addr, 0);
+
+    addr = (nc->cur_page >> 8) & NX_NAND_SP_ADDR_MASK;
+    nx_nand_cmd_addr(nc, 0, addr, 0);
+
+    if (nc->lb_chip) {
+        /* if > 2Gb, extra address cycle */
+        if (chip->chipsize >= (1 << 28)) {
+            addr = (nc->cur_page >> 16) & NX_NAND_SP_ADDR_MASK;
+            nx_nand_cmd_addr(nc, 0, addr, 0);
+        }
+    } else {
+        /* if > 64MB, extra adddress cycle */
+        if (chip->chipsize > (32 << 20)) {
+            addr = (nc->cur_page >> 16) & NX_NAND_SP_ADDR_MASK;
+            nx_nand_cmd_addr(nc, 0, addr, 0);
+        }
+    }
+
+    /* Send PAGEPROG - post write command */
+    nx_nand_cmd_addr(nc, 2, NAND_CMD_PAGEPROG, 1);
+
+    /* Complete DMAC transfer */
+    status = nx_dmac_tfr_comp(chanid);
+    if (status) {
+        printf("nx_nand: write_page_raw\n");
+        return;
+    }
+
+    /* Wait till READY interrupt */
+    set_timeout(PNX8XXX_TIMEOUT);
+    int_status = readl(nx_nc->ctrl_base + INT_STATUS_OFFSET);
+    while (!(1 << (NX_NAND_INT_READY_START + nc->slotid))) {
+        /* Timeout */
+        if (did_timeout()) {
+            printf("TIMEOUT: Write\n");
+            return;
+        }
+
+        /* Get Page done */
+        if (int_status & NX_NAND_INT_SEQ_WRITE) {
+            writel(NX_NAND_INT_SEQ_WRITE, (nx_nc->ctrl_base + INT_CLR_STATUS_OFFSET));
+        }
+        int_status = readl(nx_nc->ctrl_base + INT_STATUS_OFFSET);
+    }
 
-	/* Clear interrupt */
-	writel(int_status, (nx_nc->ctrl_base + INT_CLR_STATUS_OFFSET));
-#endif
+    /* Clear interrupt */
+    writel(int_status, (nx_nc->ctrl_base + INT_CLR_STATUS_OFFSET));
 
-	/* Complete DMAC transfer */
-	status = nx_dmac_tfr_comp(chanid);
-	if(status) {
-		printk(KERN_ERR "nx_nand: NAND_READ0 DMAC complete\r\n");
-		return;
-	}
-
-	DBG_PRINT(("nx_nand_read: NAND_READ0 DMAC complete status: 0x%x \r\n", status));
-
-	/* Disable interrupt */
-	writel(intr, (nx_nc->ctrl_base + INT_CLR_ENABLE_OFFSET));
-	DBG_PRINT(("nx_nand_read: interrupts disabled \r\n"));
-
-	/* Disable DMAC Flow control */
-/* TODO: check:	writel(0, (nx_nc->ctrl_base + DMA_CTRL_OFFSET));  */
-	DBG_PRINT(("nx_nand_read: dma flow control disabled \r\n"));
-	DBG_PRINT(("< IP2017 nx_nand_read exit \r\n"));
+    /* Disable interrupt */
+    writel(intr, (nx_nc->ctrl_base + INT_CLR_ENABLE_OFFSET));
 
-	return;
+    return;
 }
 
 
 /*------------------------------------------------------------------------------------
-* NAND chip specific functions
---------------------------------------------------------------------------------------*/
-#ifdef CONFIG_MTD_NX_NAND_HWECC
-/**
-* nx_nand_calculate_ecc - HW ECC calculate
-* @mtd: MTD information structure
-* @dat: Databuffer
-* @ecc_code: ECC code buffer
-*
-* Dummy function for HW ECC calculation
-*/
-static int nx_nand_calculate_ecc(struct mtd_info *mtd, const uint8_t *dat,
-							uint8_t *ecc_code)
-{
-	return 0;
-}
-
-/**
-* nx_nand_correct_data - HW ECC correct
-* @mtd: MTD information structure
-* @dat: Databuffer
-* @read_ecc: Read ECC code buffer
-* @calc_ecc: Calculated ECC buffer
-*
-* Dummy function for HW ECC calculation
-*/
-static int nx_nand_correct_data(struct mtd_info *mtd, uint8_t *dat,
-		             uint8_t *read_ecc, uint8_t *calc_ecc)
-{
-	return 0;
-}
-
-/**
-* nx_nand_hwctl - HW ECC control function
-* @mtd: MTD information structure
-* @mode: Mode
-*
-* Dummy function for HW ECC calculation
-*/
-static void nx_nand_hwctl(struct mtd_info *mtd, int mode)
-{
-	return;
-}
-
-#endif
-
+ * NAND chip specific functions
+ --------------------------------------------------------------------------------------*/
 /**
-* nx_nand_select_chip - Enable or Disable chip
-* @mtd: MTD information structure
-* @chipnr: Chip number
-*
-* Enable the chip if it chipnr >= 0, else disable the chip
-*/
+ * nx_nand_select_chip - Enable or Disable chip
+ * @mtd: MTD information structure
+ * @chipnr: Chip number
+ *
+ * Enable the chip if it chipnr >= 0, else disable the chip
+ */
 static void nx_nand_select_chip(struct mtd_info *mtd, int chipnr)
 {
-	struct nand_chip *chip= mtd->priv;
-	struct nx_nand_ctrl *nc = chip->priv;
+    struct nand_chip *chip= mtd->priv;
+    struct nx_nand_ctrl *nc = chip->priv;
 
-	if(chipnr == -1)
-		return;
+    if (chipnr == -1) {
+        return;
+    }
 
-	/* Store the value in nand control structure
-	 * Chip enable/disable done in command function */
-	nc->slotid = chipnr;
+    /* Store the value in nand control structure
+     * Chip enable/disable done in command function */
+    nc->slotid = chipnr;
 }
 
 /**
-* nx_nand_dev_ready - Check device ready
-* @mtd: MTD information structure
-*
-* Return true if the device is ready, false otherwise
-*/
+ * nx_nand_dev_ready - Check device ready
+ * @mtd: MTD information structure
+ *
+ * Return true if the device is ready, false otherwise
+ */
 static int nx_nand_dev_ready(struct mtd_info *mtd)
 {
-	struct nand_chip *chip= mtd->priv;
-	struct nx_nand_ctrl *nc = chip->priv;
-	int status, ready = 0;
-
-	/* Get status from controller */
-	status = readl(nc->ctrl_base + NAND_STATUS_OFFSET);
-	if(status & (NAND_STATUS_RB_DEV0 << nc->slotid)) {
-		ready = 1;
-	}
+    struct nand_chip *chip= mtd->priv;
+    struct nx_nand_ctrl *nc = chip->priv;
+    int status, ready = 0;
 
-	/* Return R/B status */
-	return ready;
+    /* Get status from controller */
+    status = readl(nc->ctrl_base + NAND_STATUS_OFFSET);
+    if (status & (NAND_STATUS_RB_DEV0 << nc->slotid)) {
+        ready = 1;
+    }
+
+    /* Return R/B status */
+    return ready;
 }
 
 /**
-* nx_nand_read_byte - Read a byte from chip
-* @mtd: MTD information structure
-*
-* Read a byte from the nand chip
-*/
+ * nx_nand_read_byte - Read a byte from chip
+ * @mtd: MTD information structure
+ *
+ * Read a byte from the nand chip
+ */
 static uint8_t nx_nand_read_byte(struct mtd_info *mtd)
 {
-	struct nand_chip *chip= mtd->priv;
-	struct nx_nand_ctrl *nc = chip->priv;
-	int data;
-
-	/* Read data */
-	data = readl(nc->ctrl_base + SINGLE_READ_OFFSET);
-	return (uint8_t) cpu_to_le16(data);
-}
+    struct nand_chip *chip= mtd->priv;
+    struct nx_nand_ctrl *nc = chip->priv;
+    int data;
 
-/**
-* nx_nand_read_byte16 - Read a byte from 16bit chip
-* @mtd: MTD information structure
-*
-* Read a byte from the 16bit nand chip
-*/
-static uint8_t nx_nand_read_byte16(struct mtd_info *mtd)
-{
-	struct nand_chip *chip= mtd->priv;
-	struct nx_nand_ctrl *nc = chip->priv;
-	uint16_t data;
-
-	/* Read data */
-	data = readl(nc->ctrl_base + SINGLE_READ_OFFSET);
-	return (uint8_t) cpu_to_le16(data);
+    /* Read data */
+    data = readl(nc->ctrl_base + SINGLE_READ_OFFSET);
+    return (uint8_t) cpu_to_le16(data);
 }
 
 /**
-* nx_nand_read_buf - Read data from chip
-* @mtd: MTD information structure
-* @buf: Data buffer
-* @len: Transfer size
-*
-* Read specified number of bytes from the driver buffer
-*/
-static void nx_nand_read_buf(struct mtd_info *mtd, uint8_t *buf, int len)
+ * nx_nand_read_byte16 - Read a byte from 16bit chip
+ * @mtd: MTD information structure
+ *
+ * Read a byte from the 16bit nand chip
+ */
+static uint8_t nx_nand_read_byte16(struct mtd_info *mtd)
 {
-	struct nand_chip *chip= mtd->priv;
-	struct nx_nand_ctrl *nc = chip->priv;
-	DBG_PRINT(("> IP2017 nx_nand_read_buf enter \r\n"));
-
-	/* Copy from driver buffer */
-	memcpy(buf, nc->dmabuf + nc->offset, len);
-	nc->offset += len;
-	DBG_PRINT(("< IP2017 nx_nand_read_buf exit \r\n"));
+    struct nand_chip *chip= mtd->priv;
+    struct nx_nand_ctrl *nc = chip->priv;
+    uint16_t data;
 
+    /* Read data */
+    data = readl(nc->ctrl_base + SINGLE_READ_OFFSET);
+    return (uint8_t) cpu_to_le16(data);
 }
 
 /**
-* nx_nand_read_page_raw - Read 1 page data from chip
-* @mtd: MTD information structure
-* @chip: Chip information structure
-* @buf: Data buffer
-*
-* Read a full page + oob into the buffer
-*/
+ * nx_nand_read_page_raw - Read 1 page data from chip
+ * @mtd: MTD information structure
+ * @chip: Chip information structure
+ * @buf: Data buffer
+ *
+ * Read a full page, without ecc
+ * page to read was specified in NAND_CMD_READ0 command
+ */
 static int nx_nand_read_page_raw(struct mtd_info *mtd, struct nand_chip *chip,
-				  uint8_t *buf)
+                                 uint8_t *buf)
 {
-	struct nx_nand_ctrl *nc = chip->priv;
-	DBG_PRINT(("> IP2017 nx_nand_read_page_raw enter \r\n"));
+    nand_read_page(mtd, buf, chip->oob_poi);
 
-	/* Copy to user buffer */
-	invalidate_dcache_range((ulong)nc->dmabuf, ((ulong)nc->dmabuf + mtd->writesize + mtd->oobsize));
-	chip->read_buf(mtd, buf, mtd->writesize);
-	chip->read_buf(mtd, chip->oob_poi, mtd->oobsize);
-	DBG_PRINT(("< IP2017 nx_nand_read_page_raw exit \r\n"));
-
-	return 0;
+    return 0;
 }
 
-#ifdef CONFIG_MTD_NX_NAND_HWECC
 /**
-* nx_nand_read_page - Read 1 page data from chip with HWECC
-* @mtd: MTD information structure
-* @chip: Chip information structure
-* @buf: Data buffer
-*
-* Read a full page + oob into the buffer
-*/
+ * nx_nand_read_page - Read 1 page data from chip with HWECC
+ * @mtd: MTD information structure
+ * @chip: Chip information structure
+ * @buf: Data buffer
+ *
+ * Read a full page + oob into the buffer
+ */
 static int nx_nand_read_page(struct mtd_info *mtd, struct nand_chip *chip,
-				  uint8_t *buf)
+                             uint8_t *buf)
 {
-	int stat=0,i, j;
-	struct nx_nand_ctrl *nc = chip->priv;
-	int eccsteps = chip->ecc.steps;
-	int no_all_ffs=0;
-
-	/* Read page data */
-	nx_nand_read_page_raw(mtd, chip, buf);
-
-	/* Check ECC status */
-	for (i = 0 ; i<eccsteps; i++) {
-
-		if(nc->ecc_status[i] == NX_NAND_INT_DEC_UNCOR) {
-
-			for(j=0; j < mtd->writesize; j++) {
-				if(buf[j] != 0xFF) {
-					no_all_ffs = 1;
-					break;
-				}
-			}
-			if(no_all_ffs) {
-				printk(KERN_INFO "step %d: ECC failed \r\n", i);
-				mtd->ecc_stats.failed++;
-			}
-		}
-		else {
-			/* Update ECC stats */
-			if(nc->ecc_status[i] != NX_NAND_INT_DEC_0_ERR) {
-				for(j=0; j < 5; j++) {
-					if(nc->ecc_status[i] == (NX_NAND_INT_DEC_1_ERR << j)) {
-						stat = j+1;
-					}
-				}
-				mtd->ecc_stats.corrected += stat;
-			}
-		}
-	}
+    struct nx_nand_ctrl *nc = chip->priv;
 
-	return 0;
-}
-#endif
+    /* Read page data */
+    nand_read_page(mtd, buf, chip->oob_poi);
 
-/**
-* nx_nand_read_oob - Read OOB data
-* @mtd: MTD information structure
-* @chip: Chip information structure
-* @page: Page address
-* @sndcmd: Send command flag
-*
-* Read OOB data into the buffer
-*/
-static int nx_nand_read_oob(struct mtd_info *mtd, struct nand_chip *chip,
-				  int page, int sndcmd)
-{
-	struct nx_nand_ctrl *nc = chip->priv;
-	uint8_t *buf = chip->oob_poi;
-	int length = mtd->oobsize;
-	int column, addr, i;
-	uint32_t	data;
-	uint32_t page_cfg;
-
-	DBG_PRINT(("> IP2017 nx_nand_read_oob enter \r\n"));
-
-	if(mtd->flags & MTD_USE_DEV_OOB_LAYOUT) {
-		/* Use device OOB layout */
-		DBG_PRINT(("Use device OOB layout \r\n"));
-		/* No page operation */
-		page_cfg = PAGE_RW_OOB_MSK;
-		DBG_PRINT(("IP2017_PAGE_RW 0x%x \r\n", page_cfg));
-		writel(page_cfg, (nc->ctrl_base + PAGE_RW_OFFSET));
-
-		/* Send READOOB command */
-		if(sndcmd) {
-			chip->cmdfunc(mtd, NAND_CMD_READOOB, 0, page);
-		}
-
-		/* Check if CE DON't care is supported */
-		column = nc->cur_col;
-		i = 0;
-		while(length) {
-			/* Send Address & cmd cycles */
-			if(sndcmd) {
-				/* Send READ0 command */
-				nx_nand_cmd_addr(nc, 1, nc->cur_cmd, 0);
-				DBG_PRINT(("CMD: 0x%x \r\n", nc->cur_cmd));
-
-				/* Send address cycles */
-				addr = column & NX_NAND_SP_ADDR_MASK;
-				nx_nand_cmd_addr(nc, 0, addr, 0);
-				DBG_PRINT(("addr0 0x%x \r\n", addr));
-
-				if(nc->lb_chip) {
-					addr = (column >> 8) & NX_NAND_SP_ADDR_MASK;
-					nx_nand_cmd_addr(nc, 0, addr, 0);
-					DBG_PRINT(("addr1 0x%x \r\n", addr));
-				}
-
-				addr = nc->cur_page & NX_NAND_SP_ADDR_MASK;
-				nx_nand_cmd_addr(nc, 0, addr, 0);
-				DBG_PRINT(("addr2 0x%x \r\n", addr));
-
-				if(nc->lb_chip) {
-					/* if > 2Gb, extra address cycle */
-					if (chip->chipsize >= (1 << 28)) {
-						addr = (nc->cur_page >> 16) & NX_NAND_SP_ADDR_MASK;
-						nx_nand_cmd_addr(nc, 0, addr, 0);
-						DBG_PRINT(("addr3 0x%x \r\n", addr));
-					}
-
-					/* Send READSTART command */
-					nx_nand_cmd_addr(nc, 1, NAND_CMD_READSTART, 1);
-					DBG_PRINT(("READSTART 0x%x \r\n", NAND_CMD_READSTART));
-				}
-				else {
-					if (chip->chipsize > (32 << 20)) {
-						addr = (nc->cur_page >> 8) & NX_NAND_SP_ADDR_MASK;
-						nx_nand_cmd_addr(nc, 0, addr, 0);
-						DBG_PRINT(("addr3 0x%x \r\n", addr));
-
-						addr = (nc->cur_page >> 16) & NX_NAND_SP_ADDR_MASK;
-						nx_nand_cmd_addr(nc, 0, addr, 1);
-						DBG_PRINT(("addr4 0x%x \r\n", addr));
-					}
-					else {
-						addr = (nc->cur_page >> 8) & NX_NAND_SP_ADDR_MASK;
-						nx_nand_cmd_addr(nc, 0, addr, 1);
-						DBG_PRINT(("addr3 0x%x \r\n", addr));
-					}
-				}
-				sndcmd = 0;
-
-				/* Wait for completion */
-				udelay(chip->chip_delay);
-			}
-
-			/* Read data from chip */
-
-			data = readl(nx_nc->ctrl_base + SINGLE_READ_OFFSET);
-			buf[i] = (uint8_t) data;
-			DBG_PRINT(("Sinlge_READ: 0x%x \r\n", addr));
-
-			length--;
-			i++;
-
-			if(!nx_nc->cedontcare) {
-				sndcmd = 1;
-				column++;
-			}
-		}
-	}
-	else {
-		/* Use IP_2017 OOB layout - (512 Bytes data + 16 bytes OOB data) */
-		DBG_PRINT(("Use IP_2017 device OOB layout \r\n"));
-		/* Send READOOB command */
-		if(sndcmd) {
-			chip->cmdfunc(mtd, NAND_CMD_READ0, 0, page);
-			sndcmd = 0;
-		}
-
-		/* Copy into user buffer */
-		nc->offset = mtd->writesize;
-		invalidate_dcache_range((ulong)nc->dmabuf, ((ulong)nc->dmabuf + mtd->writesize + mtd->oobsize));
-		chip->read_buf(mtd, chip->oob_poi, mtd->oobsize);
-	}
-	DBG_PRINT(("< IP2017 nx_nand_read_oob exit \r\n"));
+    /* Check ECC status */
+    if (nc->ecc_status & NX_NAND_INT_DEC_UNCOR) {
+        printf("ECC failed\n");
+        mtd->ecc_stats.failed++;
+    } else {
+        /* Update ECC stats */
+        if ((nc->ecc_status & NX_NAND_INT_DEC_0_ERR) == 0) {
+            mtd->ecc_stats.corrected++;
+        }
+    }
 
-	return 0;
+    return 0;
 }
 
 /**
-* nx_nand_write_buf - Write data into chip
-* @mtd: MTD information structure
-* @buf: Data buffer
-* @len: Transfer size
-*
-* Write specified number of bytes into the nand chip
-*/
-static void nx_nand_write_buf(struct mtd_info *mtd, const uint8_t *buf,
-		int len)
+ * nx_nand_read_oob - Read OOB data
+ * @mtd: MTD information structure
+ * @chip: Chip information structure
+ * @page: Page address
+ * @sndcmd: Send command flag
+ *
+ * Read OOB data into the buffer
+ */
+static int nx_nand_read_oob(struct mtd_info *mtd, struct nand_chip *chip,
+                            int page, int sndcmd)
 {
-	DBG_PRINT(("> IP2017 nx_nand_write_buf enter \r\n"));
+    uint8_t *nbuf;
 
-	struct nand_chip *chip= mtd->priv;
-	struct nx_nand_ctrl *nc = chip->priv;
+    nbuf = (uint8_t*)malloc(mtd->writesize);
+    if (nbuf == 0) {
+        printf("Couldn't allocate memory\n");
+        return -ENOMEM;
+    }
+    /* Not optimal, since we read the whole page as well */
+    nand_read_page(mtd, nbuf, chip->oob_poi);
 
-	/* Copy data to driver buffer */
-	memcpy(nc->dmabuf + nc->offset, buf, len);
-	nc->offset += len;
-	DBG_PRINT(("< IP2017 nx_nand_write_buf leave \r\n"));
+    free(nbuf);
 
+    return 0;
 }
 
 /**
-* nx_nand_write_page_raw - Write 1 page data into chip
-* @mtd: MTD information structure
-* @chip: Chip information structure
-* @buf: Data buffer
-*
-* Write a full page + oob into the buffer
-*/
+ * nx_nand_write_page_raw - Write 1 page data into chip
+ * @mtd: MTD information structure
+ * @chip: Chip information structure
+ * @buf: Data buffer
+ *
+ * Write a full page + oob into the buffer
+ */
 static void nx_nand_write_page_raw(struct mtd_info *mtd, struct nand_chip *chip,
-				  const uint8_t *buf)
+                                   const uint8_t *buf)
 {
-	struct nx_nand_ctrl *nc = chip->priv;
-	unsigned long len = mtd->writesize + mtd->oobsize;
-	uint32_t	intr=0;
-	volatile 	uint32_t int_status;
-	uint16_t	addr;
-	int chanid, status;
-	uint32_t page_cfg;
-	nx_dmac_tfr_t				req;
-	nx_dmac_stgt_t			stgt[5];
-
-	DBG_PRINT(("> IP2017 nx_nand_write_page_raw enter \r\n"));
-
-	/* Copy data into buffer */
-	chip->write_buf(mtd, buf, mtd->writesize);
-	chip->write_buf(mtd, chip->oob_poi, mtd->oobsize);
-	flush_dcache_range((ulong)nc->dmabuf, (ulong)nc->dmabuf + len);
-
-	/* Scatter gather list for DMAC */
-	nx_nand_dmac_init(nc, 0, &req, stgt);
-
-	/* Configure Flow control */
-/*	writel(DMA_CTRL_MEM_2_PER, (nx_nc->ctrl_base + DMA_CTRL_OFFSET)); */
-
-	/* Start DMA */
-	chanid = nx_dmac_tfr(&req);
-	if(chanid < 0) {
-		printk(KERN_ERR "nx_nand: NAND_SEQIN DMAC config \r\n");
-		return;
-	}
-
-	/* Page operation */
-	page_cfg = PAGE_RW_OOB_MSK | PAGE_RW_PAGE_WRITE_MSK;
-	if(nc->aes) {
-		page_cfg |= PAGE_RW_AES_MSK;
-	}
-
-	if(chip->ecc.mode == NAND_ECC_HW) {
-		page_cfg |= PAGE_RW_ECC_MSK;
-	}
-	writel(page_cfg, (nx_nc->ctrl_base + PAGE_RW_OFFSET));
-
-	/* Clear interrupt */
-	writel(NX_NAND_INT_ALL, (nx_nc->ctrl_base + INT_CLR_STATUS_OFFSET));
-
-	/* Enable SEQ WRIEt & READY interrupts */
-	intr = NX_NAND_INT_SEQ_WRITE | (1 << (NX_NAND_INT_READY_START + nc->slotid));
-	writel(intr, (nx_nc->ctrl_base + INT_SET_ENABLE_OFFSET));
-
-	/* Send SEQIN command */
-	nx_nand_cmd_addr(nc, 1, NAND_CMD_SEQIN, 0);
-
-	/* Send address commands */
-	addr = nc->cur_col & NX_NAND_SP_ADDR_MASK;
-	nx_nand_cmd_addr(nc, 0, addr, 0);
-
-	if(nc->lb_chip) {
-		addr = (nc->cur_col >> 8) & NX_NAND_SP_ADDR_MASK;
-		nx_nand_cmd_addr(nc, 0, addr, 0);
-	}
-
-	addr = nc->cur_page & NX_NAND_SP_ADDR_MASK;
-	nx_nand_cmd_addr(nc, 0, addr, 0);
-
-	addr = (nc->cur_page >> 8) & NX_NAND_SP_ADDR_MASK;
-	nx_nand_cmd_addr(nc, 0, addr, 0);
-
-	if(nc->lb_chip) {
-		/* if > 2Gb, extra address cycle */
-		if (chip->chipsize >= (1 << 28)) {
-			addr = (nc->cur_page >> 16) & NX_NAND_SP_ADDR_MASK;
-			nx_nand_cmd_addr(nc, 0, addr, 0);
-		}
-	}
-	else {
-		/* if > 64MB, extra adddress cycle */
-		if (chip->chipsize > (32 << 20)) {
-			addr = (nc->cur_page >> 16) & NX_NAND_SP_ADDR_MASK;
-			nx_nand_cmd_addr(nc, 0, addr, 0);
-		}
-	}
-
-	/* Send PAGEPROG - post write command */
-	nx_nand_cmd_addr(nc, 2, NAND_CMD_PAGEPROG, 1);
-
-	/* Complete DMAC transfer */
-	status = nx_dmac_tfr_comp(chanid);
-	if(status) {
-		printk(KERN_ERR "nx_nand: write_page_raw \r\n");
-		return;
-	}
-
-	/* Wait till READY interrupt */
-	set_timeout(PNX8XXX_TIMEOUT);
-	int_status = readl(nx_nc->ctrl_base + INT_STATUS_OFFSET);
-	while (!(1 << (NX_NAND_INT_READY_START + nc->slotid))) {
-		/* Timeout */
-		if(did_timeout()) {
-			printk("TIMEOUT: Write \r\n");
-			return;
-		}
-
-		/* Get Page done */
-		if(int_status & NX_NAND_INT_SEQ_WRITE) {
-			writel(NX_NAND_INT_SEQ_WRITE, (nx_nc->ctrl_base + INT_CLR_STATUS_OFFSET));
-		}
-		int_status = readl(nx_nc->ctrl_base + INT_STATUS_OFFSET);
-	}
-
-	/* Clear interrupt */
-	writel(int_status, (nx_nc->ctrl_base + INT_CLR_STATUS_OFFSET));
-
-	/* Disable interrupt */
-	writel(intr, (nx_nc->ctrl_base + INT_CLR_ENABLE_OFFSET));
-
-	/* Disable Flow control */
-/*	writel(0, (nx_nc->ctrl_base + DMA_CTRL_OFFSET)); */
+    nand_write_page(mtd, buf, chip->oob_poi);
 
-	DBG_PRINT(("< IP2017 nx_nand_write_page_raw leave \r\n"));
-
-	return;
+    return;
 }
 
-#ifdef CONFIG_MTD_NX_NAND_HWECC
 /**
-* nx_nand_write_page - Write 1 page data into chip when HW ECC enabled
-* @mtd: MTD information structure
-* @chip: Chip information structure
-* @buf: Data buffer
-*
-* Write a full page + oob into the buffer
-*/
+ * nx_nand_write_page - Write 1 page data into chip when HW ECC enabled
+ * @mtd: MTD information structure
+ * @chip: Chip information structure
+ * @buf: Data buffer
+ *
+ * Write a full page + oob into the buffer
+ */
 static void nx_nand_write_page(struct mtd_info *mtd, struct nand_chip *chip,
-				  const uint8_t *buf)
+                               const uint8_t *buf)
 {
-	/* write page */
-	nx_nand_write_page_raw(mtd, chip, buf);
+    nand_write_page(mtd, buf, chip->oob_poi);
 
-	return;
+    return;
 }
-#endif
-
-static uint8_t temp_buf[NAND_MAX_PAGESIZE+NAND_MAX_OOBSIZE];
-#define OOB_BYTES_PER_BLK (16)
 
 /**
-* nx_nand_write_oob - Write OOB data
-* @mtd: MTD information structure
-* @chip: Chip information structure
-* @page: Page address
-*
-* Write OOB data into the chip
-*/
+ * nx_nand_write_oob - Write OOB data
+ * @mtd: MTD information structure
+ * @chip: Chip information structure
+ * @page: Page address
+ *
+ * Write OOB data into the chip
+ */
 static int nx_nand_write_oob(struct mtd_info *mtd, struct nand_chip *chip,
-				  int page)
+                             int page)
 {
-	struct nx_nand_ctrl *nc = chip->priv;
-	int status = 0, sndcmd = 1;
-  const uint8_t *buf = chip->oob_poi;
-  int length;
-	int column, addr, i;
-	uint16_t	data;
-	uint32_t page_cfg;
-	int	ecc_old, aes_old;
-	uint8_t	*oob_poi_orig, *temp1;
-
-	DBG_PRINT(("> IP2017 nx_nand_write_oob enter \r\n"));
-
-	if(mtd->flags & MTD_USE_DEV_OOB_LAYOUT) {
-		/* Use Device OOB layout -  write only OOB data */
-		/* No page operation */
-		page_cfg = PAGE_RW_OOB_MSK;
-		writel(page_cfg, (nx_nc->ctrl_base + PAGE_RW_OFFSET));
-
-		/* Send SEQIN command */
-		chip->cmdfunc(mtd, NAND_CMD_SEQIN, mtd->writesize, page);
-
-		/* Write to driver buffer */
-		length = mtd->oobsize;
-		chip->write_buf(mtd, buf, length);
-
-		/* Check if CE DON't care is supported */
-		column = nc->cur_col;
-		i = 0;
-
-		while(length) {
-			/* Send Address & cmd cycles */
-			if(sndcmd) {
-				/* Send SEQIN comand */
-				nx_nand_cmd_addr(nc, 1, NAND_CMD_SEQIN, 0);
-
-				/* Send address cycles */
-				addr = column & NX_NAND_SP_ADDR_MASK;
-				nx_nand_cmd_addr(nc, 0, addr, 0);
-
-				if(nc->lb_chip) {
-					addr = (column >> 8) & NX_NAND_SP_ADDR_MASK;
-					nx_nand_cmd_addr(nc, 0, addr, 0);
-				}
-
-				addr = nc->cur_page & NX_NAND_SP_ADDR_MASK;
-				nx_nand_cmd_addr(nc, 0, addr, 0);
-
-				if(nc->lb_chip) {
-					/* if > 2Gb, extra address cycle */
-					if (chip->chipsize >= (1 << 28)) {
-						addr = (nc->cur_page >> 8) & NX_NAND_SP_ADDR_MASK;
-						nx_nand_cmd_addr(nc, 0, addr, 0);
-
-						addr = (nc->cur_page >> 16) & NX_NAND_SP_ADDR_MASK;
-						nx_nand_cmd_addr(nc, 0, addr, 1);
-					}
-					else {
-						addr = (nc->cur_page >> 8) & NX_NAND_SP_ADDR_MASK;
-						nx_nand_cmd_addr(nc, 0, addr, 1);
-					}
-				}
-				else {
-					/* if > 64Mb, extra adddress cycle */
-					if (chip->chipsize > (32 << 20)) {
-						addr = (nc->cur_page >> 8) & NX_NAND_SP_ADDR_MASK;
-						nx_nand_cmd_addr(nc, 0, addr, 0);
-
-						addr = (nc->cur_page >> 16) & NX_NAND_SP_ADDR_MASK;
-						nx_nand_cmd_addr(nc, 0, addr, 1);
-					}
-					else {
-						addr = (nc->cur_page >> 8) & NX_NAND_SP_ADDR_MASK;
-						nx_nand_cmd_addr(nc, 0, addr, 1);
-					}
-				}
-				sndcmd = 0;
-			}
-
-			/* Write data into chip */
-			data = buf[i];
-			writel(data, nx_nc->ctrl_base + SINGLE_WRITE_OFFSET);
-
-			length--;
-			i++;
-			if(!nx_nc->cedontcare) {
-				sndcmd = 1;
-				column++;
-			}
-		}
-
-		/* write PAGEPROG command */
-		nx_nand_cmd_addr(nc, 1, NAND_CMD_PAGEPROG, 1);
-	}
-	else {
-		/* Use IP_2017 OOB layout - write page */
-		/* Store ECC,AES values & Disbale */
-		ecc_old = chip->ecc.mode;
-		aes_old = nc->aes;
-		oob_poi_orig = chip->oob_poi;
-		chip->ecc.mode = NAND_ECC_NONE;
-		nc->aes = 0;
-
-		/* Send SEQIN command */
-		chip->cmdfunc(mtd, NAND_CMD_SEQIN, 0, page);
-
-		/* Write dummy_buf for page write */
-		memset(temp_buf, 0xff, (mtd->writesize+mtd->oobsize));
-
-		/* copy OOB */
-		temp1 = temp_buf;
-		for(i=0; i < nc->num_blks; i++) {
-			temp1 += NX_NAND_BLK_SIZE;
-			memcpy(temp1, (chip->oob_poi + (i * OOB_BYTES_PER_BLK)), OOB_BYTES_PER_BLK);
-			temp1 += OOB_BYTES_PER_BLK;
-		}
-		chip->oob_poi = &temp_buf[mtd->writesize];
-
-		/* Call write page raw */
-		nx_nand_write_page_raw(mtd, chip, temp_buf);
-
-		/* Restore ECC,AES values & Disbale */
-		chip->oob_poi = oob_poi_orig;
-		chip->ecc.mode = ecc_old;
-		nc->aes = aes_old;
-	}
+    uint8_t *nbuf;
 
-	/* Send command to program the OOB data */
-  chip->cmdfunc(mtd, NAND_CMD_PAGEPROG, -1, -1);
+    nbuf = (uint8_t*)malloc(mtd->writesize + mtd->oobsize);
+    if (nbuf == 0) {
+        return -ENOMEM;
+    }
+    /* Not optimal, since we read/write the whole page as well */
+    nand_read_page(mtd, nbuf, &nbuf[mtd->writesize]);
+    nand_write_page(mtd, nbuf, chip->oob_poi);
 
-  status = chip->waitfunc(mtd, chip);
-  DBG_PRINT(("< IP2017 nx_nand_write_oob leave \r\n"));
+    free(nbuf);
 
-  return status & NAND_STATUS_FAIL ? -EIO : 0;
+    return 0;
 }
 
 /**
-* nx_nand_command - Command function for small page chips
-* @mtd: MTD information structure
-* @cmd: Command
-* @column: Column address
-* @page_addr: Page address
-*
-* Command control function:
-*/
+ * nx_nand_command - Command function for small page chips
+ * @mtd: MTD information structure
+ * @cmd: Command
+ * @column: Column address
+ * @page_addr: Page address
+ *
+ * Command control function:
+ */
 static void nx_nand_command(struct mtd_info *mtd, unsigned int cmd,
-			     int column, int page_addr)
+                            int column, int page_addr)
 {
-	struct nand_chip 		*chip= mtd->priv;
-	struct nx_nand_ctrl *nc = chip->priv;
-	uint32_t page_cfg;
-
-	/* Store the command, colmn & page address */
-	nc->cur_cmd = cmd;
-	if(column == -1)
-		column = 0;
-	nc->cur_col = column;
-	if(page_addr == -1)
-		page_addr = 0;
-	nc->cur_page = page_addr;
-	nc->mtd = mtd;
-	/*
-	 * Issue the correct first command, when we write to
-	 * the device.
-	 */
-	switch(cmd) {
-	case NAND_CMD_SEQIN:
-		nc->offset = 0;
-		/* Address & command sent in write_page_raw */
-		break;
-
-	case NAND_CMD_PAGEPROG:
-		/* command will be sent as post write command */
-		break;
-
-	case NAND_CMD_RESET:
-	case NAND_CMD_STATUS:
-		nx_nand_cmd_addr(nc, 1, cmd, 1);
-		break;
-
-	case NAND_CMD_ERASE1:
-		nx_nand_erase(nc);
-		break;
-
-	case NAND_CMD_ERASE2:
-		/* Already done in CMD_ERASE1 */
-		break;
-
-	case NAND_CMD_READ0:
-		nc->offset = 0;
-		nx_nand_read(nc);
-		break;
-
-	case NAND_CMD_READOOB:
-		/* use READ0 command */
-		nc->offset = mtd->writesize;
-		nx_nand_read(nc);
-		break;
-
-	case NAND_CMD_READID:
-
-		/* No Page operation */
-		page_cfg = 0;
-		if(nc->aes) {
-			page_cfg |= PAGE_RW_AES_MSK;
-		}
-		if(chip->ecc.mode == NAND_ECC_HW) {
-			page_cfg |= PAGE_RW_ECC_MSK;
-		}
-		writel(page_cfg, (nx_nc->ctrl_base + PAGE_RW_OFFSET));
-
-		nx_nand_cmd_addr(nc, 1, cmd, 0);
-		nx_nand_cmd_addr(nc, 0, column, 1);
-		break;
-
-	default:
-		printk(KERN_ERR "nxnand: command not supported %d \n", cmd);
-	}
-}
-
-/**
-* nx_nand_command_lp - Command function for large page chips
-* @mtd: MTD information structure
-* @cmd: Command
-* @column: Column address
-* @page_addr: Page address
-*
-* Command control function:
-*/
+    struct nand_chip            *chip= mtd->priv;
+    struct nx_nand_ctrl *nc = chip->priv;
+    uint32_t page_cfg;
+
+    /* Store the command, colmn & page address */
+    nc->cur_cmd = cmd;
+    if (column == -1) {
+        column = 0;
+    }
+    nc->cur_col = column;
+    if (page_addr == -1) {
+        page_addr = 0;
+    }
+    nc->cur_page = page_addr;
+    nc->mtd = mtd;
+    /*
+     * Issue the correct first command, when we write to
+     * the device.
+     */
+    switch(cmd) {
+    case NAND_CMD_SEQIN:
+        nc->offset = 0;
+        /* Address & command sent in write_page_raw */
+        break;
+
+    case NAND_CMD_PAGEPROG:
+        /* command will be sent as post write command */
+        break;
+
+    case NAND_CMD_RESET:
+    case NAND_CMD_STATUS:
+        nx_nand_cmd_addr(nc, 1, cmd, 1);
+        break;
+
+    case NAND_CMD_ERASE1:
+        nx_nand_erase(nc);
+        break;
+
+    case NAND_CMD_ERASE2:
+        /* Already done in CMD_ERASE1 */
+        break;
+
+    case NAND_CMD_READ0:
+        nc->offset = 0;
+        break;
+
+    case NAND_CMD_READOOB:
+        /* use READ0 command */
+        nc->offset = mtd->writesize;
+        break;
+
+    case NAND_CMD_READID:
+        /* No Page operation */
+        page_cfg = 0;
+        if (nc->aes) {
+            page_cfg |= PAGE_RW_AES_MSK;
+        }
+        if (chip->ecc.mode == NAND_ECC_HW) {
+            page_cfg |= PAGE_RW_ECC_MSK;
+        }
+        writel(page_cfg, (nx_nc->ctrl_base + PAGE_RW_OFFSET));
+
+        nx_nand_cmd_addr(nc, 1, cmd, 0);
+        nx_nand_cmd_addr(nc, 0, column, 1);
+        break;
+
+    default:
+        printf("nxnand: command not supported %d\n", cmd);
+    }
+}
+
+/**
+ * nx_nand_command_lp - Command function for large page chips
+ * @mtd: MTD information structure
+ * @cmd: Command
+ * @column: Column address
+ * @page_addr: Page address
+ *
+ * Command control function:
+ */
 static void nx_nand_command_lp(struct mtd_info *mtd, unsigned int cmd,
-			     int column, int page_addr)
+                               int column, int page_addr)
 {
-	uint32_t	page_cfg;
-	struct nand_chip 		*chip= mtd->priv;
-	struct nx_nand_ctrl *nc = chip->priv;
-
-	/* Store the command, colmn & page address */
-	if(cmd == NAND_CMD_READOOB) {
-		cmd = NAND_CMD_READ0;
-
-		/* If Device OOB layout, read data in read_OOB function */
-		if(mtd->flags & MTD_USE_DEV_OOB_LAYOUT) {
-			nc->cur_cmd = cmd;
-			nc->cur_col = mtd->writesize;
-			nc->cur_page = page_addr;
-			return;
-		}
-	}
-
-	nc->cur_cmd = cmd;
-	if(column == -1)
-		column = 0;
-	nc->cur_col = column;
-	if(page_addr == -1)
-		page_addr = 0;
-	nc->cur_page =  (page_addr);
-	nc->mtd = mtd;
-
-	/*
-	 * Issue the correct first command, when we write to
-	 * the device.
-	 */
-	switch(cmd) {
-	case NAND_CMD_SEQIN:
-		nc->offset = column;
-		/* Address cycles & command will be sent in write_page_raw */
-		break;
-
-	case NAND_CMD_PAGEPROG:
-		break;
-
-	case NAND_CMD_RESET:
-	case NAND_CMD_STATUS:
-		nx_nand_cmd_addr(nc, 1, cmd, 1);
-		break;
-
-	case NAND_CMD_ERASE1:
-		nx_nand_erase(nc);
-		break;
-
-	case NAND_CMD_ERASE2:
-		/* Already done in CMD_ERASE1 */
-		break;
-
-	case NAND_CMD_READ0:
-		nc->offset = column;
-		nx_nand_read(nc);
-		break;
-
-	case NAND_CMD_READID:
-		/* No Page operation */
-		page_cfg = 0;
-		if(nc->aes) {
-			page_cfg |= PAGE_RW_AES_MSK;
-		}
-		if(chip->ecc.mode == NAND_ECC_HW) {
-			page_cfg |= PAGE_RW_ECC_MSK;
-		}
-		writel(page_cfg, (nx_nc->ctrl_base + PAGE_RW_OFFSET));
-
-		nx_nand_cmd_addr(nc, 1, cmd, 0);
-		nx_nand_cmd_addr(nc, 0, column, 1);
-		break;
-
-	default:
-		printk(KERN_ERR "nxnand: command not supported %d \n", cmd);
-	}
+    uint32_t page_cfg;
+    struct nand_chip            *chip= mtd->priv;
+    struct nx_nand_ctrl *nc = chip->priv;
+
+    /* Store the command, colmn & page address */
+    if (cmd == NAND_CMD_READOOB) {
+        cmd = NAND_CMD_READ0;
+
+        /* If Device OOB layout, read data in read_OOB function */
+        if (mtd->flags & MTD_USE_DEV_OOB_LAYOUT) {
+            nc->cur_cmd = cmd;
+            nc->cur_col = mtd->writesize;
+            nc->cur_page = page_addr;
+            return;
+        }
+    }
+
+    nc->cur_cmd = cmd;
+    if (column == -1) {
+        column = 0;
+    }
+    nc->cur_col = column;
+    if (page_addr == -1) {
+        page_addr = 0;
+    }
+    nc->cur_page = page_addr;
+    nc->mtd = mtd;
+
+    /*
+     * Issue the correct first command, when we write to
+     * the device.
+     */
+    switch(cmd) {
+    case NAND_CMD_SEQIN:
+        nc->offset = column;
+        /* Address cycles & command will be sent in write_page_raw */
+        break;
+
+    case NAND_CMD_PAGEPROG:
+        break;
+
+    case NAND_CMD_RESET:
+    case NAND_CMD_STATUS:
+        nx_nand_cmd_addr(nc, 1, cmd, 1);
+        break;
+
+    case NAND_CMD_ERASE1:
+        nx_nand_erase(nc);
+        break;
+
+    case NAND_CMD_ERASE2:
+        /* Already done in CMD_ERASE1 */
+        break;
+
+    case NAND_CMD_READ0:
+        nc->offset = column;
+        break;
+
+    case NAND_CMD_READID:
+        /* No Page operation */
+        page_cfg = 0;
+        if (nc->aes) {
+            page_cfg |= PAGE_RW_AES_MSK;
+        }
+        if (chip->ecc.mode == NAND_ECC_HW) {
+            page_cfg |= PAGE_RW_ECC_MSK;
+        }
+        writel(page_cfg, (nx_nc->ctrl_base + PAGE_RW_OFFSET));
+
+        nx_nand_cmd_addr(nc, 1, cmd, 0);
+        nx_nand_cmd_addr(nc, 0, column, 1);
+        break;
+
+    default:
+        printf("nxnand: command not supported %d\n", cmd);
+    }
 }
 
 /**
  * nx_nand_block_bad - Read bad block marker from the chip
- * @mtd:	MTD device structure
- * @ofs:	offset from device start
- * @getchip:	0, if the chip is already selected
+ * @mtd:        MTD device structure
+ * @ofs:        offset from device start
+ * @getchip:    0, if the chip is already selected
  *
  * Check, if the block is bad.
  */
 static int nx_nand_block_bad(struct mtd_info *mtd, loff_t ofs, int getchip)
 {
-	struct mtd_oob_ops ops;
-	uint8_t	buf[NAND_MAX_OOBSIZE];
-  int ret;
-	u8 bad;
-	int res = 0;
-	struct nand_chip *chip = mtd->priv;
-
-	mtd->flags |= MTD_USE_DEV_OOB_LAYOUT;
-	/* Read OOB data */
-  ops.ooblen = mtd->oobsize;
-  ops.oobbuf = buf;
-  ops.ooboffs = 0;
-  ops.datbuf = NULL;
-  ops.mode = MTD_OOB_PLACE;
-  ret = mtd->read_oob(mtd, ofs, &ops);
-  if (ret) {
-		printk(KERN_INFO "READOOB failed 0x%x \r\n", ret);
-		mtd->flags &= ~MTD_USE_DEV_OOB_LAYOUT;
-    return ret;
-	}
-	mtd->flags &= ~MTD_USE_DEV_OOB_LAYOUT;
-
-	/* Check the bad block marker */
-	bad = buf[chip->badblockpos];
-	if (bad != 0xff) {
-		res = 1;
-	}
-
-	return res;
+    struct mtd_oob_ops ops;
+    uint8_t buf[NAND_MAX_OOBSIZE];
+    int ret;
+    u8 bad;
+    int res = 0;
+    struct nand_chip *chip = mtd->priv;
+
+    mtd->flags |= MTD_USE_DEV_OOB_LAYOUT;
+    /* Read OOB data */
+    ops.ooblen = mtd->oobsize;
+    ops.oobbuf = buf;
+    ops.ooboffs = 0;
+    ops.datbuf = NULL;
+    ops.mode = MTD_OOB_PLACE;
+    ret = mtd->read_oob(mtd, ofs, &ops);
+    if (ret) {
+        printf("READOOB failed 0x%x\n", ret);
+        mtd->flags &= ~MTD_USE_DEV_OOB_LAYOUT;
+        return ret;
+    }
+    mtd->flags &= ~MTD_USE_DEV_OOB_LAYOUT;
+
+    /* Check the bad block marker */
+    bad = buf[chip->badblockpos];
+    if (bad != 0xff) {
+        res = 1;
+    }
+
+    return res;
 }
 
 /**
-* nx_nand_verify_buf - Verify user buffer with read back data
-* @mtd: MTD information structure
-* @buf: User buffer
-* @len: Size
-*
-* Command control function:
-*/
+ * nx_nand_verify_buf - Verify user buffer with read back data
+ * @mtd: MTD information structure
+ * @buf: User buffer
+ * @len: Size
+ *
+ * Command control function:
+ */
 static int nx_nand_verify_buf(struct mtd_info *mtd, const uint8_t *buf,
-		int len)
+                              int len)
 {
-	int i,status = 0;
-	struct nand_chip 		*chip= mtd->priv;
-	struct nx_nand_ctrl *nc = chip->priv;
-
-	/* After READ0 is sent, data will be available in driver buffer */
-	for(i=0; i < len; i++) {
-		if(buf[i] != nc->dmabuf[i]){
-			printk(KERN_INFO "Data mismatch at %d W: 0x%x R: 0x%x\r\n", i, buf[i], nc->dmabuf[i]);
-			status = -EIO;
-			break;
-		}
-	}
+    int i;
+    int status = 0;
+    uint8_t *nbuf;
 
-	return status;
-}
+    nbuf = (uint8_t*)malloc(mtd->writesize + mtd->oobsize);
+    if (nbuf == 0) {
+        return -ENOMEM;
+    }
+    nand_read_page(mtd, nbuf, &nbuf[mtd->writesize]);
+
+    for(i=0; i < len; i++) {
+        if (buf[i] != nbuf[i]){
+            printf("Data mismatch at %d W: 0x%x R: 0x%x\n", i, buf[i], nbuf[i]);
+            status = -EIO;
+            break;
+        }
+    }
 
-/* For Testing - To be removed */
-#define  DEV0_TYPE 			(0x0004C)
-#define  DEV0_TIME0			(0x00050)
-#define  DEV0_TIME1			(0x00054)
-#define  DMA_CTRL                       (0x0C)
-/* For Testing - To be removed */
+    free(nbuf);
 
-#define CACHE_LINE_SIZE (32)
-#define CACHE_LINE_MASK (CACHE_LINE_SIZE - 1)
+    return status;
+}
 
 /**
-* board_nand_init - NAND Initialisation function
-* @chip: NAND chip structure
-*
-* Repartition a device
-*/
+ * board_nand_init - NAND Initialisation function
+ * @chip: NAND chip structure
+ *
+ * Repartition a device
+ */
 int board_nand_init(struct nand_chip *chip)
 {
-	uint32_t	mod_config, dev_type, page_size;
-	int page, oob;
-	int ret;
-
-	/* Allocate memory NAND control for structure */
-	if(!nx_nc) {
-			nx_nc = kzalloc(sizeof(struct nx_nand_ctrl), GFP_KERNEL);
-			if(!nx_nc) {
-				printk("board_nand_init: nx_nc memory alloc failure \r\n");
-				return -ENOMEM;
-			}
-	}
-
-	/* For Testing - To be removed */
-	//glb_misc2 = readl((unsigned long *)(0xBBE63600));
-	//glb_misc2 |= 0x00000100;
-	//writel(glb_misc2, (unsigned long *)(0xBBE63600));
-
-#ifdef  CONFIG_PNX84XX
- 	writel(0x00000010, (unsigned long *) (PNX8XXX_EFM_BASE + DEV0_TYPE));
-	writel(0x02644448, (unsigned long *) (PNX8XXX_EFM_BASE + DEV0_TIME0));
-	writel(0x01008444, (unsigned long *) (PNX8XXX_EFM_BASE + DEV0_TIME1));
-#endif
-	/* Enable flow control for memory-to peripheral and peripheral-to-memory DMA*/
-	writel(0x3, (unsigned long *) (PNX8XXX_EFM_BASE + DMA_CTRL));
-
-	/* Initialise NAND control structure */
-	nx_nc->ctrl_base = (void __iomem *) KSEG1ADDR(PNX8XXX_EFM_BASE);
+    uint32_t mod_config, dev_type, page_size;
+    uint32_t type0;
+    int page, oob;
+    int ret;
+
+    /* Allocate memory NAND control for structure */
+    if (!nx_nc) {
+        nx_nc = calloc(sizeof(struct nx_nand_ctrl), 1);
+        if (!nx_nc) {
+            printf("board_nand_init: nx_nc memory alloc failure\n");
+            return -ENOMEM;
+        }
+    }
 
-	/* Read Module configuration */
-	mod_config = readl(nx_nc->ctrl_base + MOD_CONFIG_OFFSET);
-	if(mod_config & MOD_CONFIG_AES_MSK) {
-		nx_nc->aes = 1;
-	}
-	nx_nc->slotid = 0;
-
-	/* Read Flash configuration */
-	mod_config = readl(nx_nc->ctrl_base + DEV_TYPE0_OFFSET);
-	if(mod_config & DEV_TYPE0_CEN_DONT_MSK) {
-		nx_nc->cedontcare = 1;
-	}
-	nx_nc->lb_chip = 0;
-
-	/* NAND Chip structure */
-	chip->priv = nx_nc;
-	chip->chip_delay = 0;
-	chip->options = NAND_NO_AUTOINCR | NAND_ALLOW_CLEAR_BBT |
-		NAND_NO_SUBPAGE_WRITE;
-	chip->select_chip = nx_nand_select_chip;
-	chip->dev_ready = nx_nand_dev_ready;
-	dev_type = mod_config & DEV_TYPE0_DATA_WIDTH_MSK;
-	if (dev_type) {
-		chip->options |= NAND_BUSWIDTH_16;
-		chip->read_byte = nx_nand_read_byte16;
-	} else {
-		chip->read_byte = nx_nand_read_byte;
-	}
-	chip->cmdfunc = nx_nand_command;
-
-	/* Page & OOB size calculation */
-	page_size = (mod_config & DEV_TYPE0_PAGE_SIZE_MASK) >> DEV_TYPE0_PAGE_SIZE_POS;
-	switch (page_size) {
-		case 0:
-			page = 512;
-			oob = 16;
-			break;
-
-		case 1:
-			page = 2048;
-			oob = 64;
-			nx_nc->lb_chip = 1;
-			chip->cmdfunc = nx_nand_command_lp;
-			break;
-
-		case 2:
-			page = 4096;
-			oob = 128;
-			nx_nc->lb_chip = 1;
-			chip->cmdfunc = nx_nand_command_lp;
-			break;
-
-		default:
-			printk("Invalid page configuration %d\n", page_size);
-			return -ENXIO;
-	}
-
-	chip->ecc.read_page_raw = nx_nand_read_page_raw;
-	chip->ecc.write_page_raw = nx_nand_write_page_raw;
-	chip->ecc.read_oob = nx_nand_read_oob;
-	chip->ecc.write_oob = nx_nand_write_oob;
-	chip->read_buf = nx_nand_read_buf;
-	chip->write_buf = nx_nand_write_buf;
-	chip->verify_buf = nx_nand_verify_buf;
-	chip->block_bad = nx_nand_block_bad;
-
-#ifdef CONFIG_MTD_NX_NAND_HWECC
-	chip->ecc.read_page = nx_nand_read_page;
-	chip->ecc.write_page = nx_nand_write_page;
-	chip->ecc.mode = NAND_ECC_HW;
-	chip->ecc.calculate = nx_nand_calculate_ecc;
-	chip->ecc.correct = nx_nand_correct_data;
-	chip->ecc.hwctl = nx_nand_hwctl;
-	chip->ecc.size = 512;
-	chip->ecc.bytes = 12;
-
-	/* Use BBT decsriptors */
-	chip->bbt_td = &nx_bbt_main;
-	chip->bbt_md = &nx_bbt_mirror;
-
-	/* Use OOB layout */
-	switch (oob) {
-		case 16:
-			chip->ecc.layout = &nx_nand_oob_16;
-			break;
-
-		case 64:
-			chip->ecc.layout = &nx_nand_oob_64;
-			break;
-
-		case 128:
-			chip->ecc.layout = &nx_nand_oob_128;
-			break;
-
-		default:
-			printk("No oob scheme defined for oobsize %d\n", oob);
-			return -ENXIO;
-	}
-#endif
+    /* Initialise NAND control structure */
+    nx_nc->ctrl_base = (void __iomem *) KSEG1ADDR(PNX8XXX_EFM_BASE);
 
-#ifdef CONFIG_MTD_NX_NAND_SWECC
-	chip->ecc.mode = NAND_ECC_SOFT;
-#endif
-
-#ifdef CONFIG_MTD_NX_NAND_NONEECC
-	chip->ecc.read_page = nx_nand_read_page_raw;
-	chip->ecc.write_page = nx_nand_write_page_raw;
-	chip->ecc.mode = NAND_ECC_NONE;
+#ifdef  CONFIG_PNX84XX
+    /* Configure controller timing */
+    writel(0x00000010, (nx_nc->ctrl_base + DEV_TYPE0_OFFSET));
+    writel(0x02644448, (nx_nc->ctrl_base + DEV_TIMING0_OFFSET));
+    writel(0x01008444, (nx_nc->ctrl_base + DEV_TIMING1_OFFSET));
 #endif
 
-	/* Calculate number of 512byte blocks in a page */
-	nx_nc->num_blks = page >> 9;
+    /* Enable flow control for memory-to peripheral and peripheral-to-memory DMA*/
+    writel(0x3, (nx_nc->ctrl_base + DMA_CTRL_OFFSET));
 
-	/* Allocate ECC status array */
-	nx_nc->ecc_status = kzalloc(sizeof(int) * nx_nc->num_blks, GFP_KERNEL);
-	if(!nx_nc->ecc_status) {
-		printk(KERN_ERR "board_nand_init: ECC status alloc \r\n");
-		ret = -ENOMEM;
-		goto out_free1;
-	}
-
-	/* Allocate internal driver buffer */
-	nx_nc->dmabuf_unalgn =  kzalloc( ((page + oob) + (CACHE_LINE_SIZE * 2)),
-			      GFP_DMA | GFP_KERNEL);
-	if(!nx_nc->dmabuf_unalgn) {
-		printk(KERN_ERR "board_nand_init: DMA buf alloc \r\n");
-		ret = -ENOMEM;
-		goto out_free2;
-	}
-	nx_nc->dmabuf = (uint8_t *)((unsigned long)(nx_nc->dmabuf_unalgn + CACHE_LINE_SIZE - 1)
-						& (~CACHE_LINE_MASK));
-	invalidate_dcache_range((ulong)nx_nc->dmabuf, ((ulong)nx_nc->dmabuf + page + oob));
-
-	chip->options |= NAND_ALLOW_CLEAR_BBT | NAND_NO_SUBPAGE_WRITE | NAND_USE_FLASH_BBT;
-
-	ret = nx_dmac_init();
-	if(ret) {
-		printf(KERN_ERR "board_nand_init:DMAC init failed \r\n");
-		return -EIO;
-	}
-
-	return 0;
+    /* Read Module configuration */
+    mod_config = readl(nx_nc->ctrl_base + MOD_CONFIG_OFFSET);
+    if (mod_config & MOD_CONFIG_AES_MSK) {
+        nx_nc->aes = 1;
+    }
+    nx_nc->slotid = 0;
+
+    /* Read Flash configuration */
+    type0 = readl(nx_nc->ctrl_base + DEV_TYPE0_OFFSET);
+    if (type0 & DEV_TYPE0_CEN_DONT_MSK) {
+        nx_nc->cedontcare = 1;
+    }
+
+    /* NAND Chip structure */
+    chip->priv = nx_nc;
+    chip->chip_delay = 0;
+    chip->options = (NAND_NO_AUTOINCR |
+                     NAND_ALLOW_CLEAR_BBT |
+                     NAND_NO_SUBPAGE_WRITE);
+    chip->select_chip = nx_nand_select_chip;
+    chip->dev_ready = nx_nand_dev_ready;
+    dev_type = type0 & DEV_TYPE0_DATA_WIDTH_MSK;
+    if (dev_type) {
+        chip->options |= NAND_BUSWIDTH_16;
+        chip->read_byte = nx_nand_read_byte16;
+    } else {
+        chip->read_byte = nx_nand_read_byte;
+    }
+
+    /* Page & OOB size calculation */
+    page_size = (type0 & DEV_TYPE0_PAGE_SIZE_MASK) >> DEV_TYPE0_PAGE_SIZE_POS;
+    switch (page_size) {
+    case 0:
+        page = 512;
+        oob = 16;
+        nx_nc->lb_chip = 0;
+        chip->cmdfunc = nx_nand_command;
+        chip->ecc.layout = &nx_nand_oob_16;
+        break;
+
+    case 1:
+        page = 2048;
+        oob = 64;
+        nx_nc->lb_chip = 1;
+        chip->cmdfunc = nx_nand_command_lp;
+        chip->ecc.layout = &nx_nand_oob_64;
+        break;
+
+    case 2:
+        page = 4096;
+        oob = 128;
+        nx_nc->lb_chip = 1;
+        chip->cmdfunc = nx_nand_command_lp;
+        chip->ecc.layout = &nx_nand_oob_128;
+        break;
+
+    default:
+        printf("Invalid page configuration %d\n", page_size);
+        ret = -ENXIO;
+        goto out;
+    }
+
+    chip->ecc.read_page = nx_nand_read_page;
+    chip->ecc.read_page_raw = nx_nand_read_page_raw;
+    chip->ecc.read_oob = nx_nand_read_oob;
+
+    chip->ecc.write_page = nx_nand_write_page;
+    chip->ecc.write_page_raw = nx_nand_write_page_raw;
+    chip->ecc.write_oob = nx_nand_write_oob;
+
+    chip->verify_buf = nx_nand_verify_buf;
+    chip->block_bad = nx_nand_block_bad;
+
+    chip->ecc.mode = NAND_ECC_HW;
+    chip->ecc.size = 512;
+    chip->ecc.bytes = 12;
+
+    /* Use BBT decsriptors */
+    chip->bbt_td = &nx_bbt_main;
+    chip->bbt_md = &nx_bbt_mirror;
+
+    /* Calculate number of 512byte blocks in a page */
+    nx_nc->num_blks = page >> 9;
+    nx_nc->page_size = page;
+    nx_nc->oob_size = oob;
+
+    /* Allocate ECC status array */
+    nx_nc->ecc_status = 0;
+
+    chip->options |= NAND_ALLOW_CLEAR_BBT | NAND_NO_SUBPAGE_WRITE | NAND_USE_FLASH_BBT;
+
+    ret = nx_dmac_init();
+    if (ret) {
+        printf("board_nand_init:DMAC init failed \n");
+        ret = -EIO;
+        goto out;
+    }
 
-out_free2:
-	kfree(nx_nc->ecc_status);
+    return 0;
 
-out_free1:
-	kfree(nx_nc);
+out:
+    kfree(nx_nc);
 
-	return ret;
+    return ret;
 }
 
diff -Naur u-boot-2009.08.orig3/drivers/mtd/nand/nx_nand_ip2070.h u-boot-2009.08.mine2/drivers/mtd/nand/nx_nand_ip2070.h
--- u-boot-2009.08.orig3/drivers/mtd/nand/nx_nand_ip2070.h	2010-10-13 16:01:49.240001683 -0500
+++ u-boot-2009.08.mine2/drivers/mtd/nand/nx_nand_ip2070.h	2010-10-13 16:12:43.464502004 -0500
@@ -20,7 +20,7 @@
  *
  * Revision history
  * Version    Date          Remarks
- * 0.0.1		20080318		Draft-Initial version
+ * 0.0.1                20080318                Draft-Initial version
  */
 
 #include <common.h>
@@ -35,77 +35,77 @@
 #include <asm/errno.h>
 
 /* Fix me: To be taken from glb.h */
-#define		PNX8XXX_EFM_BASE		(PNX84XX_GCS_BASE + PNX84XX_GCS_IP2017_OFSET)
-#define 	NX_NAND_AHB_BUF			(0x40000000) 		/* DMAC Flow conttrol */
+#define PNX8XXX_EFM_BASE          (PNX84XX_GCS_BASE + PNX84XX_GCS_IP2017_OFSET)
+#define NX_NAND_AHB_BUF           (0x40000000)            /* DMAC Flow conttrol */
 
 /* Max Data buffer size */
-#define NX_NAND_BLK_SIZE          (512)
+#define NX_NAND_BUF_SIZE          (512)
 
 /* Max OOB buffer size */
 #define NX_NAND_MAX_OOB_SIZE      (128)
 
 /* Maximum AHB buffer size */
-#define NX_NAND_AHB_BUF_MAX_SIZE  (NX_NAND_BLK_SIZE+NX_NAND_MAX_OOB_SIZE)
+#define NX_NAND_AHB_BUF_MAX_SIZE  (NX_NAND_BUF_SIZE+NX_NAND_MAX_OOB_SIZE)
 
 /* IP_2017 Register offsets */
-#define CMD_ADDR_FIFO_OFFSET          (0x000) /**< EFMC Nand Flash Command / Address FIFO register */
-#define PAGE_RW_OFFSET                (0x004) /**< EFMC Nand Flash Page Read/Write register */
-#define NAND_STATUS_OFFSET            (0x008) /** Nand Flash Status registers */
-#define DMA_CTRL_OFFSET               (0x00C) /** DMA Control Register */
-#define EBI_CTRL_OFFSET               (0x010) /**<  EBI Pin-Sharing Control Register*/
-#define AHB_LATENCY_OFFSET            (0x014) /**< AX/AHB Latency Register */
-#define APB_LATENCY_OFFSET            (0x018) /**<  APB Latency Register*/
-#define APB_ERROR_GEN_OFFSET          (0x01C) /**<  APB Error Register */
-#define AES_KEY1_OFFSET               (0x020) /**< AES Key Register(1st 32bit) */
-#define AES_KEY2_OFFSET               (0x024) /**< AES Key Register(2nd 32bit) */
-#define AES_KEY3_OFFSET               (0x028) /**< AES Key Register (3rd 32bit) */
-#define AES_KEY4_OFFSET               (0x02C) /**< AES Key Register (4th 32bit) */
-#define AES_IV1_OFFSET                (0x030) /**<  AES Initial Value Register (1st 32bit)*/
-#define AES_IV2_OFFSET                (0x034) /**< AES Initial Value Register (2nd32bit) */
-#define AES_IV3_OFFSET                (0x038) /**< AES Initial Value Register (3rd 32bit) */
-#define AES_IV4_OFFSET                (0x03C) /**< AES Initial Value Register (4th 32bit) */
-#define AES_STATUS_OFFSET             (0x040) /**< AES Status Register */
-#define SINGLE_READ_OFFSET            (0x044) /**<  Nand Flash SInge Read Register*/
-#define SINGLE_WRITE_OFFSET           (0x048) /**< Nand Flash SInge Write Register */
-#define DEV_TYPE0_OFFSET              (0x04C) /**<  Nand Flash Device Type Register for CEn[n]*/
-#define DEV_TYPE0_DIFF                (0x00C) /**  */
-#define DEV_TIMING0_OFFSET            (0x050) /**<Nand Flash Device Timing Register #0 for CEn[n]  */
-#define DEV_TIMING0_DIFF              (0x00C) /**  */
-#define DEV_TIMING1_OFFSET            (0x054) /**< Nand Flash Device Timing Register #1 for CEn[n] */
-#define DEV_TIMING1_DIFF              (0x00C) /**  */
-#define MOD_CONFIG_OFFSET             (0xFD4) /**< Module Configuration Register */
-#define INT_CLR_ENABLE_OFFSET         (0xFD8) /** Interrupt Clear Enable Register */
-#define INT_SET_ENABLE_OFFSET         (0xFDC) /** Interrupt Set Enable Register */
-#define INT_STATUS_OFFSET             (0xFE0) /** Interrupt Status Register */
-#define INT_ENABLE_OFFSET             (0xFE4) /** Interrupt Enable Register */
-#define INT_CLR_STATUS_OFFSET         (0xFE8) /** Interrupt Clear Status Set Register */
-#define INT_SET_STATUS_OFFSET         (0xFEC) /** Interrupt Set Status Set Register */
-#define SWRESET_OFFSET                (0xFF0) /**< Software reset register */
-#define POWER_DOWN_OFFSET             (0xFF4) /**< Power down register */
-#define EXT_MODID_OFFSET              (0xFF8) /**< Dynamic memory write recovery time register */
-#define MODID_OFFSET                  (0xFFC) /**< Dynamic memory write recovery time register */
+#define CMD_ADDR_FIFO_OFFSET      (0x000) /**< EFMC Nand Flash Command / Address FIFO register */
+#define PAGE_RW_OFFSET            (0x004) /**< EFMC Nand Flash Page Read/Write register */
+#define NAND_STATUS_OFFSET        (0x008) /** Nand Flash Status registers */
+#define DMA_CTRL_OFFSET           (0x00C) /** DMA Control Register */
+#define EBI_CTRL_OFFSET           (0x010) /**<  EBI Pin-Sharing Control Register*/
+#define AHB_LATENCY_OFFSET        (0x014) /**< AX/AHB Latency Register */
+#define APB_LATENCY_OFFSET        (0x018) /**<  APB Latency Register*/
+#define APB_ERROR_GEN_OFFSET      (0x01C) /**<  APB Error Register */
+#define AES_KEY1_OFFSET           (0x020) /**< AES Key Register(1st 32bit) */
+#define AES_KEY2_OFFSET           (0x024) /**< AES Key Register(2nd 32bit) */
+#define AES_KEY3_OFFSET           (0x028) /**< AES Key Register (3rd 32bit) */
+#define AES_KEY4_OFFSET           (0x02C) /**< AES Key Register (4th 32bit) */
+#define AES_IV1_OFFSET            (0x030) /**<  AES Initial Value Register (1st 32bit)*/
+#define AES_IV2_OFFSET            (0x034) /**< AES Initial Value Register (2nd32bit) */
+#define AES_IV3_OFFSET            (0x038) /**< AES Initial Value Register (3rd 32bit) */
+#define AES_IV4_OFFSET            (0x03C) /**< AES Initial Value Register (4th 32bit) */
+#define AES_STATUS_OFFSET         (0x040) /**< AES Status Register */
+#define SINGLE_READ_OFFSET        (0x044) /**<  Nand Flash SInge Read Register*/
+#define SINGLE_WRITE_OFFSET       (0x048) /**< Nand Flash SInge Write Register */
+#define DEV_TYPE0_OFFSET          (0x04C) /**<  Nand Flash Device Type Register for CEn[n]*/
+#define DEV_TYPE0_DIFF            (0x00C) /**  */
+#define DEV_TIMING0_OFFSET        (0x050) /**<Nand Flash Device Timing Register #0 for CEn[n]  */
+#define DEV_TIMING0_DIFF          (0x00C) /**  */
+#define DEV_TIMING1_OFFSET        (0x054) /**< Nand Flash Device Timing Register #1 for CEn[n] */
+#define DEV_TIMING1_DIFF          (0x00C) /**  */
+#define MOD_CONFIG_OFFSET         (0xFD4) /**< Module Configuration Register */
+#define INT_CLR_ENABLE_OFFSET     (0xFD8) /** Interrupt Clear Enable Register */
+#define INT_SET_ENABLE_OFFSET     (0xFDC) /** Interrupt Set Enable Register */
+#define INT_STATUS_OFFSET         (0xFE0) /** Interrupt Status Register */
+#define INT_ENABLE_OFFSET         (0xFE4) /** Interrupt Enable Register */
+#define INT_CLR_STATUS_OFFSET     (0xFE8) /** Interrupt Clear Status Set Register */
+#define INT_SET_STATUS_OFFSET     (0xFEC) /** Interrupt Set Status Set Register */
+#define SWRESET_OFFSET            (0xFF0) /**< Software reset register */
+#define POWER_DOWN_OFFSET         (0xFF4) /**< Power down register */
+#define EXT_MODID_OFFSET          (0xFF8) /**< Dynamic memory write recovery time register */
+#define MODID_OFFSET              (0xFFC) /**< Dynamic memory write recovery time register */
 
 /* Module Config Register bits */
-#define MOD_CONFIG_AES_MSK            	(0x00000020)
+#define MOD_CONFIG_AES_MSK        (0x00000020)
 
 /* Device Type Register bits */
-#define DEV_TYPE0_CEN_DONT_MSK   		(0x00000004)
-#define DEV_TYPE0_DATA_WIDTH_MSK 		(0x00000003)
-#define DEV_TYPE0_PAGE_SIZE_MASK      	(0x00000070)
-#define DEV_TYPE0_PAGE_SIZE_POS			(4)
+#define DEV_TYPE0_CEN_DONT_MSK    (0x00000004)
+#define DEV_TYPE0_DATA_WIDTH_MSK  (0x00000003)
+#define DEV_TYPE0_PAGE_SIZE_MASK  (0x00000070)
+#define DEV_TYPE0_PAGE_SIZE_POS   (4)
 
 /* NAND Status register bits */
-#define	NAND_STATUS_RB_DEV0				(0x00000001)
+#define NAND_STATUS_RB_DEV0       (0x00000001)
 
 /* Cmd FIFO bit information */
-#define CMD_FIFO_CE_POS    				(19)
-#define CMD_FIFO_CE_MSK					(0x00000003)
-#define CMD_FIFO_CYCLE_POS    			(16)
-#define CMD_FIFO_CYCLE_MSK    			(0x00000003)
-#define CMD_FIFO_LAST_POS    			(18)
-#define CMD_FIFO_LAST_MSK	   			(0x00000001)
-#define CMD_FIFO_IO_POS					(0)
-#define CMD_FIFO_IO_MSK					(0x0000FFFF)
+#define CMD_FIFO_CE_POS           (19)
+#define CMD_FIFO_CE_MSK           (0x00000003)
+#define CMD_FIFO_CYCLE_POS        (16)
+#define CMD_FIFO_CYCLE_MSK        (0x00000003)
+#define CMD_FIFO_LAST_POS         (18)
+#define CMD_FIFO_LAST_MSK         (0x00000001)
+#define CMD_FIFO_IO_POS           (0)
+#define CMD_FIFO_IO_MSK           (0x0000FFFF)
 
 /* Interrupt Register bits */
 #define NX_NAND_INT_READY_START   (20)
@@ -147,25 +147,26 @@
 #define PAGE_RW_PAGE_READ_MSK     (0x00000001)
 
 #define NX_NAND_SP_ADDR_MASK      (0x000000FF)
+
 /**
 * NAND control structure
 */
 struct nx_nand_ctrl {
-	struct mtd_info       *mtd;          /* MTD information structure */
-  uint8_t               *dmabuf;    	/* DMA buffer */
-  uint8_t				*dmabuf_unalgn; /* Unaligned buffer */
-  int                   slotid;     	/* current chip number */
-  int                   cur_col;    	/* Current column address */
-  int                   cur_page;   	/* Current page address */
-  int                   cur_cmd;   		/* Current page address */
-  int                   lb_chip;   	  /* Large Block chip flag */
-  void __iomem          *ctrl_base; 	/* Controller base address */
-  int                   aes;        	/* AES decryption support */
-  uint32_t              aes_key[4]; 	/* AES 128 bit key */
-  uint32_t              aes_val[4]; 	/* AES initial 128 bit value */
-  int	                num_blks;   	/* # of 512 bytes blocks per page */
-  int	                blk_index;  	/* Block index */
-  int                   *ecc_status;	/* ECC status array */
-  int                   offset;				/* Offset in inetrnal driver buffer */
-  int 					cedontcare;		/* CE dont care support */
+    struct mtd_info    *mtd;            /* MTD information structure */
+    int                 slotid;         /* current chip number */
+    int                 cur_col;        /* Current column address */
+    int                 cur_page;       /* Current page address */
+    int                 cur_cmd;        /* Current page address */
+    int                 lb_chip;        /* Large Block chip flag */
+    void __iomem       *ctrl_base;      /* Controller base address */
+    int                 aes;            /* AES decryption support */
+    uint32_t            aes_key[4];     /* AES 128 bit key */
+    uint32_t            aes_val[4];     /* AES initial 128 bit value */
+    int                 num_blks;       /* # of 512 bytes blocks per page */
+    int                 blk_index;      /* Block index */
+    int                 ecc_status;     /* ECC status */
+    int                 offset;         /* Offset in inetrnal driver buffer */
+    int                 cedontcare;     /* CE dont care support */
+    int                 page_size;      /* Flash page size */
+    int                 oob_size;       /* Flash oob size */
 };
diff -Naur u-boot-2009.08.orig3/drivers/mtd/nor/Makefile~ u-boot-2009.08.mine2/drivers/mtd/nor/Makefile~
--- u-boot-2009.08.orig3/drivers/mtd/nor/Makefile~	2010-10-13 16:01:49.512251476 -0500
+++ u-boot-2009.08.mine2/drivers/mtd/nor/Makefile~	1969-12-31 18:00:00.000000000 -0600
@@ -1,51 +0,0 @@
-#
-# (C) Copyright 2006
-# Wolfgang Denk, DENX Software Engineering, wd@denx.de.
-#
-# See file CREDITS for list of people who contributed to this
-# project.
-#
-# This program is free software; you can redistribute it and/or
-# modify it under the terms of the GNU General Public License as
-# published by the Free Software Foundation; either version 2 of
-# the License, or (at your option) any later version.
-#
-# This program is distributed in the hope that it will be useful,
-# but WITHOUT ANY WARRANTY; without even the implied warranty of
-# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.	See the
-# GNU General Public License for more details.
-#
-# You should have received a copy of the GNU General Public License
-# along with this program; if not, write to the Free Software
-# Foundation, Inc., 59 Temple Place, Suite 330, Boston,
-# MA 02111-1307 USA
-#
-
-include $(TOPDIR)/config.mk
-
-LIB	:= $(obj)libnor.a
-
-ifdef CONFIG_CMD_NOR
-COBJS-y += nor.o
-COBJS-y += ip2016nor.o
-COBJS-y += ip1902dmac.o
-COBJS-y += ip2070gcs.o
-endif
-
-COBJS	:= $(COBJS-y)
-SRCS	:= $(COBJS:.o=.c)
-OBJS	:= $(addprefix $(obj),$(COBJS))
-
-all:	$(LIB)
-
-$(LIB):	$(obj).depend $(OBJS)
-	$(AR) $(ARFLAGS) $@ $(OBJS)
-
-#########################################################################
-
-# defines $(obj).depend target
-include $(SRCTREE)/rules.mk
-
-sinclude $(obj).depend
-
-#########################################################################
diff -Naur u-boot-2009.08.orig3/drivers/mtd/nor_old/Makefile~ u-boot-2009.08.mine2/drivers/mtd/nor_old/Makefile~
--- u-boot-2009.08.orig3/drivers/mtd/nor_old/Makefile~	2010-10-13 16:01:49.548253819 -0500
+++ u-boot-2009.08.mine2/drivers/mtd/nor_old/Makefile~	1969-12-31 18:00:00.000000000 -0600
@@ -1,51 +0,0 @@
-#
-# (C) Copyright 2006
-# Wolfgang Denk, DENX Software Engineering, wd@denx.de.
-#
-# See file CREDITS for list of people who contributed to this
-# project.
-#
-# This program is free software; you can redistribute it and/or
-# modify it under the terms of the GNU General Public License as
-# published by the Free Software Foundation; either version 2 of
-# the License, or (at your option) any later version.
-#
-# This program is distributed in the hope that it will be useful,
-# but WITHOUT ANY WARRANTY; without even the implied warranty of
-# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.	See the
-# GNU General Public License for more details.
-#
-# You should have received a copy of the GNU General Public License
-# along with this program; if not, write to the Free Software
-# Foundation, Inc., 59 Temple Place, Suite 330, Boston,
-# MA 02111-1307 USA
-#
-
-include $(TOPDIR)/config.mk
-
-LIB	:= $(obj)libnor.a
-
-ifdef CONFIG_CMD_NOR
-COBJS-y += nor.o
-COBJS-y += ip2016nor.o
-COBJS-y += ip1902dmac.o
-COBJS-y += ip2070gcs.o
-endif
-
-COBJS	:= $(COBJS-y)
-SRCS	:= $(COBJS:.o=.c)
-OBJS	:= $(addprefix $(obj),$(COBJS))
-
-all:	$(LIB)
-
-$(LIB):	$(obj).depend $(OBJS)
-	$(AR) $(ARFLAGS) $@ $(OBJS)
-
-#########################################################################
-
-# defines $(obj).depend target
-include $(SRCTREE)/rules.mk
-
-sinclude $(obj).depend
-
-#########################################################################
diff -Naur u-boot-2009.08.orig3/fs/ubifs/.svn/all-wcprops u-boot-2009.08.mine2/fs/ubifs/.svn/all-wcprops
--- u-boot-2009.08.orig3/fs/ubifs/.svn/all-wcprops	2010-10-13 16:01:49.432091935 -0500
+++ u-boot-2009.08.mine2/fs/ubifs/.svn/all-wcprops	1969-12-31 18:00:00.000000000 -0600
@@ -1,161 +0,0 @@
-K 25
-svn:wc:ra_dav:version-url
-V 57
-/svn/uboot/!svn/ver/207/branches/pnx8xxx-2009.01/fs/ubifs
-END
-super.c
-K 25
-svn:wc:ra_dav:version-url
-V 65
-/svn/uboot/!svn/ver/207/branches/pnx8xxx-2009.01/fs/ubifs/super.c
-END
-recovery.c
-K 25
-svn:wc:ra_dav:version-url
-V 68
-/svn/uboot/!svn/ver/207/branches/pnx8xxx-2009.01/fs/ubifs/recovery.c
-END
-tnc_misc.c
-K 25
-svn:wc:ra_dav:version-url
-V 68
-/svn/uboot/!svn/ver/207/branches/pnx8xxx-2009.01/fs/ubifs/tnc_misc.c
-END
-lpt.c
-K 25
-svn:wc:ra_dav:version-url
-V 63
-/svn/uboot/!svn/ver/207/branches/pnx8xxx-2009.01/fs/ubifs/lpt.c
-END
-misc.h
-K 25
-svn:wc:ra_dav:version-url
-V 64
-/svn/uboot/!svn/ver/207/branches/pnx8xxx-2009.01/fs/ubifs/misc.h
-END
-sb.c
-K 25
-svn:wc:ra_dav:version-url
-V 62
-/svn/uboot/!svn/ver/207/branches/pnx8xxx-2009.01/fs/ubifs/sb.c
-END
-io.c
-K 25
-svn:wc:ra_dav:version-url
-V 62
-/svn/uboot/!svn/ver/207/branches/pnx8xxx-2009.01/fs/ubifs/io.c
-END
-lpt_commit.c
-K 25
-svn:wc:ra_dav:version-url
-V 70
-/svn/uboot/!svn/ver/207/branches/pnx8xxx-2009.01/fs/ubifs/lpt_commit.c
-END
-ubifs.c
-K 25
-svn:wc:ra_dav:version-url
-V 65
-/svn/uboot/!svn/ver/207/branches/pnx8xxx-2009.01/fs/ubifs/ubifs.c
-END
-budget.c
-K 25
-svn:wc:ra_dav:version-url
-V 66
-/svn/uboot/!svn/ver/207/branches/pnx8xxx-2009.01/fs/ubifs/budget.c
-END
-ubifs.h
-K 25
-svn:wc:ra_dav:version-url
-V 65
-/svn/uboot/!svn/ver/207/branches/pnx8xxx-2009.01/fs/ubifs/ubifs.h
-END
-crc16.c
-K 25
-svn:wc:ra_dav:version-url
-V 65
-/svn/uboot/!svn/ver/207/branches/pnx8xxx-2009.01/fs/ubifs/crc16.c
-END
-lprops.c
-K 25
-svn:wc:ra_dav:version-url
-V 66
-/svn/uboot/!svn/ver/207/branches/pnx8xxx-2009.01/fs/ubifs/lprops.c
-END
-log.c
-K 25
-svn:wc:ra_dav:version-url
-V 63
-/svn/uboot/!svn/ver/207/branches/pnx8xxx-2009.01/fs/ubifs/log.c
-END
-crc16.h
-K 25
-svn:wc:ra_dav:version-url
-V 65
-/svn/uboot/!svn/ver/207/branches/pnx8xxx-2009.01/fs/ubifs/crc16.h
-END
-scan.c
-K 25
-svn:wc:ra_dav:version-url
-V 64
-/svn/uboot/!svn/ver/207/branches/pnx8xxx-2009.01/fs/ubifs/scan.c
-END
-tnc.c
-K 25
-svn:wc:ra_dav:version-url
-V 63
-/svn/uboot/!svn/ver/207/branches/pnx8xxx-2009.01/fs/ubifs/tnc.c
-END
-debug.c
-K 25
-svn:wc:ra_dav:version-url
-V 65
-/svn/uboot/!svn/ver/207/branches/pnx8xxx-2009.01/fs/ubifs/debug.c
-END
-orphan.c
-K 25
-svn:wc:ra_dav:version-url
-V 66
-/svn/uboot/!svn/ver/207/branches/pnx8xxx-2009.01/fs/ubifs/orphan.c
-END
-ubifs-media.h
-K 25
-svn:wc:ra_dav:version-url
-V 71
-/svn/uboot/!svn/ver/207/branches/pnx8xxx-2009.01/fs/ubifs/ubifs-media.h
-END
-master.c
-K 25
-svn:wc:ra_dav:version-url
-V 66
-/svn/uboot/!svn/ver/207/branches/pnx8xxx-2009.01/fs/ubifs/master.c
-END
-debug.h
-K 25
-svn:wc:ra_dav:version-url
-V 65
-/svn/uboot/!svn/ver/207/branches/pnx8xxx-2009.01/fs/ubifs/debug.h
-END
-Makefile
-K 25
-svn:wc:ra_dav:version-url
-V 66
-/svn/uboot/!svn/ver/207/branches/pnx8xxx-2009.01/fs/ubifs/Makefile
-END
-replay.c
-K 25
-svn:wc:ra_dav:version-url
-V 66
-/svn/uboot/!svn/ver/207/branches/pnx8xxx-2009.01/fs/ubifs/replay.c
-END
-tnc_commit.c
-K 25
-svn:wc:ra_dav:version-url
-V 70
-/svn/uboot/!svn/ver/207/branches/pnx8xxx-2009.01/fs/ubifs/tnc_commit.c
-END
-key.h
-K 25
-svn:wc:ra_dav:version-url
-V 63
-/svn/uboot/!svn/ver/207/branches/pnx8xxx-2009.01/fs/ubifs/key.h
-END
diff -Naur u-boot-2009.08.orig3/include/asm-arm/arch-pnx84xx/cwr/v2007.1.project u-boot-2009.08.mine2/include/asm-arm/arch-pnx84xx/cwr/v2007.1.project
--- u-boot-2009.08.orig3/include/asm-arm/arch-pnx84xx/cwr/v2007.1.project	2010-10-13 16:01:49.460002229 -0500
+++ u-boot-2009.08.mine2/include/asm-arm/arch-pnx84xx/cwr/v2007.1.project	1969-12-31 18:00:00.000000000 -0600
@@ -1,3 +0,0 @@
-<registry>
-<table n="cwr"/>
-</registry>
diff -Naur u-boot-2009.08.orig3/include/asm-arm/arch-pnx84xx/cwr/vtemp.project u-boot-2009.08.mine2/include/asm-arm/arch-pnx84xx/cwr/vtemp.project
--- u-boot-2009.08.orig3/include/asm-arm/arch-pnx84xx/cwr/vtemp.project	2010-10-13 16:01:49.460002229 -0500
+++ u-boot-2009.08.mine2/include/asm-arm/arch-pnx84xx/cwr/vtemp.project	1969-12-31 18:00:00.000000000 -0600
@@ -1,3 +0,0 @@
-<registry>
-<table n="cwr"/>
-</registry>
diff -Naur u-boot-2009.08.orig3/include/configs/vpe_apollo.h u-boot-2009.08.mine2/include/configs/vpe_apollo.h
--- u-boot-2009.08.orig3/include/configs/vpe_apollo.h	2010-10-13 16:01:50.000000675 -0500
+++ u-boot-2009.08.mine2/include/configs/vpe_apollo.h	2010-10-13 16:12:43.468006632 -0500
@@ -368,7 +368,6 @@
 #if defined(CONFIG_CMD_NAND)
 #define CONFIG_DMAC_NXP_1902
 #define CONFIG_NAND_NXP_2070
-#define CONFIG_MTD_NX_NAND_HWECC
 #endif

 #if defined(CONFIG_CMD_NAND)
diff -Naur u-boot-2009.08.orig3/include/malloc.h u-boot-2009.08.mine2/include/malloc.h
--- u-boot-2009.08.orig3/include/malloc.h	2009-08-31 12:57:42.000000000 -0500
+++ u-boot-2009.08.mine2/include/malloc.h	2010-10-13 16:12:43.472039337 -0500
@@ -849,8 +849,15 @@
 #define MORECORE_FAILURE -1
 #endif
 
-#ifndef MORECORE_CLEARS
-#define MORECORE_CLEARS 1
+/*
+ * Orginal u-boot code defined this which is used
+ * to indicate that all memory available to mem
+ * alloc system has been zeroed. In order to boot
+ * faster, we don't do that. Therefore, we make sure 
+ * MORECORE_CLEARS is undefined.
+ */
+#ifdef MORECORE_CLEARS
+#undef MORECORE_CLEARS
 #endif
 
 #endif /* INTERNAL_LINUX_C_LIB */
